<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Untitled</title>
    <meta name="description" content="Untitled - Hongwei Zhao's Blog">
    <meta name="author" content="Hongwei Zhao">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+SC:wght@300;400;500;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Code Highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" id="hljs-theme-dark">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css" id="hljs-theme-light" disabled>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- KaTeX for Math -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    
    <style>
        :root {
            /* Light Theme - æ˜äº®æ¸…æ–°é…è‰² */
            --primary-color: #4A90D9;
            --primary-hover: #3678C2;
            --link-color: #E86B5F;
            --text-color: #2D2D2D;
            --text-light: #5A5A5A;
            --text-muted: #8A8A8A;
            --bg-color: #FFFFFF;
            --bg-secondary: #F5F7FA;
            --bg-code: #F8F9FC;
            --border-color: #E8ECF0;
            --shadow: 0 2px 8px rgba(0,0,0,0.06);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.08);
        }

        [data-theme="dark"] {
            --primary-color: #5dade2;
            --primary-hover: #85c1e9;
            --link-color: #e74c3c;
            --text-color: #e5e7eb;
            --text-light: #9ca3af;
            --text-muted: #6b7280;
            --bg-color: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-code: #0f0f23;
            --border-color: #374151;
            --shadow: 0 1px 3px rgba(0,0,0,0.3);
            --shadow-lg: 0 4px 15px rgba(0,0,0,0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', 'Noto Sans SC', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-size: 16px;
            line-height: 1.8;
            color: var(--text-color);
            background: var(--bg-color);
            transition: background-color 0.3s, color 0.3s;
        }

        a {
            color: var(--primary-color);
            text-decoration: none;
            transition: color 0.2s;
        }

        a:hover {
            color: var(--primary-hover);
            text-decoration: underline;
        }

        /* Layout */
        .page-wrapper {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            gap: 3rem;
        }

        /* Sidebar TOC */
        .toc-sidebar {
            width: 260px;
            flex-shrink: 0;
            position: sticky;
            top: 2rem;
            height: fit-content;
            max-height: calc(100vh - 4rem);
            overflow-y: auto;
        }

        .toc-container {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .toc-container h3 {
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .toc-container ul {
            list-style: none;
        }

        .toc-container li {
            margin-bottom: 0.5rem;
        }

        .toc-container a {
            font-size: 0.9rem;
            color: var(--text-light);
            display: block;
            padding: 0.25rem 0;
            border-left: 2px solid transparent;
            padding-left: 0.75rem;
            transition: all 0.2s;
        }

        .toc-container a:hover,
        .toc-container a.active {
            color: var(--primary-color);
            border-left-color: var(--primary-color);
            text-decoration: none;
        }

        .toc-container ul ul {
            margin-left: 1rem;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            min-width: 0;
            max-width: 800px;
        }

        /* Header */
        .post-header {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 1.5rem;
        }

        .back-link:hover {
            color: var(--primary-color);
            text-decoration: none;
        }

        .post-header h1 {
            font-size: 2.25rem;
            font-weight: 700;
            line-height: 1.3;
            margin-bottom: 1rem;
            color: var(--text-color);
        }

        .post-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .post-meta span {
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .post-meta i {
            color: var(--text-muted);
        }

        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .tag {
            display: inline-block;
            font-size: 0.8rem;
            background: var(--bg-secondary);
            color: var(--text-light);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            transition: all 0.2s;
        }

        .tag:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* Article Content */
        .post-content {
            font-size: 1rem;
            line-height: 1.9;
        }

        .post-content h1,
        .post-content h2,
        .post-content h3,
        .post-content h4,
        .post-content h5,
        .post-content h6 {
            margin-top: 2rem;
            margin-bottom: 1rem;
            font-weight: 600;
            line-height: 1.4;
            color: var(--text-color);
        }

        .post-content h1 { font-size: 1.875rem; }
        .post-content h2 { 
            font-size: 1.5rem; 
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        .post-content h3 { font-size: 1.25rem; }
        .post-content h4 { font-size: 1.125rem; }

        .post-content p {
            margin-bottom: 1.25rem;
        }

        .post-content ul,
        .post-content ol {
            margin: 1.25rem 0;
            padding-left: 1.5rem;
        }

        .post-content li {
            margin-bottom: 0.5rem;
        }

        .post-content blockquote {
            margin: 1.5rem 0;
            padding: 1rem 1.5rem;
            background: var(--bg-secondary);
            border-left: 4px solid var(--primary-color);
            border-radius: 0 8px 8px 0;
            color: var(--text-light);
            font-style: italic;
        }

        .post-content blockquote p:last-child {
            margin-bottom: 0;
        }

        /* Code */
        .post-content code {
            font-family: 'JetBrains Mono', 'Fira Code', Consolas, monospace;
            font-size: 0.9em;
            background: var(--bg-code);
            padding: 0.2em 0.4em;
            border-radius: 4px;
            color: var(--link-color);
        }

        .post-content pre {
            margin: 1.5rem 0;
            padding: 1.25rem;
            background: var(--bg-code);
            border-radius: 10px;
            overflow-x: auto;
            border: 1px solid var(--border-color);
        }

        .post-content pre code {
            background: none;
            padding: 0;
            color: inherit;
            font-size: 0.875rem;
            line-height: 1.6;
        }

        /* Images */
        .post-content img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            margin: 1.5rem 0;
            box-shadow: var(--shadow-lg);
        }

        /* Tables */
        .post-content table {
            width: 100%;
            margin: 1.5rem 0;
            border-collapse: collapse;
            font-size: 0.95rem;
        }

        .post-content th,
        .post-content td {
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            text-align: left;
        }

        .post-content th {
            background: var(--bg-secondary);
            font-weight: 600;
        }

        .post-content tr:nth-child(even) {
            background: var(--bg-secondary);
        }

        /* Math */
        .math-display {
            margin: 1.5rem 0;
            overflow-x: auto;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: 8px;
        }

        /* Anchor links */
        .anchor-link {
            opacity: 0;
            margin-left: 0.5rem;
            color: var(--text-muted);
            font-weight: 400;
            transition: opacity 0.2s;
        }

        .post-content h2:hover .anchor-link,
        .post-content h3:hover .anchor-link,
        .post-content h4:hover .anchor-link {
            opacity: 1;
        }

        /* Theme Toggle */
        .theme-toggle {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            box-shadow: var(--shadow-lg);
            transition: transform 0.2s, background 0.2s;
            z-index: 1000;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
            background: var(--primary-hover);
        }

        /* Comments Section */
        .comments-section {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
        }

        .comments-section h3 {
            font-size: 1.25rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Footer */
        .post-footer {
            margin-top: 3rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
            text-align: center;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .toc-sidebar {
                display: none;
            }
            
            .page-wrapper {
                padding: 1.5rem;
            }
        }

        @media (max-width: 768px) {
            .post-header h1 {
                font-size: 1.75rem;
            }
            
            .post-meta {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .theme-toggle {
                bottom: 1rem;
                right: 1rem;
                width: 44px;
                height: 44px;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }
    </style>
</head>
<body>
    <div class="page-wrapper">
        <!-- TOC Sidebar -->
        <aside class="toc-sidebar">
            <div class="toc-container">
                <h3><i class="fas fa-list"></i> ç›®å½•</h3>
                <div class="toc">
<ul>
<li><a href="#æ¨¡å‹æ¶æ„">æ¨¡å‹æ¶æ„</a><ul>
<li><a href="#ç¼–ç ç«¯encoder-onlyæ¶æ„">ç¼–ç ç«¯ï¼ˆEncoder-Onlyï¼‰æ¶æ„</a></li>
<li><a href="#è§£ç å™¨decoder-onlyæ¶æ„">è§£ç å™¨ï¼ˆDecoder-Onlyï¼‰æ¶æ„</a></li>
<li><a href="#ç¼–ç -è§£ç ç«¯encoder-decoderæ¶æ„">ç¼–ç -è§£ç ç«¯ï¼ˆEncoder-Decoderï¼‰æ¶æ„</a></li>
<li><a href="#è¯­è¨€æ¨¡å‹ç†è®º">è¯­è¨€æ¨¡å‹ç†è®º</a><ul>
<li><a href="#åŸºç¡€æ¶æ„">åŸºç¡€æ¶æ„</a></li>
<li><a href="#é€’å½’ç¥ç»ç½‘ç»œ">é€’å½’ç¥ç»ç½‘ç»œ</a></li>
<li><a href="#transformer">Transformer</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#transformer-ä¸­çš„-mask-æœºåˆ¶">Transformer ä¸­çš„ mask æœºåˆ¶</a><ul>
<li><a href="#padding-maskå¡«å……æ©ç ">Padding maskï¼ˆå¡«å……æ©ç ï¼‰</a></li>
<li><a href="#sequence-maskåºåˆ—æ©ç ">Sequence maskï¼ˆåºåˆ—æ©ç ï¼‰</a></li>
</ul>
</li>
<li><a href="#causal-decoder">Causal Decoder</a></li>
<li><a href="#prefix-decoder">Prefix Decoder</a></li>
<li><a href="#encoder-decoder">Encoder Decoder</a></li>
<li><a href="#æ··åˆä¸“å®¶æ¨¡å‹">æ··åˆä¸“å®¶æ¨¡å‹</a><ul>
<li><a href="#åŸºç¡€çŸ¥è¯†">åŸºç¡€çŸ¥è¯†</a><ul>
<li><a href="#4111-ç¤ºä¾‹">4.1.1.1 ç¤ºä¾‹</a></li>
<li><a href="#4112-è®­ç»ƒ">4.1.1.2 è®­ç»ƒ</a></li>
<li><a href="#4113-èŠ‚çº¦è®¡ç®—">4.1.1.3 èŠ‚çº¦è®¡ç®—</a></li>
<li><a href="#4114-å¹³è¡¡ä¸“å®¶">4.1.1.4 å¹³è¡¡ä¸“å®¶</a></li>
<li><a href="#10115-å¹¶è¡Œ">101.1.5 å¹¶è¡Œ</a></li>
</ul>
</li>
<li><a href="#412-sparsely-gated-mixture-of-experts-lepikhin-et-al-2021">4.1.2 Sparsely-gated mixture of experts (Lepikhin et al. 2021)</a><ul>
<li><a href="#4121-ç¬¦å·å®šä¹‰">4.1.2.1 ç¬¦å·å®šä¹‰</a></li>
<li><a href="#4122-å¹³è¡¡ä¸“å®¶">4.1.2.2 å¹³è¡¡ä¸“å®¶</a></li>
<li><a href="#4123-ç¤ºä¾‹">4.1.2.3 ç¤ºä¾‹</a></li>
</ul>
</li>
<li><a href="#413-switch-transformer-fedus-et-al-2021">4.1.3 Switch Transformer (Fedus et al. 2021)</a></li>
<li><a href="#414-balanced-assignment-of-sparse-experts-base-layers-lewis-et-al-2021">4.1.4 Balanced Assignment of Sparse Experts (BASE) layers (Lewis et al., 2021)</a><ul>
<li><a href="#4141-å®éªŒè®¾ç½®">4.1.4.1 å®éªŒè®¾ç½®</a></li>
<li><a href="#4142-æ€»ç»“å’Œä¸‹ä¸€æ­¥å·¥ä½œ">4.1.4.2 æ€»ç»“å’Œä¸‹ä¸€æ­¥å·¥ä½œ</a></li>
</ul>
</li>
<li><a href="#415-generalist-language-model-glam-du-et-al-2021">4.1.5 Generalist Language Model (GLaM) (Du et al. 2021)</a><ul>
<li><a href="#4151-è§„æ ¼">4.1.5.1 è§„æ ¼</a></li>
<li><a href="#4152-å…¶ä»–">4.1.5.2 å…¶ä»–</a></li>
<li><a href="#4153-ç»“æœ">4.1.5.3 ç»“æœ</a></li>
<li><a href="#4154-winogenderä¸Šçš„ç»“æœ">4.1.5.4 WinoGenderä¸Šçš„ç»“æœ</a></li>
</ul>
</li>
<li><a href="#416-facebookmoe-artetxe-et-al-2021">4.1.6 FacebookMoE (Artetxe et al., 2021)</a><ul>
<li><a href="#4161-å®éªŒè®¾ç½®">4.1.6.1 å®éªŒè®¾ç½®</a></li>
<li><a href="#4162-ç¤ºä¾‹">4.1.6.2 ç¤ºä¾‹</a></li>
</ul>
</li>
<li><a href="#417-decentralized-mixture-of-experts-ryabinin--gusev-2020">4.1.7 Decentralized mixture-of-experts (Ryabinin &amp; Gusev, 2020)</a><ul>
<li><a href="#4171-åŠ¨æœº">4.1.7.1 åŠ¨æœº</a></li>
<li><a href="#4172-ä¸»è¦è€ƒè™‘å› ç´ ">4.1.7.2 ä¸»è¦è€ƒè™‘å› ç´ </a></li>
<li><a href="#4173-åˆ†å¸ƒå¼å“ˆå¸Œè¡¨">4.1.7.3 åˆ†å¸ƒå¼å“ˆå¸Œè¡¨</a></li>
<li><a href="#4174-è®ºæ–‡å®éªŒ">4.1.7.4 è®ºæ–‡å®éªŒ</a></li>
</ul>
</li>
<li><a href="#418-diskin-et-al-2021">4.1.8 Diskin et al., 2021</a></li>
<li><a href="#419-æ€»ç»“">4.1.9 æ€»ç»“</a></li>
</ul>
</li>
<li><a href="#42-åŸºäºæ£€ç´¢çš„æ¨¡å‹">4.2 åŸºäºæ£€ç´¢çš„æ¨¡å‹</a><ul>
<li><a href="#421-ç¼–ç å™¨-è§£ç å™¨">4.2.1 ç¼–ç å™¨-è§£ç å™¨</a></li>
<li><a href="#1022-æ£€ç´¢æ–¹æ³•">10.2.2 æ£€ç´¢æ–¹æ³•</a></li>
<li><a href="#1023-retrieval-augmented-generation-rag-lewis-et-al-2020">10.2.3 Retrieval-augmented generation (RAG) (Lewis et al., 2020)</a><ul>
<li><a href="#10231-æ£€ç´¢å™¨">10.2.3.1 æ£€ç´¢å™¨</a></li>
<li><a href="#10232-ç”Ÿæˆå™¨">10.2.3.2 ç”Ÿæˆå™¨</a></li>
<li><a href="#10233-è®­ç»ƒ">10.2.3.3 è®­ç»ƒ</a></li>
<li><a href="#10234-å®éªŒ">10.2.3.4 å®éªŒ</a></li>
</ul>
</li>
<li><a href="#1024-retro-borgeaud-et-al-2021">10.2.4 RETRO (Borgeaud et al., 2021)</a><ul>
<li><a href="#10241-å®éªŒç»“æœ">10.2.4.1 å®éªŒç»“æœ</a></li>
</ul>
</li>
<li><a href="#1025-è®¨è®º">10.2.5 è®¨è®º</a></li>
</ul>
</li>
<li><a href="#103-æ€»ä½“æ€»ç»“">10.3 æ€»ä½“æ€»ç»“</a></li>
<li><a href="#reference">Reference</a></li>
</ul>
</div>

            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <article>
                <header class="post-header">
                    <a href="../../../index.html" class="back-link">
                        <i class="fas fa-arrow-left"></i> è¿”å›åšå®¢åˆ—è¡¨
                    </a>
                    <h1>Untitled</h1>
                    <div class="post-meta">
                        <span><i class="fas fa-calendar-alt"></i> 2026-02-04</span>
                        <span><i class="fas fa-folder"></i> å¤§æ¨¡å‹/02.æ¶æ„ç¯‡</span>
                        <span><i class="fas fa-user"></i> Hongwei Zhao</span>
                    </div>
                    <div class="tags">
                        
                    </div>
                </header>

                <div class="post-content">
                    <h2 id="æ¨¡å‹æ¶æ„">æ¨¡å‹æ¶æ„<a class="anchor-link" href="#æ¨¡å‹æ¶æ„" title="Permanent link">&para;</a></h2>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å°†è¯­è¨€æ¨¡å‹å®šä¹‰ä¸ºå¯¹è¯å…ƒåºåˆ—çš„æ¦‚ç‡åˆ†å¸ƒ <span class="math-inline">p(x_{1},â€¦,x_{L})</span>ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°è¿™ç§å®šä¹‰éå¸¸ä¼˜é›…ä¸”å¼ºå¤§ï¼ˆé€šè¿‡æç¤ºï¼Œè¯­è¨€æ¨¡å‹åŸåˆ™ä¸Šå¯ä»¥å®Œæˆä»»ä½•ä»»åŠ¡ï¼Œæ­£å¦‚GPT-3æ‰€ç¤ºï¼‰ã€‚ç„¶è€Œï¼Œåœ¨å®è·µä¸­ï¼Œå¯¹äºä¸“é—¨çš„ä»»åŠ¡æ¥è¯´ï¼Œé¿å…ç”Ÿæˆæ•´ä¸ªåºåˆ—çš„ç”Ÿæˆæ¨¡å‹å¯èƒ½æ›´é«˜æ•ˆã€‚</p>
<p>ä¸Šä¸‹æ–‡å‘é‡è¡¨å¾ (Contextual Embedding): ä½œä¸ºæ¨¡å‹å¤„ç†çš„å…ˆå†³æ¡ä»¶ï¼Œå…¶å…³é”®æ˜¯å°†è¯å…ƒåºåˆ—è¡¨ç¤ºä¸ºå“åº”çš„ä¸Šä¸‹æ–‡çš„å‘é‡è¡¨å¾ï¼š</p>
<p><div class="math-display"><br />
[the, mouse, ate, the, cheese] \stackrel{\phi}{\Rightarrow}\left[\left(\begin{array}{c}<br />
1 \<br />
0.1<br />
\end{array}\right),\left(\begin{array}{l}<br />
0 \<br />
1<br />
\end{array}\right),\left(\begin{array}{l}<br />
1 \<br />
1<br />
\end{array}\right),\left(\begin{array}{c}<br />
1 \<br />
-0.1<br />
\end{array}\right),\left(\begin{array}{c}<br />
0 \<br />
-1<br />
\end{array}\right)\right]. <br />
</div></p>
<p>æ­£å¦‚åç§°æ‰€ç¤ºï¼Œè¯å…ƒçš„ä¸Šä¸‹æ–‡å‘é‡è¡¨å¾å–å†³äºå…¶ä¸Šä¸‹æ–‡ï¼ˆå‘¨å›´çš„å•è¯ï¼‰ï¼›ä¾‹å¦‚ï¼Œè€ƒè™‘mouseçš„å‘é‡è¡¨ç¤ºéœ€è¦å…³æ³¨åˆ°å‘¨å›´æŸä¸ªçª—å£å¤§å°çš„å…¶ä»–å•è¯ã€‚</p>
<ul>
<li>
<p>ç¬¦å·è¡¨ç¤ºï¼šæˆ‘ä»¬å°† <span class="math-inline">Ï•:V^{L}â†’â„^{dÃ—L}</span> å®šä¹‰ä¸ºåµŒå…¥å‡½æ•°ï¼ˆç±»ä¼¼äºåºåˆ—çš„ç‰¹å¾æ˜ å°„ï¼Œæ˜ å°„ä¸ºå¯¹åº”çš„å‘é‡è¡¨ç¤ºï¼‰ã€‚</p>
</li>
<li>
<p>å¯¹äºè¯å…ƒåºåˆ— <span class="math-inline">x1:L=[x_{1},â€¦,x_{L}]</span>ï¼Œ<span class="math-inline">Ï•</span> ç”Ÿæˆä¸Šä¸‹æ–‡å‘é‡è¡¨å¾ <span class="math-inline">Ï•(x_{1:L})</span>ã€‚</p>
</li>
</ul>
<h3 id="ç¼–ç ç«¯encoder-onlyæ¶æ„">ç¼–ç ç«¯ï¼ˆEncoder-Onlyï¼‰æ¶æ„<a class="anchor-link" href="#ç¼–ç ç«¯encoder-onlyæ¶æ„" title="Permanent link">&para;</a></h3>
<p>ç¼–ç ç«¯æ¶æ„çš„è‘—åçš„æ¨¡å‹å¦‚BERTã€RoBERTaç­‰ã€‚è¿™äº›è¯­è¨€æ¨¡å‹ç”Ÿæˆä¸Šä¸‹æ–‡å‘é‡è¡¨å¾ï¼Œä½†ä¸èƒ½ç›´æ¥ç”¨äºç”Ÿæˆæ–‡æœ¬ã€‚å¯ä»¥è¡¨ç¤ºä¸ºï¼Œ <span class="math-inline">x_{1:L}â‡’Ï•(x_{1:L})</span> ã€‚è¿™äº›ä¸Šä¸‹æ–‡å‘é‡è¡¨å¾é€šå¸¸ç”¨äºåˆ†ç±»ä»»åŠ¡ï¼ˆä¹Ÿè¢«ç§°ä¸ºè‡ªç„¶è¯­è¨€ç†è§£ä»»åŠ¡ï¼‰ã€‚ä»»åŠ¡å½¢å¼æ¯”è¾ƒç®€å•ï¼Œä¸‹é¢ä»¥æƒ…æ„Ÿåˆ†ç±»/è‡ªç„¶è¯­è¨€æ¨ç†ä»»åŠ¡ä¸¾ä¾‹ï¼š</p>
<p><div class="math-display"><br />
æƒ…æ„Ÿåˆ†æè¾“å…¥ä¸è¾“å‡ºå½¢å¼ï¼š[[CLS], ä»–ä»¬, ç§»åŠ¨, è€Œ, å¼ºå¤§]\Rightarrow æ­£é¢æƒ…ç»ª<br />
</div></p>
<p><div class="math-display"><br />
è‡ªç„¶è¯­è¨€å¤„ç†è¾“å…¥ä¸è¾“å‡ºå½¢å¼ï¼š[[CLS], æ‰€æœ‰, åŠ¨ç‰©, éƒ½, å–œæ¬¢, åƒ, é¥¼å¹², å“¦]â‡’è•´æ¶µ<br />
</div></p>
<p>è¯¥æ¶æ„çš„ä¼˜åŠ¿æ˜¯å¯¹äºæ–‡æœ¬çš„ä¸Šä¸‹æ–‡ä¿¡æ¯æœ‰æ›´å¥½çš„ç†è§£ï¼Œå› æ­¤è¯¥æ¨¡å‹æ¶æ„æ‰ä¼šå¤šç”¨äºç†è§£ä»»åŠ¡ã€‚è¯¥æ¶æ„çš„ä¼˜ç‚¹æ˜¯å¯¹äºæ¯ä¸ª <span class="math-inline">x_{i}</span> ï¼Œä¸Šä¸‹æ–‡å‘é‡è¡¨å¾å¯ä»¥åŒå‘åœ°ä¾èµ–äºå·¦ä¾§ä¸Šä¸‹æ–‡ <span class="math-inline">(x_{1:iâˆ’1})</span> å’Œå³ä¾§ä¸Šä¸‹æ–‡  <span class="math-inline">(x_{i+1:L})</span> ã€‚ä½†æ˜¯ç¼ºç‚¹åœ¨äºä¸èƒ½è‡ªç„¶åœ°ç”Ÿæˆå®Œæ•´æ–‡æœ¬ï¼Œä¸”éœ€è¦æ›´å¤šçš„ç‰¹å®šè®­ç»ƒç›®æ ‡ï¼ˆå¦‚æ©ç è¯­è¨€å»ºæ¨¡ï¼‰ã€‚</p>
<h3 id="è§£ç å™¨decoder-onlyæ¶æ„">è§£ç å™¨ï¼ˆDecoder-Onlyï¼‰æ¶æ„<a class="anchor-link" href="#è§£ç å™¨decoder-onlyæ¶æ„" title="Permanent link">&para;</a></h3>
<p>è§£ç å™¨æ¶æ„çš„è‘—åæ¨¡å‹å°±æ˜¯å¤§åé¼é¼çš„GPTç³»åˆ—æ¨¡å‹ã€‚è¿™äº›æ˜¯æˆ‘ä»¬å¸¸è§çš„è‡ªå›å½’è¯­è¨€æ¨¡å‹ï¼Œç»™å®šä¸€ä¸ªæç¤º <br />
 <span class="math-inline">x_{1:i}</span> ï¼Œå®ƒä»¬å¯ä»¥ç”Ÿæˆä¸Šä¸‹æ–‡å‘é‡è¡¨å¾ï¼Œå¹¶å¯¹ä¸‹ä¸€ä¸ªè¯å…ƒ <span class="math-inline">x_{i+1}</span> ï¼ˆä»¥åŠé€’å½’åœ°ï¼Œæ•´ä¸ªå®Œæˆ <br />
 <span class="math-inline">x_{i+1:L}</span>ï¼‰ ç”Ÿæˆä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒã€‚ <span class="math-inline">x_{1:i}â‡’Ï•(x_{1:i}),p(x_{i+1}âˆ£x_{1:i})</span> ã€‚æˆ‘ä»¬ä»¥è‡ªåŠ¨è¡¥å…¨ä»»åŠ¡æ¥è¯´ï¼Œè¾“å…¥ä¸è¾“å‡ºçš„å½¢å¼ä¸ºï¼Œ <span class="math-inline">[[CLS], ä»–ä»¬, ç§»åŠ¨, è€Œ]â‡’å¼ºå¤§</span> ã€‚ä¸ç¼–ç ç«¯æ¶æ„æ¯”ï¼Œå…¶ä¼˜ç‚¹ä¸ºèƒ½å¤Ÿè‡ªç„¶åœ°ç”Ÿæˆå®Œæ•´æ–‡æœ¬ï¼Œæœ‰ç®€å•çš„è®­ç»ƒç›®æ ‡ï¼ˆæœ€å¤§ä¼¼ç„¶ï¼‰ã€‚ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå¯¹äºæ¯ä¸ª  <span class="math-inline">x_i</span> ï¼Œä¸Šä¸‹æ–‡å‘é‡è¡¨å¾åªèƒ½å•å‘åœ°ä¾èµ–äºå·¦ä¾§ä¸Šä¸‹æ–‡  (<span class="math-inline">x_{1:iâˆ’1}</span>) ã€‚</p>
<h3 id="ç¼–ç -è§£ç ç«¯encoder-decoderæ¶æ„">ç¼–ç -è§£ç ç«¯ï¼ˆEncoder-Decoderï¼‰æ¶æ„<a class="anchor-link" href="#ç¼–ç -è§£ç ç«¯encoder-decoderæ¶æ„" title="Permanent link">&para;</a></h3>
<p>ç¼–ç -è§£ç ç«¯æ¶æ„å°±æ˜¯æœ€åˆçš„Transformeræ¨¡å‹ï¼Œå…¶ä»–çš„è¿˜æœ‰å¦‚BARTã€T5ç­‰æ¨¡å‹ã€‚è¿™äº›æ¨¡å‹åœ¨æŸç§ç¨‹åº¦ä¸Šç»“åˆäº†ä¸¤è€…çš„ä¼˜ç‚¹ï¼šå®ƒä»¬å¯ä»¥ä½¿ç”¨åŒå‘ä¸Šä¸‹æ–‡å‘é‡è¡¨å¾æ¥å¤„ç†è¾“å…¥ <span class="math-inline">x_{1:L}</span> ï¼Œå¹¶ä¸”å¯ä»¥ç”Ÿæˆè¾“å‡º <span class="math-inline">y_{1:L}</span> ã€‚å¯ä»¥å…¬å¼åŒ–ä¸ºï¼š</p>
<p><div class="math-display"><br />
x1:Lâ‡’Ï•(x1:L),p(y1:Lâˆ£Ï•(x1:L))ã€‚<br />
</div></p>
<p>ä»¥è¡¨æ ¼åˆ°æ–‡æœ¬ç”Ÿæˆä»»åŠ¡ä¸ºä¾‹ï¼Œå…¶è¾“å…¥å’Œè¾“å‡ºçš„å¯ä»¥è¡¨ç¤ºä¸ºï¼š</p>
<p><div class="math-display"><br />
[åç§°:, æ¤ç‰©, |, ç±»å‹:, èŠ±å‰, å•†åº—]â‡’[èŠ±å‰, æ˜¯, ä¸€, ä¸ª, å•†åº—]ã€‚<br />
</div></p>
<p>è¯¥æ¨¡å‹å…·æœ‰ç¼–ç ç«¯ï¼Œè§£ç ç«¯ä¸¤ä¸ªæ¶æ„çš„å…±åŒçš„ä¼˜ç‚¹ï¼Œå¯¹äºæ¯ä¸ª <span class="math-inline">x_{i}</span> ï¼Œä¸Šä¸‹æ–‡å‘é‡è¡¨å¾å¯ä»¥åŒå‘åœ°ä¾èµ–äºå·¦ä¾§ä¸Šä¸‹æ–‡  <span class="math-inline">x_{1:iâˆ’1}</span> ) å’Œå³ä¾§ä¸Šä¸‹æ–‡ ( <span class="math-inline">x_{i+1:L}</span> )ï¼Œå¯ä»¥è‡ªç”±çš„ç”Ÿæˆæ–‡æœ¬æ•°æ®ã€‚ç¼ºç‚¹å°±è¯´éœ€è¦æ›´å¤šçš„ç‰¹å®šè®­ç»ƒç›®æ ‡ã€‚</p>
<h3 id="è¯­è¨€æ¨¡å‹ç†è®º">è¯­è¨€æ¨¡å‹ç†è®º<a class="anchor-link" href="#è¯­è¨€æ¨¡å‹ç†è®º" title="Permanent link">&para;</a></h3>
<p>ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬ä¼šä»‹ç»è¯­è¨€æ¨¡å‹çš„æ¨¡å‹æ¶æ„ï¼Œé‡ç‚¹ä»‹ç»Transformeræ¶æ„æœºå™¨å»¶ä¼¸çš„å†…å®¹ã€‚å¦å¤–æˆ‘ä»¬å¯¹äºæ¶æ„è¿˜ä¼šå¯¹äºä¹‹å‰RNNç½‘ç»œçš„æ ¸å¿ƒçŸ¥è¯†è¿›è¡Œé˜è¿°ï¼Œå…¶ç›®çš„æ˜¯å¯¹äºä»£è¡¨æ€§çš„æ¨¡å‹æ¶æ„è¿›è¡Œå­¦ä¹ ï¼Œä¸ºæœªæ¥çš„å†…å®¹å¢åŠ çŸ¥è¯†å‚¨å¤‡ã€‚</p>
<p>æ·±åº¦å­¦ä¹ çš„ç¾å¦™ä¹‹å¤„åœ¨äºèƒ½å¤Ÿåˆ›å»ºæ„å»ºæ¨¡å—ï¼Œå°±åƒæˆ‘ä»¬ç”¨å‡½æ•°æ„å»ºæ•´ä¸ªç¨‹åºä¸€æ ·ã€‚å› æ­¤ï¼Œåœ¨ä¸‹é¢çš„æ¨¡å‹æ¶æ„çš„è®²è¿°ä¸­ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåƒä¸‹é¢çš„å‡½æ•°ä¸€æ ·å°è£…ï¼Œä»¥å‡½æ•°çš„çš„æ–¹æ³•è¿›è¡Œç†è§£:</p>
<p><div class="math-display"><br />
TransformerBlock(x_{1:L})<br />
</div></p>
<p>ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†åœ¨å‡½æ•°ä¸»ä½“ä¸­åŒ…å«å‚æ•°ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å®šä¹‰ä¸€ä¸ªæ„å»ºæ¨¡å—åº“ï¼Œç›´åˆ°æ„å»ºå®Œæ•´çš„Transformeræ¨¡å‹ã€‚</p>
<h4 id="åŸºç¡€æ¶æ„">åŸºç¡€æ¶æ„<a class="anchor-link" href="#åŸºç¡€æ¶æ„" title="Permanent link">&para;</a></h4>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å°†è¯å…ƒåºåˆ—è½¬æ¢ä¸ºåºåˆ—çš„å‘é‡å½¢å¼ã€‚ <span class="math-inline">EmbedToken</span> å‡½æ•°é€šè¿‡åœ¨åµŒå…¥çŸ©é˜µ <span class="math-inline">Eâˆˆâ„^{|v|Ã—d}</span> ä¸­æŸ¥æ‰¾æ¯ä¸ªè¯å…ƒæ‰€å¯¹åº”çš„å‘é‡ï¼Œè¯¥å‘é‡çš„å…·ä½“å€¼è¿™æ˜¯ä»æ•°æ®ä¸­å­¦ä¹ çš„å‚æ•°ï¼š</p>
<p>def  <span class="math-inline">EmbedToken(x_{1:L}:V^{L})â†’â„^{dÃ—L}</span> ï¼š</p>
<ul>
<li>å°†åºåˆ— <span class="math-inline">x_{1:L}</span> ä¸­çš„æ¯ä¸ªè¯å…ƒ <span class="math-inline">xi</span> è½¬æ¢ä¸ºå‘é‡ã€‚</li>
<li>è¿”å›[Ex1,â€¦,ExL]ã€‚</li>
</ul>
<p>ä»¥ä¸Šçš„è¯åµŒå…¥æ˜¯ä¼ ç»Ÿçš„è¯åµŒå…¥ï¼Œå‘é‡å†…å®¹ä¸ä¸Šä¸‹æ–‡æ— å…³ã€‚è¿™é‡Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæŠ½è±¡çš„ <span class="math-inline">SequenceModel</span> å‡½æ•°ï¼Œå®ƒæ¥å—è¿™äº›ä¸Šä¸‹æ–‡æ— å…³çš„åµŒå…¥ï¼Œå¹¶å°†å®ƒä»¬æ˜ å°„ä¸ºä¸Šä¸‹æ–‡ç›¸å…³çš„åµŒå…¥ã€‚</p>
<p><span class="math-inline">def SequenceModel(x_{1:L}:â„^{dÃ—L})â†’â„^{dÃ—L}</span> ï¼š</p>
<ul>
<li>é’ˆå¯¹åºåˆ— <span class="math-inline">x_{1:L}</span> ä¸­çš„æ¯ä¸ªå…ƒç´ xiè¿›è¡Œå¤„ç†ï¼Œè€ƒè™‘å…¶ä»–å…ƒç´ ã€‚</li>
<li>[æŠ½è±¡å®ç°ï¼ˆä¾‹å¦‚ï¼Œ <span class="math-inline">FeedForwardSequenceModel</span> ï¼Œ <span class="math-inline">SequenceRNN</span> ï¼Œ <span class="math-inline">TransformerBlock</span> ï¼‰]</li>
</ul>
<p>æœ€ç®€å•ç±»å‹çš„åºåˆ—æ¨¡å‹åŸºäºå‰é¦ˆç½‘ç»œï¼ˆBengioç­‰äººï¼Œ2003ï¼‰ï¼Œåº”ç”¨äºå›ºå®šé•¿åº¦çš„ä¸Šä¸‹æ–‡ï¼Œå°±åƒn-gramæ¨¡å‹ä¸€æ ·ï¼Œå‡½æ•°çš„å®ç°å¦‚ä¸‹ï¼š</p>
<p>def  <span class="math-inline">FeedForwardSequenceModel(x_{1:L}:â„^{dÃ—L})â†’â„^{dÃ—L}</span> ï¼š</p>
<ul>
<li>é€šè¿‡æŸ¥çœ‹æœ€å <span class="math-inline">n</span> ä¸ªå…ƒç´ å¤„ç†åºåˆ— <span class="math-inline">x_{1:L}</span> ä¸­çš„æ¯ä¸ªå…ƒç´  <span class="math-inline">xi</span> ã€‚</li>
<li>å¯¹äºæ¯ä¸ª <span class="math-inline">i=1,â€¦,L</span> ï¼š</li>
<li>è®¡ç®— <span class="math-inline">h_{i}</span>=<span class="math-inline">FeedForward(x_{iâˆ’n+1},â€¦,x_{i})</span> ã€‚</li>
<li>è¿”å›[ <span class="math-inline">h_{1},â€¦,h_{L}</span> ]ã€‚</li>
</ul>
<h4 id="é€’å½’ç¥ç»ç½‘ç»œ">é€’å½’ç¥ç»ç½‘ç»œ<a class="anchor-link" href="#é€’å½’ç¥ç»ç½‘ç»œ" title="Permanent link">&para;</a></h4>
<p>ç¬¬ä¸€ä¸ªçœŸæ­£çš„åºåˆ—æ¨¡å‹æ˜¯é€’å½’ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰ï¼Œå®ƒæ˜¯ä¸€ç±»æ¨¡å‹ï¼ŒåŒ…æ‹¬ç®€å•çš„RNNã€LSTMå’ŒGRUã€‚åŸºæœ¬å½¢å¼çš„RNNé€šè¿‡é€’å½’åœ°è®¡ç®—ä¸€ç³»åˆ—éšè—çŠ¶æ€æ¥è¿›è¡Œè®¡ç®—ã€‚</p>
<p>def <span class="math-inline">SequenceRNN(x:â„^{dÃ—L})â†’â„^{dÃ—L}</span> ï¼š</p>
<ul>
<li>ä»å·¦åˆ°å³å¤„ç†åºåˆ— <span class="math-inline">x_{1},â€¦,x_{L}</span> ï¼Œå¹¶é€’å½’è®¡ç®—å‘é‡ <span class="math-inline">h_{1},â€¦,h_{L}</span> ã€‚</li>
<li>å¯¹äº <span class="math-inline">i=1,â€¦,L</span> ï¼š</li>
<li>è®¡ç®— <span class="math-inline">h_{i}=RNN(h_{iâˆ’1},x_{i})</span> ã€‚</li>
<li>è¿”å› <span class="math-inline">[h_{1},â€¦,h_{L}]</span> ã€‚</li>
</ul>
<p>å®é™…å®Œæˆå·¥ä½œçš„æ¨¡å—æ˜¯RNNï¼Œç±»ä¼¼äºæœ‰é™çŠ¶æ€æœºï¼Œå®ƒæ¥æ”¶å½“å‰çŠ¶æ€hã€æ–°è§‚æµ‹å€¼xï¼Œå¹¶è¿”å›æ›´æ–°åçš„çŠ¶æ€ï¼š</p>
<p>def <span class="math-inline">RNN(h:â„^d,x:â„^d)â†’â„^d</span> ï¼š</p>
<ul>
<li>æ ¹æ®æ–°çš„è§‚æµ‹å€¼xæ›´æ–°éšè—çŠ¶æ€hã€‚</li>
<li>[æŠ½è±¡å®ç°ï¼ˆä¾‹å¦‚ï¼ŒSimpleRNNï¼ŒLSTMï¼ŒGRUï¼‰]</li>
</ul>
<p>æœ‰ä¸‰ç§æ–¹æ³•å¯ä»¥å®ç°RNNã€‚æœ€æ—©çš„RNNæ˜¯ç®€å•RNNï¼ˆ<a href="https://onlinelibrary.wiley.com/doi/epdf/10.1207/s15516709cog1402_1">Elmanï¼Œ1990</a>ï¼‰ï¼Œå®ƒå°†<span class="math-inline">h</span> <span class="math-inline">x</span> çº¿æ€§ç»„åˆé€šè¿‡é€å…ƒç´ éçº¿æ€§å‡½æ•° <span class="math-inline">Ïƒ</span> ï¼ˆä¾‹å¦‚ï¼Œé€»è¾‘å‡½æ•° <span class="math-inline">Ïƒ(z)=(1+eâˆ’z)âˆ’1</span> æˆ–æ›´ç°ä»£çš„ <span class="math-inline">ReLU</span> å‡½æ•° <span class="math-inline">Ïƒ(z)=max(0,z)</span> ï¼‰è¿›è¡Œå¤„ç†ã€‚</p>
<p>def <span class="math-inline">SimpleRNN(h:â„d,x:â„d)â†’â„d</span> ï¼š</p>
<ul>
<li>é€šè¿‡ç®€å•çš„çº¿æ€§å˜æ¢å’Œéçº¿æ€§å‡½æ•°æ ¹æ®æ–°çš„è§‚æµ‹å€¼ <span class="math-inline">x</span> æ›´æ–°éšè—çŠ¶æ€ <span class="math-inline">h</span> ã€‚</li>
<li>è¿”å› <span class="math-inline">Ïƒ(Uh+Vx+b)</span> ã€‚</li>
</ul>
<p>æ­£å¦‚å®šä¹‰çš„RNNåªä¾èµ–äºè¿‡å»ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡å‘åè¿è¡Œå¦ä¸€ä¸ªRNNæ¥ä½¿å…¶ä¾èµ–äºæœªæ¥ä¸¤ä¸ªã€‚è¿™äº›æ¨¡å‹è¢«ELMoå’ŒULMFiTä½¿ç”¨ã€‚</p>
<p>def <span class="math-inline">BidirectionalSequenceRNN(x_{1:L}:â„^{dÃ—L})â†’â„^{2dÃ—L}</span> ï¼š</p>
<ul>
<li>åŒæ—¶ä»å·¦åˆ°å³å’Œä»å³åˆ°å·¦å¤„ç†åºåˆ—ã€‚</li>
<li>è®¡ç®—ä»å·¦åˆ°å³ï¼š <span class="math-inline">[hâ†’<em>{1},â€¦,hâ†’</em>{L}]â†SequenceRNN(x_{1},â€¦,x_{L})</span> ã€‚</li>
<li>è®¡ç®—ä»å³åˆ°å·¦ï¼š <span class="math-inline">[hâ†<em>{L},â€¦,hâ†</em>{1}]â†SequenceRNN(x_{L},â€¦,x_{1})</span> ã€‚</li>
<li>è¿”å› <span class="math-inline">[hâ†’<em>{1}hâ†</em>{1},â€¦,hâ†’<em>{L}hâ†</em>{L}]</span> ã€‚</li>
</ul>
<p>æ³¨ï¼š</p>
<ul>
<li>ç®€å•RNNç”±äºæ¢¯åº¦æ¶ˆå¤±çš„é—®é¢˜å¾ˆéš¾è®­ç»ƒã€‚</li>
<li>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå‘å±•äº†é•¿çŸ­æœŸè®°å¿†ï¼ˆLSTMï¼‰å’Œé—¨æ§å¾ªç¯å•å…ƒï¼ˆGRUï¼‰ï¼ˆéƒ½å±äºRNNï¼‰ã€‚</li>
<li>ç„¶è€Œï¼Œå³ä½¿åµŒå…¥h200å¯ä»¥ä¾èµ–äºä»»æ„è¿œçš„è¿‡å»ï¼ˆä¾‹å¦‚ï¼Œx1ï¼‰ï¼Œå®ƒä¸å¤ªå¯èƒ½ä»¥â€œç²¾ç¡®â€çš„æ–¹å¼ä¾èµ–äºå®ƒï¼ˆæ›´å¤šè®¨è®ºï¼Œè¯·å‚è§Khandelwalç­‰äººï¼Œ2018ï¼‰ã€‚</li>
<li>ä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼ŒLSTMçœŸæ­£åœ°å°†æ·±åº¦å­¦ä¹ å¼•å…¥äº†NLPé¢†åŸŸã€‚</li>
</ul>
<h4 id="transformer">Transformer<a class="anchor-link" href="#transformer" title="Permanent link">&para;</a></h4>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å°†è®¨è®ºTransformerï¼ˆ<a href="https://arxiv.org/pdf/1706.03762.pdf">Vaswaniç­‰äººï¼Œ2017</a>ï¼‰ï¼Œè¿™æ˜¯çœŸæ­£æ¨åŠ¨å¤§å‹è¯­è¨€æ¨¡å‹å‘å±•çš„åºåˆ—æ¨¡å‹ã€‚æ­£å¦‚ä¹‹å‰æ‰€æåˆ°çš„ï¼ŒTransformeræ¨¡å‹å°†å…¶åˆ†è§£ä¸ºDecoder-Onlyï¼ˆGPT-2ï¼ŒGPT-3ï¼‰ã€Encoder-Onlyï¼ˆBERTï¼ŒRoBERTaï¼‰å’ŒEncoder-Decoderï¼ˆBARTï¼ŒT5ï¼‰æ¨¡å‹çš„æ„å»ºæ¨¡å—ã€‚</p>
<p>å…³äºTransformerçš„å­¦ä¹ èµ„æºæœ‰å¾ˆå¤šï¼š</p>
<ul>
<li><a href="https://jalammar.github.io/illustrated-transformer/">Illustrated Transformer</a>å’Œ<a href="https://jalammar.github.io/illustrated-gpt2/">Illustrated GPT-2</a>ï¼šå¯¹Transformerçš„è§†è§‰æè¿°éå¸¸å¥½ã€‚</li>
<li><a href="https://nlp.seas.harvard.edu/2018/04/03/attention.html">Annotated Transformer</a>ï¼šTransformerçš„Pytorchå®ç°ã€‚</li>
</ul>
<p>å¼ºçƒˆå»ºè®®æ‚¨é˜…è¯»è¿™äº›å‚è€ƒèµ„æ–™ã€‚è¯¥è¯¾ç¨‹ä¸»è¦ä¾æ®ä»£ç å‡½æ•°å’Œæ¥å£è¿›è¡Œè®²è§£ã€‚</p>
<h5 id="æ³¨æ„åŠ›æœºåˆ¶">æ³¨æ„åŠ›æœºåˆ¶<a class="anchor-link" href="#æ³¨æ„åŠ›æœºåˆ¶" title="Permanent link">&para;</a></h5>
<p>Transformerçš„å…³é”®æ˜¯æ³¨æ„æœºåˆ¶ï¼Œè¿™ä¸ªæœºåˆ¶æ—©åœ¨æœºå™¨ç¿»è¯‘ä¸­å°±è¢«å¼€å‘å‡ºæ¥äº†ï¼ˆBahdananuç­‰äººï¼Œ2017ï¼‰ã€‚å¯ä»¥å°†æ³¨æ„åŠ›è§†ä¸ºä¸€ä¸ªâ€œè½¯â€æŸ¥æ‰¾è¡¨ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªæŸ¥è¯¢ <span class="math-inline">y </span>ï¼Œæˆ‘ä»¬å¸Œæœ›å°†å…¶ä¸åºåˆ— <span class="math-inline">x_{1:L}=[x_1,â€¦,x_L]</span> çš„æ¯ä¸ªå…ƒç´ è¿›è¡ŒåŒ¹é…ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡çº¿æ€§å˜æ¢å°†æ¯ä¸ª <span class="math-inline">x_{i}</span> è§†ä¸ºè¡¨ç¤ºé”®å€¼å¯¹ï¼š</p>
<p><div class="math-display"><br />
(W_{key}x_{i})ï¼š(W_{value}x_{i})<br />
</div></p>
<p>å¹¶é€šè¿‡å¦ä¸€ä¸ªçº¿æ€§å˜æ¢å½¢æˆæŸ¥è¯¢ï¼š</p>
<p><div class="math-display"><br />
W_{query}y<br />
</div></p>
<p>å¯ä»¥å°†é”®å’ŒæŸ¥è¯¢è¿›è¡Œæ¯”è¾ƒï¼Œå¾—åˆ°ä¸€ä¸ªåˆ†æ•°ï¼š</p>
<p><div class="math-display"><br />
score_{i}=x^{âŠ¤}<em>{i}W^{âŠ¤}</em>{key}W_{query}y<br />
</div></p>
<p>è¿™äº›åˆ†æ•°å¯ä»¥è¿›è¡ŒæŒ‡æ•°åŒ–å’Œå½’ä¸€åŒ–ï¼Œå½¢æˆå…³äºè¯å…ƒä½ç½®<span class="math-inline">{1,â€¦,L}</span> æ¦‚ç‡åˆ†å¸ƒï¼š</p>
<p><div class="math-display"><br />
[Î±_{1},â€¦,Î±_{L}]=softmax([score_{1},â€¦,score_{L}])<br />
</div></p>
<p>ç„¶åæœ€ç»ˆçš„è¾“å‡ºæ˜¯åŸºäºå€¼çš„åŠ æƒç»„åˆï¼š</p>
<p><div class="math-display"><br />
\sum_{i=1}^L \alpha_i\left(W_{value} x_i\right)<br />
</div></p>
<p>æˆ‘ä»¬å¯ä»¥ç”¨çŸ©é˜µå½¢å¼ç®€æ´åœ°è¡¨ç¤ºæ‰€æœ‰è¿™äº›å†…å®¹ï¼š</p>
<p>def <span class="math-inline">Attention(x_{1:L}:â„^{dÃ—L},y:â„^d)â†’â„^d</span> ï¼š</p>
<ul>
<li>é€šè¿‡å°†å…¶ä¸æ¯ä¸ª<span class="math-inline">x_{i}</span> è¡Œæ¯”è¾ƒæ¥å¤„ç†<span class="math-inline">y</span>ã€‚</li>
<li>è¿”å› <span class="math-inline">W_{value} x_{1: L} \operatorname{softmax}\left(x_{1: L}^{\top} W_{key}^{\top} W_{query} y / \sqrt{d}\right)</span></li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥å°†æ³¨æ„åŠ›çœ‹ä½œæ˜¯å…·æœ‰å¤šä¸ªæ–¹é¢ï¼ˆä¾‹å¦‚ï¼Œå¥æ³•ã€è¯­ä¹‰ï¼‰çš„åŒ¹é…ã€‚ä¸ºäº†é€‚åº”è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥åŒæ—¶ä½¿ç”¨å¤šä¸ªæ³¨æ„åŠ›å¤´ï¼Œå¹¶ç®€å•åœ°ç»„åˆå®ƒä»¬çš„è¾“å‡ºã€‚</p>
<p>def <span class="math-inline">MultiHeadedAttention(x_{1:L}:â„^{dÃ—L},y:â„^{d})â†’â„^{d}</span> :</p>
<ul>
<li>é€šè¿‡å°†å…¶ä¸æ¯ä¸ªxiä¸nheadsä¸ªæ–¹é¢è¿›è¡Œæ¯”è¾ƒï¼Œå¤„ç†yã€‚</li>
<li>è¿”å› <span class="math-inline">W_{output}[\underbrace{\left[\operatorname{Attention}\left(x_{1: L}, y\right), \ldots, \operatorname{Attention}\left(x_{1: L}, y\right)\right]}<em>{n</em>{heads}times}</span></li>
</ul>
<p>å¯¹äº<strong>è‡ªæ³¨æ„å±‚</strong>ï¼Œæˆ‘ä»¬å°†ç”¨<span class="math-inline">x_{i}</span> æ¢<span class="math-inline">y</span> ä¸ºæŸ¥è¯¢å‚æ•°æ¥äº§ç”Ÿï¼Œå…¶æœ¬è´¨ä¸Šå°±æ˜¯å°†è‡ªèº«çš„<span class="math-inline">x_{i}</span> å¥å­çš„å…¶ä»–ä¸Šä¸‹æ–‡å†…å®¹è¿›è¡Œ <span class="math-inline">Attention</span> çš„è¿ç®—ï¼š</p>
<p>def <span class="math-inline">SelfAttention(x_{1:L}:â„_{dÃ—L})â†’â„_{dÃ—L})</span> ï¼š</p>
<ul>
<li>å°†æ¯ä¸ªå…ƒç´ xiä¸å…¶ä»–å…ƒç´ è¿›è¡Œæ¯”è¾ƒã€‚ </li>
<li>è¿”å› <span class="math-inline">[Attention(x_{1:L},x_{1}),â€¦,Attention(x_{1:L},x_{L})]</span> ã€‚</li>
</ul>
<p>è‡ªæ³¨æ„åŠ›ä½¿å¾—æ‰€æœ‰çš„è¯å…ƒéƒ½å¯ä»¥â€œç›¸äº’é€šä¿¡â€ï¼Œè€Œ<strong>å‰é¦ˆå±‚</strong>æä¾›è¿›ä¸€æ­¥çš„è¿æ¥ï¼š</p>
<p>def <span class="math-inline">FeedForward(x_{1:L}:â„^{dÃ—L})â†’â„^{dÃ—L}</span> ï¼š</p>
<ul>
<li>ç‹¬ç«‹å¤„ç†æ¯ä¸ªè¯å…ƒã€‚</li>
<li>å¯¹äº <span class="math-inline">i=1,â€¦,L</span> ï¼š</li>
<li>è®¡ç®— <span class="math-inline">y_{i}=W_{2}max(W_{1}x_{i}+b_{1},0)+b_{2}</span> ã€‚</li>
<li>è¿”å› <span class="math-inline">[y_{1},â€¦,y_{L}]</span> ã€‚</li>
</ul>
<p>å¯¹äºTransformerçš„ä¸»è¦çš„ç»„ä»¶ï¼Œæˆ‘ä»¬å·®ä¸å¤šè¿›è¡Œä»‹ç»ã€‚åŸåˆ™ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥åªéœ€å°† <span class="math-inline">FeedForwardâˆ˜SelfAttention</span> åºåˆ—æ¨¡å‹è¿­ä»£96æ¬¡ä»¥æ„å»ºGPT-3ï¼Œä½†æ˜¯é‚£æ ·çš„ç½‘ç»œå¾ˆéš¾ä¼˜åŒ–ï¼ˆåŒæ ·å—åˆ°æ²¿æ·±åº¦æ–¹å‘çš„æ¢¯åº¦æ¶ˆå¤±é—®é¢˜çš„å›°æ‰°ï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»è¿›è¡Œä¸¤ä¸ªæ‰‹æ®µï¼Œä»¥ç¡®ä¿ç½‘ç»œå¯è®­ç»ƒã€‚</p>
<h5 id="æ®‹å·®è¿æ¥å’Œå½’ä¸€åŒ–">æ®‹å·®è¿æ¥å’Œå½’ä¸€åŒ–<a class="anchor-link" href="#æ®‹å·®è¿æ¥å’Œå½’ä¸€åŒ–" title="Permanent link">&para;</a></h5>
<p><strong>æ®‹å·®è¿æ¥</strong>ï¼šè®¡ç®—æœºè§†è§‰ä¸­çš„ä¸€ä¸ªæŠ€å·§æ˜¯æ®‹å·®è¿æ¥ï¼ˆResNetï¼‰ã€‚æˆ‘ä»¬ä¸ä»…åº”ç”¨æŸä¸ªå‡½æ•°fï¼š</p>
<p><div class="math-display"><br />
f(x1:L)ï¼Œ<br />
</div><br />
è€Œæ˜¯æ·»åŠ ä¸€ä¸ªæ®‹å·®ï¼ˆè·³è·ƒï¼‰è¿æ¥ï¼Œä»¥ä¾¿å¦‚æœ<span class="math-inline">f</span> æ¢¯åº¦æ¶ˆå¤±ï¼Œæ¢¯åº¦ä»ç„¶å¯ä»¥é€šè¿‡ <span class="math-inline">x_{1:L}</span> è¿›è¡Œè®¡ç®—ï¼š</p>
<p><div class="math-display"><br />
x_{1:L}+f(x_{1:L})ã€‚<br />
</div></p>
<p><strong>å±‚å½’ä¸€åŒ–</strong>:å¦ä¸€ä¸ªæŠ€å·§æ˜¯å±‚å½’ä¸€åŒ–ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªå‘é‡å¹¶ç¡®ä¿å…¶å…ƒç´ ä¸ä¼šå¤ªå¤§ï¼š</p>
<p>def <span class="math-inline">LayerNorm(x_{1:L}:â„^{dÃ—L})â†’â„^{dÃ—L}</span> ï¼š</p>
<ul>
<li>ä½¿å¾—æ¯ä¸ª <span class="math-inline">x_{i}</span> æ—¢ä¸å¤ªå¤§ä¹Ÿä¸å¤ªå°ã€‚</li>
</ul>
<p>æˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸€ä¸ªé€‚é…å™¨å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å—ä¸€ä¸ªåºåˆ—æ¨¡å‹<span class="math-inline">f</span> ä½¿å…¶â€œé²æ£’â€ï¼š</p>
<p>def <span class="math-inline">AddNorm(f:(â„d^{Ã—L}â†’â„^{dÃ—L}),x_{1:L}:â„_{dÃ—L})â†’â„^{dÃ—L}</span> ï¼š</p>
<ul>
<li>å®‰å…¨åœ°å°†fåº”ç”¨äº <span class="math-inline">x_{1:L}</span> ã€‚</li>
<li>è¿”å› <span class="math-inline">LayerNorm(x_{1:L}+f(x_{1:L}))</span> ã€‚</li>
</ul>
<p>æœ€åï¼Œæˆ‘ä»¬å¯ä»¥ç®€æ´åœ°å®šä¹‰Transformerå—å¦‚ä¸‹ï¼š</p>
<p>def <span class="math-inline">TransformerBlock(x_{1:L}:â„^{dÃ—L})â†’â„^{dÃ—L}</span> ï¼š</p>
<ul>
<li>å¤„ç†ä¸Šä¸‹æ–‡ä¸­çš„æ¯ä¸ªå…ƒç´  <span class="math-inline">x_{i}</span> ã€‚</li>
<li>è¿”å› <span class="math-inline">AddNorm(FeedForward,AddNorm(SelfAttention,x_{1:L}))</span> ã€‚</li>
</ul>
<h5 id="ä½ç½®åµŒå…¥">ä½ç½®åµŒå…¥<a class="anchor-link" href="#ä½ç½®åµŒå…¥" title="Permanent link">&para;</a></h5>
<p>æœ€åæˆ‘ä»¬å¯¹ç›®å‰è¯­è¨€æ¨¡å‹çš„<strong>ä½ç½®åµŒå…¥</strong>è¿›è¡Œè®¨è®ºã€‚æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œæ ¹æ®å®šä¹‰ï¼Œè¯å…ƒçš„åµŒå…¥ä¸ä¾èµ–äºå…¶åœ¨åºåˆ—ä¸­çš„ä½ç½®ï¼Œå› æ­¤ä¸¤ä¸ªå¥å­ä¸­çš„ğ—†ğ—ˆğ—ğ—Œğ–¾å°†å…·æœ‰ç›¸åŒçš„åµŒå…¥ï¼Œä»è€Œåœ¨å¥å­ä½ç½®çš„è§’åº¦å¿½ç•¥äº†ä¸Šä¸‹æ–‡çš„ä¿¡æ¯ï¼Œè¿™æ˜¯ä¸åˆç†çš„ã€‚</p>
<pre><code>[ğ—ğ—ğ–¾,ğ—†ğ—ˆğ—ğ—Œğ–¾,ğ–ºğ—ğ–¾,ğ—ğ—ğ–¾,ğ–¼ğ—ğ–¾ğ–¾ğ—Œğ–¾]
[ğ—ğ—ğ–¾,ğ–¼ğ—ğ–¾ğ–¾ğ—Œğ–¾,ğ–ºğ—ğ–¾,ğ—ğ—ğ–¾,ğ—†ğ—ˆğ—ğ—Œğ–¾]
</code></pre>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°†ä½ç½®ä¿¡æ¯æ·»åŠ åˆ°åµŒå…¥ä¸­ï¼š</p>
<p>def <span class="math-inline">EmbedTokenWithPosition(x_{1:L}:â„^{dÃ—L})</span> ï¼š</p>
<ul>
<li>æ·»åŠ ä½ç½®ä¿¡æ¯ã€‚</li>
<li>å®šä¹‰ä½ç½®åµŒå…¥ï¼š</li>
<li>å¶æ•°ç»´åº¦ï¼š<span class="math-inline">P_{i,2j}=sin(i/10000^{2j/dmodel})</span></li>
<li>å¥‡æ•°ç»´åº¦ï¼š<span class="math-inline">P_{i,2j+1}=cos(i/10000^{2j/dmodel})</span></li>
<li>è¿”å› <span class="math-inline">[x_1+P_1,â€¦,x_L+P_L]</span> ã€‚</li>
</ul>
<p>ä¸Šé¢çš„å‡½æ•°ä¸­ï¼Œ <span class="math-inline">i</span> è¡¨ç¤ºå¥å­ä¸­è¯å…ƒçš„ä½ç½®ï¼Œ <span class="math-inline">j</span> è¡¨ç¤ºè¯¥è¯å…ƒçš„å‘é‡è¡¨ç¤ºç»´åº¦ä½ç½®ã€‚</p>
<p>æœ€åæˆ‘ä»¬æ¥èŠä¸€ä¸‹GPT-3ã€‚åœ¨æ‰€æœ‰ç»„ä»¶å°±ä½åï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥ç®€è¦åœ°å®šä¹‰GPT-3æ¶æ„ï¼Œåªéœ€å°†Transformerå—å †å 96æ¬¡å³å¯ï¼š</p>
<p><div class="math-display"><br />
GPT-3(x_{1:L})=TransformerBlock^{96}(EmbedTokenWithPosition(x_{1:L}))<br />
</div></p>
<p>æ¶æ„çš„å½¢çŠ¶ï¼ˆå¦‚ä½•åˆ†é…1750äº¿ä¸ªå‚æ•°ï¼‰ï¼š</p>
<ul>
<li>éšè—çŠ¶æ€çš„ç»´åº¦ï¼šdmodel=12288</li>
<li>ä¸­é—´å‰é¦ˆå±‚çš„ç»´åº¦ï¼šdff=4dmodel</li>
<li>æ³¨æ„å¤´çš„æ•°é‡ï¼šnheads=96</li>
<li>ä¸Šä¸‹æ–‡é•¿åº¦ï¼šL=2048</li>
</ul>
<p>è¿™äº›å†³ç­–æœªå¿…æ˜¯æœ€ä¼˜çš„ã€‚<a href="https://arxiv.org/pdf/2006.12467.pdf">Levineç­‰äººï¼ˆ2020ï¼‰</a>æä¾›äº†ä¸€äº›ç†è®ºä¸Šçš„è¯æ˜ï¼Œè¡¨æ˜GPT-3çš„æ·±åº¦å¤ªæ·±ï¼Œè¿™ä¿ƒä½¿äº†æ›´æ·±ä½†æ›´å®½çš„Jurassicæ¶æ„çš„è®­ç»ƒã€‚</p>
<p>ä¸åŒç‰ˆæœ¬çš„Transformerä¹‹é—´å­˜åœ¨é‡è¦ä½†è¯¦ç»†çš„å·®å¼‚ï¼š</p>
<ul>
<li>å±‚å½’ä¸€åŒ–â€œåå½’ä¸€åŒ–â€ï¼ˆåŸå§‹Transformerè®ºæ–‡ï¼‰ä¸â€œå…ˆå½’ä¸€åŒ–â€ï¼ˆGPT-2ï¼‰ï¼Œè¿™å½±å“äº†è®­ç»ƒçš„ç¨³å®šæ€§ï¼ˆ<a href="http://proceedings.mlr.press/v139/davis21a/davis21a.pdf">Davisç­‰äººï¼Œ2021</a>ï¼‰ã€‚</li>
<li>åº”ç”¨äº†ä¸¢å¼ƒï¼ˆDropoutï¼‰ä»¥é˜²æ­¢è¿‡æ‹Ÿåˆã€‚</li>
<li>GPT-3ä½¿ç”¨äº†<a href="https://arxiv.org/pdf/1904.10509.pdf">sparse Transformer</a>ï¼ˆç¨€é‡Š Transformerï¼‰æ¥å‡å°‘å‚æ•°æ•°é‡ï¼Œå¹¶ä¸ç¨ å¯†å±‚äº¤é”™ä½¿ç”¨ã€‚</li>
<li>æ ¹æ®Transformerçš„ç±»å‹ï¼ˆEncdoer-Only, Decoder-Only, Encdoer-Decoderï¼‰ï¼Œä½¿ç”¨ä¸åŒçš„æ©ç æ“ä½œã€‚</li>
</ul>
<h2 id="transformer-ä¸­çš„-mask-æœºåˆ¶">Transformer ä¸­çš„ mask æœºåˆ¶<a class="anchor-link" href="#transformer-ä¸­çš„-mask-æœºåˆ¶" title="Permanent link">&para;</a></h2>
<p>åœ¨ Transformer æ¨¡å‹ä¸­ï¼Œmask æœºåˆ¶æ˜¯ä¸€ç§ç”¨äºåœ¨ self-attention ä¸­çš„æŠ€æœ¯ï¼Œç”¨ä»¥æ§åˆ¶ä¸åŒ token ä¹‹é—´çš„æ³¨æ„åŠ›äº¤äº’ã€‚å…·ä½“æ¥è¯´ï¼ŒTransformer ä¸­ä½¿ç”¨ä¸¤ç§ç±»å‹çš„ mask<strong>ï¼špadding mask</strong> å’Œ <strong>sequence mask</strong></p>
<h3 id="padding-maskå¡«å……æ©ç ">Padding maskï¼ˆå¡«å……æ©ç ï¼‰<a class="anchor-link" href="#padding-maskå¡«å……æ©ç " title="Permanent link">&para;</a></h3>
<p>Padding maskï¼ˆå¡«å……æ©ç ï¼‰ï¼šåœ¨è‡ªæ³¨æ„åŠ›æœºåˆ¶ä¸­ï¼Œå¥å­ä¸­çš„æ‰€æœ‰å•è¯éƒ½ä¼šå‚ä¸è®¡ç®—ã€‚ä½†æ˜¯ï¼Œåœ¨å®é™…çš„å¥å­ä¸­ï¼Œå¾€å¾€ä¼šå­˜åœ¨å¡«å……ç¬¦ï¼ˆæ¯”å¦‚-1ï¼‰ï¼Œç”¨æ¥å¡«å……å¥å­é•¿åº¦ä¸å¤Ÿçš„æƒ…å†µã€‚Padding mask å°±æ˜¯å°†è¿™äº›å¡«å……ç¬¦å¯¹åº”çš„ä½ç½®æ ‡è®°ä¸º 0ï¼Œä»¥ä¾¿åœ¨è®¡ç®—ä¸­å°†è¿™äº›ä½ç½®çš„å•è¯å¿½ç•¥æ‰ã€‚<br />
ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª batch_size ä¸º 3ã€å¥å­é•¿åº¦ä¸º 5 çš„è¾“å…¥åºåˆ—ï¼š</p>
<pre><code class="language-python">[
    [1, 2, 3, -1, -1],
    [2, 3, -1, -1, -1],
    [1, -1, -1, -1, -1]
]
</code></pre>
<p>å…¶ä¸­-1 è¡¨ç¤ºå¡«å……ç¬¦ï¼Œç”¨äºå¡«å……é•¿åº¦ä¸åˆ° 5 çš„ä½ç½®ã€‚åˆ™ padding mask ä¸º:</p>
<pre><code class="language-python">[
    [1, 1, 1, 0, 0],
    [1, 1, 0, 0, 0],
    [1, 0, 0, 0, 0]
]
</code></pre>
<p>å…¶ä¸­ 1 è¡¨ç¤ºå¯ä»¥å‚ä¸è®¡ç®—çš„ä½ç½®ï¼Œ0 è¡¨ç¤ºéœ€è¦è¢«å¿½ç•¥çš„ä½ç½®ã€‚ä¾‹å¦‚ï¼Œç¬¬ä¸€å¥è¯å‰ä¸‰ä¸ªä½ç½®æœ‰å…·ä½“çš„è¯ï¼Œå¯¹åº”è®¾ä¸º 1ï¼›è€Œæœ€åä¸¤ä¸ªä½ç½®æ˜¯ paddingï¼Œå¯¹åº”è®¾ä¸º 0ã€‚huggingface çš„ BertTokenizer åˆ†è¯æ‰€è¿”å›çš„ attention mask æŒ‡çš„å°±æ˜¯ <a href="https://huggingface.co/docs/transformers/glossary#attention-mask">padding mask</a>ã€‚</p>
<h3 id="sequence-maskåºåˆ—æ©ç ">Sequence maskï¼ˆåºåˆ—æ©ç ï¼‰<a class="anchor-link" href="#sequence-maskåºåˆ—æ©ç " title="Permanent link">&para;</a></h3>
<p>sequence mask ç”¨äºåœ¨ Decoder ç«¯çš„ self-attention ä¸­ï¼Œä»¥ä¿è¯åœ¨ç”Ÿæˆåºåˆ—æ—¶ä¸ä¼šå°†æœªæ¥çš„ä¿¡æ¯æ³„éœ²ç»™å½“å‰ä½ç½®çš„å•è¯ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬è¦ç”Ÿæˆä¸€ä¸ªé•¿åº¦ä¸º 5 çš„åºåˆ—ã€‚åœ¨ç¬¬ <span class="math-inline">i</span> ä¸ªä½ç½®ä¸Šç”Ÿæˆçš„å•è¯ï¼Œéœ€è¦å°†å‰ <span class="math-inline">i-1</span> ä¸ªå•è¯ä½œä¸ºè¾“å…¥ï¼Œä½†æ˜¯ä¸èƒ½å°†ç¬¬ <span class="math-inline">i</span> ä¸ªä½ç½®ä»¥åçš„å•è¯ä½œä¸ºè¾“å…¥ã€‚è¿™å°±éœ€è¦ä½¿ç”¨ sequence mask å°†ç¬¬ <span class="math-inline">i</span> ä¸ªä½ç½®ä»¥åçš„å•è¯æ©ç›–æ‰ã€‚å…·ä½“è€Œè¨€ï¼Œsequence mask ä¼šå°†ç¬¬ <span class="math-inline">i</span> ä¸ªä½ç½®ä»¥åçš„æ‰€æœ‰ä½ç½®æ ‡è®°ä¸º 0ï¼Œè¡¨ç¤ºåœ¨è®¡ç®—ä¸­éœ€è¦å¿½ç•¥è¿™äº›ä½ç½®çš„ä¿¡æ¯ã€‚</p>
<p>æœ¬æ–‡è¦æ¯”è¾ƒä¸åŒ LLM æ¶æ„ï¼Œå…¶å®æ˜¯åœ¨æ¯”è¾ƒ sequence maskã€‚äº‹å®ä¸Šï¼Œç”¨æˆ·æ‰€ä½¿ç”¨çš„ LLM æ‰€åšçš„éƒ½æ˜¯ seq2seq ä»»åŠ¡ï¼Œç”¨æˆ·è¾“å…¥ä¸€ä¸ªæ–‡æœ¬ promptï¼ŒLLM å¯¹åº”è¾“å‡ºä¸€ä¸ªæ–‡æœ¬ completionã€‚ä¸ºäº†æ–¹ä¾¿ä»¥åçš„è®¨è®ºï¼Œé‡‡ç”¨ A Survey of Large Language Models è¿™ç¯‡ç»¼è¿°ä¸­çš„ä¾‹å­ï¼Œç”¨æˆ·è¾“å…¥çš„ prompt ä¸º A Survey ofï¼ŒæœŸæœ›è¯­è¨€æ¨¡å‹çš„è¾“å‡ºä¸º Large Language Modelsã€‚</p>
<h2 id="causal-decoder">Causal Decoder<a class="anchor-link" href="#causal-decoder" title="Permanent link">&para;</a></h2>
<p>Causal LM æ˜¯å› æœè¯­è¨€æ¨¡å‹ï¼Œç›®å‰æµè¡Œçš„å¤§å¤šæ•°æ¨¡å‹éƒ½æ˜¯è¿™ç§ç»“æ„ï¼Œåˆ«æ— ä»–å› ï¼Œå› ä¸º GPT ç³»åˆ—æ¨¡å‹å†…éƒ¨ç»“æ„å°±æ˜¯å®ƒï¼Œè¿˜æœ‰å¼€æºç•Œçš„ LLaMa ä¹Ÿæ˜¯ã€‚Causal Decoder æ¶æ„çš„å…¸å‹ä»£è¡¨å°±æ˜¯ GPT ç³»åˆ—æ¨¡å‹ï¼Œ<strong>ä½¿ç”¨çš„æ˜¯å•å‘æ³¨æ„åŠ›æ©ç </strong>ï¼Œä»¥ç¡®ä¿æ¯ä¸ªè¾“å…¥ token åªèƒ½æ³¨æ„åˆ°è¿‡å»çš„ token å’Œå®ƒæœ¬èº«ï¼Œè¾“å…¥å’Œè¾“å‡ºçš„ token é€šè¿‡ Decoder ä»¥ç›¸åŒçš„æ–¹å¼è¿›è¡Œå¤„ç†ã€‚åœ¨ä¸‹å›¾ä¸­ï¼Œç°è‰²ä»£è¡¨å¯¹åº”çš„ä¸¤ä¸ª token äº’ç›¸ä¹‹é—´çœ‹ä¸åˆ°ï¼Œå¦åˆ™å°±ä»£è¡¨å¯ä»¥çœ‹åˆ°ã€‚ä¾‹å¦‚ï¼Œâ€Surveryâ€å¯ä»¥çœ‹åˆ°å‰é¢çš„â€œAâ€ï¼Œä½†æ˜¯çœ‹ä¸åˆ°åé¢çš„â€œofâ€ã€‚Causal Decoder çš„ sequence mask çŸ©é˜µæ˜¯ä¸€ç§å…¸å‹çš„ä¸‹ä¸‰è§’çŸ©é˜µã€‚</p>
<div align=center><img src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/20240417104905.png" style="zoom: 60%;" /></div>

<p>Causal LM åªæ¶‰åŠåˆ° Encoder-Decoder ä¸­çš„ Decoder éƒ¨åˆ†ï¼Œé‡‡ç”¨ Auto Regressive æ¨¡å¼ï¼Œç›´ç™½åœ°è¯´ï¼Œå°±æ˜¯æ ¹æ®å†å²çš„ token æ¥é¢„æµ‹ä¸‹ä¸€ä¸ª tokenï¼Œä¹Ÿæ˜¯åœ¨ Attention Mask è¿™é‡Œåšçš„æ‰‹è„šã€‚</p>
<p>å‚ç…§ç€ Prefix LMï¼Œå¯ä»¥çœ‹ä¸‹ Causal LM çš„ Attention Mask æœºåˆ¶(å·¦)åŠæµè½¬è¿‡ç¨‹(å³)ã€‚</p>
<div align=center><img src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/20240417105819.png"></div>

<h2 id="prefix-decoder">Prefix Decoder<a class="anchor-link" href="#prefix-decoder" title="Permanent link">&para;</a></h2>
<blockquote>
<p>Prefix LM çš„ä»£è¡¨æ¨¡å‹æœ‰ UniLMã€T5ã€GLM</p>
</blockquote>
<p>Prefix LMï¼Œå³å‰ç¼€è¯­è¨€æ¨¡å‹ï¼ŒPrefix Decoder æ¶æ„ä¹Ÿè¢«ç§°ä¸º non-causal Decoder æ¶æ„ï¼Œè¯¥ç»“æ„æ˜¯ Google çš„ T5 æ¨¡å‹è®ºæ–‡èµ·çš„åå­—ï¼Œæœ›æ–‡çŸ¥ä¹‰æ¥è¯´ï¼Œè¿™ä¸ªæ¨¡å‹çš„â€œå‰ç¼€â€æœ‰äº›å†…å®¹ï¼Œä½†ç»§ç»­å‘å‰è¿½æº¯çš„è¯ï¼Œå¾®è½¯çš„ UniLM å·²ç»æåŠåˆ°äº†ã€‚</p>
<p>Prefix LM å…¶å®æ˜¯ Encoder-Decoder æ¨¡å‹å˜ä½“ï¼š</p>
<ol>
<li>
<p>åœ¨æ ‡å‡†çš„ Encoder-Decoder æ¨¡å‹ä¸­ï¼ŒEncoder å’Œ Decoder å„è‡ªä½¿ç”¨ä¸€ä¸ªç‹¬ç«‹çš„ Transformer</p>
</li>
<li>
<p>è€Œåœ¨ Prefix LMï¼ŒEncoder å’Œ Decoder åˆ™å…±äº«äº†åŒä¸€ä¸ª Transformer ç»“æ„ï¼Œåœ¨ Transformer å†…éƒ¨é€šè¿‡ Attention Mask æœºåˆ¶æ¥å®ç°ã€‚</p>
</li>
</ol>
<p>Prefix LM æ˜¯è¾“å…¥éƒ¨åˆ†é‡‡ç”¨åŒå‘æ³¨æ„åŠ›ï¼Œè€Œè¾“å‡ºéƒ¨åˆ†é‡‡ç”¨å•å‘æ³¨æ„åŠ›ï¼›å’Œ Encoder-Decoder ä¸åŒçš„æ˜¯ï¼Œå¤„ç†è¾“å…¥å’Œè¾“å‡ºçš„æ¨¡å‹å‚æ•°æ˜¯å®Œå…¨å…±äº«çš„ï¼Œä»è¿™ä¸€ç‚¹çœ‹ï¼Œå®ƒåˆå’Œ causal Decoder æ¯”è¾ƒæ¥è¿‘ï¼Œéƒ½å±äº Decoder-Only æ¶æ„ï¼š</p>
<div align=center><img src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/20240417110738.png" /></div>

<p>ä¸æ ‡å‡† Encoder-Decoder ç±»ä¼¼ï¼ŒPrefix LM åœ¨ Encoder éƒ¨åˆ†é‡‡ç”¨ Auto Encoding (AE-è‡ªç¼–ç )æ¨¡å¼ï¼Œå³å‰ç¼€åºåˆ—ä¸­ä»»æ„ä¸¤ä¸ª token éƒ½ç›¸äº’å¯è§ï¼Œè€Œ Decoder éƒ¨åˆ†é‡‡ç”¨ Auto Regressive (AR-è‡ªå›å½’)æ¨¡å¼ï¼Œå³å¾…ç”Ÿæˆçš„ token å¯ä»¥çœ‹åˆ° Encoder ä¾§æ‰€æœ‰ token(åŒ…æ‹¬ä¸Šä¸‹æ–‡)å’Œ Decoder ä¾§å·²ç»ç”Ÿæˆçš„ tokenï¼Œä½†ä¸èƒ½çœ‹æœªæ¥å°šæœªäº§ç”Ÿçš„ tokenã€‚</p>
<p>ä¸‹é¢çš„å›¾å¾ˆå½¢è±¡åœ°è§£é‡Šäº† Prefix LM çš„ Attention Mask æœºåˆ¶(å·¦)åŠæµè½¬è¿‡ç¨‹(å³)ã€‚</p>
<div align=center><img src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/20240417110824.png" style="zoom: 60%;" /></div>

<h2 id="encoder-decoder">Encoder Decoder<a class="anchor-link" href="#encoder-decoder" title="Permanent link">&para;</a></h2>
<p>Transformer æœ€åˆè¢«æå‡ºæ¥çš„æ—¶å€™é‡‡ç”¨çš„å°±æ˜¯ Encoder-Decoder æ¶æ„ï¼Œæ¨¡å‹åŒ…å«ä¸¤éƒ¨åˆ† Encoder å’Œ Decoderï¼Œä¸¤éƒ¨åˆ†å‚æ•°ç‹¬ç«‹ã€‚å…¶ä¸­ Encoder å°†è¾“å…¥åºåˆ—å¤„ç†ä¸ºä¸€ç§ä¸­é—´è¡¨ç¤ºï¼Œè€Œ Decoder åˆ™åŸºäºä¸­é—´è¡¨ç¤ºè‡ªå›å½’åœ°ç”Ÿæˆç›®æ ‡åºåˆ—ï¼Œå…¸å‹çš„ LLM æ˜¯ Flan-T5ã€‚Encoder éƒ¨åˆ†é‡‡ç”¨åŒå‘æ³¨æ„åŠ›ï¼Œå¯¹åº”çš„ prompt çš„æ¯ä¸ª token éƒ½å¯ä»¥äº’ç›¸çœ‹åˆ°ï¼›è€Œ Decoder éƒ¨åˆ†ä»ç„¶é‡‡ç”¨å•å‘æ³¨æ„åŠ›ï¼Œå¯¹åº”çš„ completion ä»ç„¶ä¿è¯å‰é¢çš„ token çœ‹ä¸åˆ°åé¢çš„ tokenã€‚</p>
<div align=center><img src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/20240417142328.png" style="zoom: 60%;" /></div>

<h2 id="æ··åˆä¸“å®¶æ¨¡å‹">æ··åˆä¸“å®¶æ¨¡å‹<a class="anchor-link" href="#æ··åˆä¸“å®¶æ¨¡å‹" title="Permanent link">&para;</a></h2>
<h3 id="åŸºç¡€çŸ¥è¯†">åŸºç¡€çŸ¥è¯†<a class="anchor-link" href="#åŸºç¡€çŸ¥è¯†" title="Permanent link">&para;</a></h3>
<p>æ··åˆä¸“å®¶çš„æƒ³æ³•å¯ä»¥è¿½æº¯åˆ°<a href="http://www.cs.toronto.edu/~fritz/absps/jjnh91.pdf">Jacobs et al. (1991)</a>ã€‚</p>
<p><img alt="jacobs-moe" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/202409041251335.png" /></p>
<p>ä¸ºäº†ä»‹ç»åŸºæœ¬æ€æƒ³ï¼Œå‡è®¾æˆ‘ä»¬æ­£åœ¨è§£å†³ä¸€ä¸ªé¢„æµ‹é—®é¢˜ï¼š</p>
<p><div class="math-display"><br />
x \in \mathbb{R}^d \Rightarrow y \in \mathbb{R}^d.<br />
</div></p>
<p>è®©æˆ‘ä»¬ä»å­¦ä¹ å‰é¦ˆï¼ˆReLUï¼‰ç¥ç»ç½‘ç»œå¼€å§‹ï¼š</p>
<p><div class="math-display"><br />
h_\theta(x) = W_2 \max(W_1 x, 0),<br />
</div></p>
<p>å…¶ä¸­å‚æ•°ä¸º <span class="math-inline">\theta = (W_1, W_2)</span> ã€‚</p>
<ul>
<li>ç„¶è€Œï¼Œè¿™ä¸ªå‡½æ•°å¯èƒ½è¡¨è¾¾èƒ½åŠ›ä¸è¶³ã€‚</li>
<li>æˆ‘ä»¬å¯ä»¥ä½¿ç¥ç»ç½‘ç»œæ›´å®½æˆ–æ›´æ·±ã€‚</li>
</ul>
<p>ä½†ä¸“å®¶çš„æ··åˆæ–¹æ³•æ˜¯ï¼š</p>
<ul>
<li>
<p>å®šä¹‰ <span class="math-inline">E</span> ä¸ªä¸“å®¶ã€‚</p>
</li>
<li>
<p>æ¯ä¸ªä¸“å®¶ <span class="math-inline">e = 1, \dots, E</span> éƒ½å…·æœ‰è‡ªå·±çš„åµŒå…¥ <span class="math-inline">w_e \in \mathbb{R}^d</span> ã€‚</p>
</li>
<li>
<p>å°†é—¨æ§å‡½æ•°å®šä¹‰ä¸º <span class="math-inline">E</span> ä¸ªä¸“å®¶ä¸Šçš„æ¦‚ç‡åˆ†å¸ƒï¼š</p>
</li>
</ul>
<p><div class="math-display"><br />
g_e(x) = \frac{\exp(w_e \cdot x)}{\sum_{e' = 1}^E \exp(w_{e'} \cdot x)}.<br />
</div></p>
<ul>
<li>
<p>æ¯ä¸ªä¸“å®¶ <span class="math-inline">e = 1, \dots, E</span> éƒ½å…·æœ‰è‡ªå·±çš„å‚æ•° <span class="math-inline">\theta^{(e)} = (W_1^{(e)}, W_2^{(e)})</span> ã€‚</p>
</li>
<li>
<p>æ ¹æ®ä¸“å®¶ç‰¹å®šå‚æ•°å®šä¹‰æ¯ä¸ªä¸“å®¶å‡½æ•°ï¼š</p>
</li>
</ul>
<p><div class="math-display"><br />
h_{\theta_e}(x) = W_2^{(e)} \max(W_1^{(e)} x, 0).<br />
</div></p>
<ul>
<li>å°†æœ€ç»ˆå‡½æ•°å®šä¹‰ä¸ºä¸“å®¶çš„æ··åˆï¼š</li>
</ul>
<p><div class="math-display"><br />
f(x) = \sum_{e=1}^E \underbrace{g_e(x)}<em>\text{gating} \underbrace{h</em>{\theta_e}(x)}_\text{expert}.<br />
</div></p>
<h4 id="4111-ç¤ºä¾‹">4.1.1.1 ç¤ºä¾‹<a class="anchor-link" href="#4111-ç¤ºä¾‹" title="Permanent link">&para;</a></h4>
<p>è€ƒè™‘d=2ï¼Œå¹¶ä¸”æ¯ä¸ªä¸“å®¶éƒ½æ˜¯ä¸€ä¸ªçº¿æ€§åˆ†ç±»å™¨ï¼ˆ<a href="https://ieeexplore.ieee.org/stamp/stamp.jsp?arnumber=6215056">æ¥æº</a>ï¼‰ï¼š<br />
<img alt="moe-figure" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/202409041251336.png" /></p>
<h4 id="4112-è®­ç»ƒ">4.1.1.2 è®­ç»ƒ<a class="anchor-link" href="#4112-è®­ç»ƒ" title="Permanent link">&para;</a></h4>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡åå‘ä¼ æ’­æ¥å­¦ä¹ æ··åˆä¸“å®¶æ¨¡å‹ã€‚æ ¹æ®é“¾å¼æ³•åˆ™ï¼Œå¯ä»¥å¾—åˆ°ï¼š</p>
<p><div class="math-display"><br />
\nabla f(x) = \sum_{e=1}^E g_e(x) (\nabla (\log g_e(x)) h_{\theta_e}(x) + \nabla h_{\theta_e}(x)).<br />
</div></p>
<p>æ³¨æ„åˆ°ï¼Œæ¢¯åº¦ä¸ <span class="math-inline">g_e(x)</span> æˆæ¯”ä¾‹ï¼Œå¹¶ä¸”åŒæ—¶æ›´æ–°é—¨æ§å‡½æ•°å’Œä¸“å®¶ã€‚</p>
<h4 id="4113-èŠ‚çº¦è®¡ç®—">4.1.1.3 èŠ‚çº¦è®¡ç®—<a class="anchor-link" href="#4113-èŠ‚çº¦è®¡ç®—" title="Permanent link">&para;</a></h4>
<ul>
<li>æ³¨æ„åˆ°ï¼Œé—¨æ§å‡½æ•° <span class="math-inline">g(x) = [g_1(x), \dots, g_E(x)]</span> å¯¹äºæ¯ä¸ªä¸“å®¶éƒ½æ˜¯éé›¶çš„ã€‚ä¾‹å¦‚ï¼š</li>
</ul>
<p><div class="math-display"><br />
g(x) = [0.04, 0.8, 0.01, 0.15].<br />
</div></p>
<ul>
<li>
<p>æ­£å¦‚å…¬å¼æ‰€è¨€ï¼Œä¸“å®¶çš„æ··åˆä¸ä¼šèŠ‚çœä»»ä½•è®¡ç®—ï¼Œå› ä¸ºå‰å‘ä¼ æ’­ä»ç„¶éœ€è¦è¯„ä¼°æ¯ä¸ªä¸“å®¶ï¼Œè€Œåå‘ä¼ æ’­ä¹Ÿå¿…é¡»æ¥è§¦æ¯ä¸ªä¸“å®¶ã€‚</p>
</li>
<li>
<p>ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬å°†é—¨æ§å‡½æ•° <span class="math-inline">g(x) = [g_1(x), \dots, g_E(x)]</span> ä¼¼ä¸º<span class="math-inline">\tilde g(x) = [\tilde g_1(x), \dots, \tilde g_E(x)]</span> ï¼Œå…¶ä¸­å¤§å¤šæ•°ä¸“å®¶éƒ½æ˜¯é›¶ã€‚å› æ­¤ï¼Œåœ¨å‰å‘å’Œåå‘ä¼ æ’­æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨éé›¶ <span class="math-inline">\tilde g_e(x)</span> çš„ä¸“å®¶ <span class="math-inline">e</span> ã€‚</p>
</li>
</ul>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥é€‰å–å€¼æ’åå‰ä¸¤ä½ï¼ˆtop 2ï¼‰çš„ä¸“å®¶ï¼Œå¹¶é‡æ–°è§„èŒƒåŒ–ï¼š</p>
<p><div class="math-display"><br />
\tilde g(x) = [0, 0.84, 0, 0.16].<br />
</div></p>
<h4 id="4114-å¹³è¡¡ä¸“å®¶">4.1.1.4 å¹³è¡¡ä¸“å®¶<a class="anchor-link" href="#4114-å¹³è¡¡ä¸“å®¶" title="Permanent link">&para;</a></h4>
<ul>
<li>åªæœ‰æ‰€æœ‰ä¸“å®¶éƒ½å‚ä¸è¿›æ¥ï¼Œæ··åˆä¸“å®¶æ‰æœ‰æ•ˆã€‚</li>
<li>å¦‚æœåªæœ‰ä¸€ä¸ªä¸“å®¶å¤„äºæ´»è·ƒçŠ¶æ€ï¼ˆä¾‹å¦‚ï¼Œ <span class="math-inline">g(x) = [0, 1, 0, 0]</span> )ï¼Œé‚£ä¹ˆè¿™å°±æ˜¯æµªè´¹ã€‚</li>
<li>æ­¤å¤–ï¼Œå¦‚æœæˆ‘ä»¬ä¸€ç›´å¤„äºè¿™ç§çŠ¶æ€ï¼Œé‚£ä¹ˆæœªä½¿ç”¨çš„ä¸“å®¶çš„æ¢¯åº¦å°†ä¸ºé›¶ï¼Œå› æ­¤ä»–ä»¬å°†ä¸ä¼šæ”¶åˆ°ä»»ä½•æ¢¯åº¦å¹¶å¾—åˆ°æ”¹å–„ã€‚</li>
<li>å› æ­¤ï¼Œä½¿ç”¨æ··åˆä¸“å®¶çš„ä¸»è¦è€ƒè™‘å› ç´ ä¹‹ä¸€æ˜¯ç¡®ä¿æ‰€æœ‰ä¸“å®¶éƒ½èƒ½è¢«è¾“å…¥ä½¿ç”¨ã€‚</li>
</ul>
<h4 id="10115-å¹¶è¡Œ">101.1.5 å¹¶è¡Œ<a class="anchor-link" href="#10115-å¹¶è¡Œ" title="Permanent link">&para;</a></h4>
<ul>
<li>æ··åˆä¸“å®¶éå¸¸æœ‰åˆ©äºå¹¶è¡Œã€‚</li>
<li>æ¯ä¸ªä¸“å®¶éƒ½å¯ä»¥æ”¾ç½®åœ¨ä¸åŒçš„æœºå™¨ä¸Šã€‚</li>
<li>æˆ‘ä»¬å¯ä»¥åœ¨ä¸­å¿ƒèŠ‚ç‚¹è®¡ç®—è¿‘ä¼¼é—¨æ§å‡½æ•° <span class="math-inline">\tilde g(x)</span> ã€‚</li>
<li>ç„¶åï¼Œæˆ‘ä»¬åªè¦æ±‚åŒ…å«æ¿€æ´»ä¸“å®¶çš„æœºå™¨ï¼ˆç¨€ç–ï¼‰æ¥å¤„ç† <span class="math-inline">x</span> ã€‚</li>
</ul>
<h3 id="412-sparsely-gated-mixture-of-experts-lepikhin-et-al-2021">4.1.2 Sparsely-gated mixture of experts (<a href="https://arxiv.org/pdf/2006.16668.pdf">Lepikhin et al. 2021</a>)<a class="anchor-link" href="#412-sparsely-gated-mixture-of-experts-lepikhin-et-al-2021" title="Permanent link">&para;</a></h3>
<ul>
<li>ç°åœ¨æˆ‘ä»¬è€ƒè™‘å¦‚ä½•å°†æ··åˆä¸“å®¶æ€æƒ³åº”ç”¨äºè¯­è¨€æ¨¡å‹ã€‚</li>
<li>æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆæ˜¯ä»ç„¶ä½¿ç”¨96å±‚Transformerï¼Œä½†æ˜¯</li>
<li>é—¨æ§å‡½æ•°ä»¥æŸç§æ–¹å¼åº”ç”¨äºåºåˆ—ï¼›</li>
<li>åªåœ¨é¡¶å±‚è¿›è¡Œä¸“å®¶çš„ç»“åˆã€‚</li>
<li>å› æ­¤ï¼Œæˆ‘ä»¬å°†æ··åˆä¸“å®¶çš„æƒ³æ³•åº”ç”¨äºï¼š</li>
<li>æ¯ä¸ªtoken</li>
<li>æ¯å±‚Transformer blockï¼ˆæˆ–è€…éš”å±‚ä½¿ç”¨ï¼‰</li>
<li>ç”±äºå‰é¦ˆå±‚å¯¹äºæ¯ä¸ªtokenæ˜¯ç‹¬ç«‹çš„ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å°†æ¯ä¸ªå‰é¦ˆç½‘ç»œè½¬å˜ä¸ºæ··åˆä¸“å®¶ï¼ˆMoEï¼‰å‰é¦ˆç½‘ç»œï¼š</li>
</ul>
<p><div class="math-display"><br />
\text{MoETransformerBlock}(x_{1:L}) = \text{AddNorm}(\text{MoEFeedForward}, \text{AddNorm}(\text{SelfAttention}, x_{1:L})).<br />
</div></p>
<ul>
<li>éš”å±‚ä½¿ç”¨MoE Transformer blockã€‚</li>
</ul>
<p><img alt="glam-architecture" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/202409041251337.png" /></p>
<p>æˆ‘ä»¬å°†top-2ä¸“å®¶çš„è¿‘ä¼¼é—¨æ§å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p>è®¡ç®—ç¬¬ä¸€ä¸ªä¸“å®¶ï¼š <span class="math-inline">e_1 = \arg\max_e g_e(x)</span> ã€‚</p>
</li>
<li>
<p>è®¡ç®—ç¬¬äºŒä¸ªä¸“å®¶ï¼š <span class="math-inline">e_2 = \arg\max_{e \neq e_1} g_e(x)</span> ã€‚</p>
</li>
<li>
<p>å§‹ç»ˆä¿ç•™ç¬¬ä¸€ä¸ªä¸“å®¶ï¼Œå¹¶éšæœºä¿ç•™ç¬¬äºŒä¸ªä¸“å®¶ï¼š</p>
</li>
<li>è®¾ <span class="math-inline">p = \min(2 g_{e_2}(x), 1)</span> </li>
<li>åœ¨æ¦‚ç‡ä¸º <span class="math-inline">p</span> çš„æƒ…å†µä¸‹ï¼Œ <span class="math-inline">\tilde g_{e_1}(x) = \frac{g_{e_1}(x)}{g_{e_1}(x) + g_{e_2}(x)}, \tilde g_{e_2}(x) = \frac{g_{e_2}(x)}{g_{e_1}(x) + g_{e_2}(x)}</span> ã€‚å¯¹äºå…¶ä»–ä¸“å®¶ <span class="math-inline">e \not\in { e_1, e_2 }</span>ï¼Œ<span class="math-inline">\tilde g_e(x) = 0</span> ã€‚</li>
<li>åœ¨æ¦‚ç‡ä¸º <span class="math-inline">1 - p</span> çš„æƒ…å†µä¸‹ï¼Œ <span class="math-inline">\tilde g_{e_1}(x) = 1</span>ã€‚å¯¹äº<span class="math-inline">e \neq e_1</span>ï¼Œ<span class="math-inline">\tilde g_e(x) = 0 </span> ã€‚</li>
</ul>
<h4 id="4121-ç¬¦å·å®šä¹‰">4.1.2.1 ç¬¦å·å®šä¹‰<a class="anchor-link" href="#4121-ç¬¦å·å®šä¹‰" title="Permanent link">&para;</a></h4>
<ul>
<li>è®¾ <span class="math-inline">B</span> æ˜¯ä¸€ä¸ªbatchä¸­çš„tokenæ•°é‡ï¼ˆåœ¨æ‰€æœ‰åºåˆ—ä¸­ï¼‰ï¼›é€šå¸¸åœ¨ç™¾ä¸‡æ•°é‡çº§ã€‚</li>
<li>è®¾ <span class="math-inline">E</span> æ˜¯ä¸“å®¶æ•°ç›®ï¼›é€šå¸¸åœ¨åƒæ•°é‡çº§ã€‚</li>
<li>è®¾ <span class="math-inline">x_1, \dots, x_B</span> ä¸ºä¸€ä¸ªbatchä¸­çš„tokenã€‚</li>
</ul>
<h4 id="4122-å¹³è¡¡ä¸“å®¶">4.1.2.2 å¹³è¡¡ä¸“å®¶<a class="anchor-link" href="#4122-å¹³è¡¡ä¸“å®¶" title="Permanent link">&para;</a></h4>
<ul>
<li>è®¾ <span class="math-inline">c_e = \sum_{i=1}^B \mathbf{1}[\tilde g_e(x_i) &gt; 0]</span> æ˜¯ä¸“å®¶ <span class="math-inline">e</span> è¢«é€‰ä¸­çš„æ¬¡æ•°ã€‚</li>
<li>æ³¨æ„ï¼Œå¤„ç†å®Œä¸€ä¸ªbatchåï¼Œ <span class="math-inline">\sum_e c_e = B</span> ã€‚</li>
<li>å¦‚æœæ‰€æœ‰ä¸“å®¶éƒ½æ˜¯å¹³è¡¡çš„ï¼Œé‚£ä¹ˆ <span class="math-inline">c_e = \frac{B}{E}</span> ã€‚</li>
<li>æº¢å‡ºï¼šå¦‚æœ <span class="math-inline">c_e &gt; 2 \frac{B}{E}</span> ï¼Œåˆ™è®¾ <span class="math-inline">f(x) = x</span> ï¼ˆå¸¦æ®‹å·®çš„æ—è·¯ï¼‰ï¼Œå…¶ä¸­2æ˜¯å®¹é‡ç³»æ•°ã€‚</li>
<li>è¾…åŠ©æŸå¤±ï¼šæˆ‘ä»¬æœŸæœ› <span class="math-inline">c = [c_1, \dots, c_E]</span> æ¥è¿‘å‡åŒ€åˆ†å¸ƒã€‚</li>
<li>æˆ‘ä»¬å¯ä»¥æƒ©ç½š <span class="math-inline">|c|<em>2^2 = \sum</em>{e=1}^E c_e^2</span> ï¼Œä½†è¿™æ˜¯ä¸å¯å¾®åˆ†çš„ã€‚</li>
<li>å®šä¹‰ <span class="math-inline">m_e = \sum_{i = 1}^B g_e(x_i)</span> ï¼ˆè¿™æ˜¯ <span class="math-inline">c_e</span> çš„è½¯ç‰ˆæœ¬)ã€‚</li>
<li>ç›¸åï¼Œæˆ‘ä»¬åœ¨ç›®æ ‡å‡½æ•°ä¸­æ·»åŠ  <span class="math-inline">\text{load-balancing-loss} = \sum_{e=1}^E m_e c_e</span> ã€‚è¿™æ ·ï¼Œé€šè¿‡ <span class="math-inline">m_e</span> çš„æ¢¯åº¦å°†ä¸ºéé›¶ã€‚</li>
</ul>
<p><span class="math-inline">\text{loss} = \text{negative-log-likelihood} + \lambda \text{load-balancing-loss}.</span></p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å– <span class="math-inline">\lambda = \frac{0.01}{B}</span> ã€‚</p>
<h4 id="4123-ç¤ºä¾‹">4.1.2.3 ç¤ºä¾‹<a class="anchor-link" href="#4123-ç¤ºä¾‹" title="Permanent link">&para;</a></h4>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ª <span class="math-inline">B=2</span> ä¸ªtokenï¼Œ <span class="math-inline">E=4</span>  ä¸ªä¸“å®¶çš„ä¾‹å­ï¼š</p>
<p><div class="math-display"><br />
g(x_1) = [0.2, 0.6, 0.1, 0.1] \Rightarrow \tilde g(x_1) = [0.25, 0.75, 0, 0] \<br />
g(x_2) = [0.1, 0.6, 0.2, 0.1] \Rightarrow \tilde g(x_2) = [0, 0.75, 0.25, 0]<br />
</div></p>
<p>ç»Ÿè®¡ä¸º</p>
<p><div class="math-display"><br />
c = [1, 2, 1, 0] \quad\quad\quad\quad m = [0.3, 1.2, 0.3, 0.2]<br />
</div></p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä¼šå°è¯•é™ä½ä¸“å®¶2çš„æƒé‡ï¼Œé¿å…å…¶è¢«è¿‡åº¦ä½¿ç”¨ã€‚</p>
<h3 id="413-switch-transformer-fedus-et-al-2021">4.1.3 Switch Transformer (<a href="https://arxiv.org/pdf/2101.03961.pdf">Fedus et al. 2021</a>)<a class="anchor-link" href="#413-switch-transformer-fedus-et-al-2021" title="Permanent link">&para;</a></h3>
<ul>
<li>å®šä¹‰è¿‘ä¼¼é—¨æ§å‡½æ•° <span class="math-inline">\tilde g(x)</span> åªæœ‰ä¸€ä¸ªä¸“å®¶ï¼ˆè·å¾—æ›´å¤šç¨€ç–æ€§ï¼‰ã€‚</li>
<li>æŠ€å·§ï¼š</li>
<li>å°†FP32è®­ç»ƒæ›¿æ¢æˆFP16</li>
<li>ä½¿ç”¨çš„è¾ƒå°å‚æ•°è¿›è¡Œåˆå§‹åŒ–</li>
<li>ä¸“å®¶dropout</li>
<li>ä¸“å®¶å¹¶è¡Œ</li>
<li>è®­ç»ƒäº†ä¸€ä¸ª1.6ä¸‡äº¿å‚æ•°æ¨¡å‹</li>
<li>ä¸T5-XXLï¼ˆ110äº¿å‚æ•°ï¼‰ç›¸æ¯”ï¼Œè®­ç»ƒé€Ÿåº¦æé«˜äº†4å€</li>
</ul>
<h3 id="414-balanced-assignment-of-sparse-experts-base-layers-lewis-et-al-2021">4.1.4 Balanced Assignment of Sparse Experts (BASE) layers (<a href="https://arxiv.org/pdf/2103.16716.pdf">Lewis et al., 2021</a>)<a class="anchor-link" href="#414-balanced-assignment-of-sparse-experts-base-layers-lewis-et-al-2021" title="Permanent link">&para;</a></h3>
<ul>
<li>BASEå°†è¿‘ä¼¼é—¨æ§å‡½æ•° <span class="math-inline">\tilde g(x)</span> å®šä¹‰ä¸ºå¯¹batchä¸­çš„æ‰€æœ‰tokenè¿›è¡Œè”åˆä¼˜åŒ–çš„ç»“æœã€‚</li>
<li>æˆ‘ä»¬å°†ä¸ºæ¯ä¸ªtokenåˆ†é…1åä¸“å®¶ï¼Œä½†è´Ÿè½½å¹³è¡¡æ˜¯ä¸€ç§çº¦æŸï¼Œè€Œä¸æ˜¯è½¯æƒ©ç½šã€‚</li>
<li>æˆ‘ä»¬å®šä¹‰ <span class="math-inline">a = [a_1, \dots, a_B] \in {1, \dots, E}^B</span> ä½œä¸ºè”åˆåˆ†é…å‘é‡ã€‚</li>
</ul>
<p><div class="math-display"><br />
\text{maximize} \sum_{i = 1}^B w_{a_i} \cdot x_i \quad\text{subject to}\quad \forall e: \sum_{i=1}^B \mathbf{1}[a_i = e] = \frac{B}{E}.<br />
</div></p>
<ul>
<li>è¿™æ˜¯ä¸€ä¸ªå¯ä»¥æœ‰æ•ˆæ±‚è§£çš„çº¿æ€§æ–¹ç¨‹ã€‚</li>
<li>åœ¨å®è·µä¸­ï¼Œæˆ‘ä»¬å°†çº¿æ€§æ–¹ç¨‹å¹¶è¡ŒåŒ–ã€‚</li>
<li>åœ¨æµ‹è¯•æ—¶ï¼Œåªéœ€é€‰æ‹©top 1çš„ä¸“å®¶å³å¯ã€‚</li>
</ul>
<h4 id="4141-å®éªŒè®¾ç½®">4.1.4.1 å®éªŒè®¾ç½®<a class="anchor-link" href="#4141-å®éªŒè®¾ç½®" title="Permanent link">&para;</a></h4>
<ul>
<li>Sparsely gated MoE (top-2 experts): 52.5B å‚æ•°</li>
<li>Switch Transformer (top-1 expert): 52.5B å‚æ•°</li>
<li>BASE (1 jointly optimized expert): 44.4B å‚æ•° (1.3B shared å‚æ•°, 335M x 128 expert å‚æ•°)</li>
</ul>
<p><img alt="base-results" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/202409041251338.png" /></p>
<p>BASEéœ€è¦æ›´å¤šçš„è®¡ç®—æ¥ä¼˜åŒ– <span class="math-inline">a</span> ï¼Œä½†æ›´ç¨³å®šã€‚</p>
<h4 id="4142-æ€»ç»“å’Œä¸‹ä¸€æ­¥å·¥ä½œ">4.1.4.2 æ€»ç»“å’Œä¸‹ä¸€æ­¥å·¥ä½œ<a class="anchor-link" href="#4142-æ€»ç»“å’Œä¸‹ä¸€æ­¥å·¥ä½œ" title="Permanent link">&para;</a></h4>
<ul>
<li>Switch Transformerï¼ˆè°·æ­Œï¼‰ä½¿ç”¨äº†top-1ä¸“å®¶ã€‚</li>
<li>BASEï¼ˆFacebookï¼‰ä¸ºæ¯ä¸ªtokenåˆ†é…1åä¸“å®¶ï¼Œä½†è¿›è¡Œäº†è”åˆä¼˜åŒ–ã€‚</li>
<li>è¿™ä¸¤ä¸ªæ¨¡å‹çš„æ€§èƒ½éƒ½æ— æ³•ä¸GPT-3å¯æ¯”ã€‚è™½ç„¶è°·æ­Œå’ŒFacebookéƒ½å‘å¸ƒäº†ä¸¤ä¸ªæœ€æ–°çš„é«˜æ€§èƒ½MoEè¯­è¨€æ¨¡å‹ï¼Œå®ƒä»¬çš„æ€§èƒ½ç¡®å®ä¸GPT-å¯æ¯”ï¼Œä½†æœ‰è¶£çš„æ˜¯ï¼Œå®ƒä»¬ä»ç„¶åŸºäºæœ€åˆç®€å•çš„top-2ä¸“å®¶ï¼š</li>
<li>è°·æ­Œçš„GLaM</li>
<li>æ¥è‡ªFacebookçš„â€œFacebookMoEâ€</li>
</ul>
<h3 id="415-generalist-language-model-glam-du-et-al-2021">4.1.5 Generalist Language Model (GLaM) (<a href="https://arxiv.org/pdf/2112.06905.pdf">Du et al. 2021</a>)<a class="anchor-link" href="#415-generalist-language-model-glam-du-et-al-2021" title="Permanent link">&para;</a></h3>
<h4 id="4151-è§„æ ¼">4.1.5.1 è§„æ ¼<a class="anchor-link" href="#4151-è§„æ ¼" title="Permanent link">&para;</a></h4>
<ul>
<li>1.2ä¸‡äº¿ä¸ªå‚æ•°ï¼ˆGPT-3æœ‰1750äº¿ä¸ªå‚æ•°ï¼‰</li>
<li>64ä¸ªä¸“å®¶ï¼Œ64å±‚ï¼Œ32Kä¸ªéšè—å•å…ƒ</li>
<li>æ¯ä¸ªtokenæ¿€æ´»95Bï¼ˆ1.2Tçš„8%ï¼‰çš„å‚æ•°</li>
</ul>
<h4 id="4152-å…¶ä»–">4.1.5.2 å…¶ä»–<a class="anchor-link" href="#4152-å…¶ä»–" title="Permanent link">&para;</a></h4>
<ul>
<li>åˆ›å»ºäº†å…±æœ‰1.6ä¸‡äº¿ä¸ªtokençš„æ–°æ•°æ®é›†ï¼ˆGLaM datasetï¼‰ï¼Œæ¥æºåŒ…æ‹¬ç½‘é¡µã€è®ºå›ã€ä¹¦ç±ã€æ–°é—»ç­‰ã€‚</li>
<li>ç›¸å¯¹ä½ç½®ç¼–ç ã€é—¨æ§çº¿æ€§å•å…ƒã€GeLUæ¿€æ´»å‡½æ•°ã€RMSNormï¼ˆéLayerNormï¼‰</li>
<li>å¦‚æœé‡åˆ°NaN/Infï¼Œè·³è¿‡æƒé‡æ›´æ–°/å›æ»šåˆ°æ—©æœŸæ£€æŸ¥ç‚¹ã€‚</li>
<li>â€œé€šè¿‡ä»”ç»†å®æ–½ä¸Šè¿°æŠ€å·§ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°ï¼Œç¨€ç–æ¿€æ´»çš„æ¨¡å‹åœ¨å„ä¸ªå°ºåº¦ä¸Šçš„è®­ç»ƒéƒ½å˜å¾—ç›¸å½“ç¨³å®šã€‚â€</li>
</ul>
<h4 id="4153-ç»“æœ">4.1.5.3 ç»“æœ<a class="anchor-link" href="#4153-ç»“æœ" title="Permanent link">&para;</a></h4>
<ul>
<li>ä¸GPT-3ç›¸æ¯”ï¼Œè®­ç»ƒæˆæœ¬ä»…ä¸º1/3</li>
<li>åœ¨ä¸GPT-3ç›¸åŒçš„åŸºå‡†ä¸Šè¿›è¡Œè¯„ä¼°ï¼ˆå¼€æ”¾åŸŸé—®ç­”ã€é˜…è¯»ç†è§£ã€SuperGLUEç­‰ï¼‰</li>
<li>ä¸GPT-3ç›¸æ¯”ï¼Œå®ç°äº†æ›´å¥½çš„0-shotå’Œ1-shotæ€§èƒ½ï¼ˆå°¤å…¶æ˜¯åœ¨çŸ¥è¯†å¯†é›†å‹ä»»åŠ¡ä¸­çš„æ€§èƒ½ï¼‰</li>
<li>æ³¨ï¼šä»–ä»¬æ²¡æœ‰åœ¨GPT-3æ›´å¼ºçš„few-shotä¸­è¿›è¡Œè¯„ä¼°</li>
</ul>
<p><img alt="glam-results2" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/202409041251339.png" /></p>
<p><img alt="glam-trivia-qa" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/202409041251340.png" /></p>
<h4 id="4154-winogenderä¸Šçš„ç»“æœ">4.1.5.4 WinoGenderä¸Šçš„ç»“æœ<a class="anchor-link" href="#4154-winogenderä¸Šçš„ç»“æœ" title="Permanent link">&para;</a></h4>
<p>ç¤ºä¾‹ï¼š<em>The nurse notified the patient that </em><em>{her/his,their}</em><em> shift would be ending in an hour.</em></p>
<p>GLaMçš„æ€§åˆ«åè§å°‘äºGPT-3ã€‚</p>
<h3 id="416-facebookmoe-artetxe-et-al-2021">4.1.6 FacebookMoE (<a href="https://arxiv.org/pdf/2112.10684.pdf">Artetxe et al., 2021</a>)<a class="anchor-link" href="#416-facebookmoe-artetxe-et-al-2021" title="Permanent link">&para;</a></h3>
<h4 id="4161-å®éªŒè®¾ç½®">4.1.6.1 å®éªŒè®¾ç½®<a class="anchor-link" href="#4161-å®éªŒè®¾ç½®" title="Permanent link">&para;</a></h4>
<ul>
<li>è®­ç»ƒäº†ä¸€ä¸ª1.1Tå‚æ•°çš„æ¨¡å‹</li>
<li>512åä¸“å®¶ï¼ˆè¶…è¿‡GLaMï¼‰ï¼Œ32å±‚ï¼Œ4096ä¸ªéšè—å•å…ƒ</li>
<li>ä½¿ç”¨112 billion tokenè¿›è¡Œè®­ç»ƒï¼Œæ¥æºåŒ…æ‹¬ç½‘é¡µã€è®ºå›ã€ä¹¦ç±ã€æ–°é—»ç­‰ã€‚</li>
<li>å°æ¨¡å‹æ”¶ç›Šæ›´å¤§ï¼Œæ¨¡å‹è¶Šå¤§ï¼Œæ”¶ç›Šé€’å‡</li>
</ul>
<p><img alt="facebook-moe-results" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/202409041251341.png" /></p>
<p><a href="https://stereoset.mit.edu/explore/dev/">StereoSet</a>ä¸Šçš„ç»“æœï¼š</p>
<h4 id="4162-ç¤ºä¾‹">4.1.6.2 ç¤ºä¾‹<a class="anchor-link" href="#4162-ç¤ºä¾‹" title="Permanent link">&para;</a></h4>
<p><em>The assistant went to work. {She brought her boss coffee., She was valued for her input.}</em></p>
<p>åˆ»æ¿å°è±¡éšç€æ¨¡å‹å¤§å°çš„å¢åŠ è€Œå˜å¾—æ›´ç³Ÿï¼ˆä¸GLaMç»“æœç›¸åï¼‰ã€‚</p>
<p><img alt="facebook-moe-stereoset" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/202409041251342.png" /></p>
<h3 id="417-decentralized-mixture-of-experts-ryabinin--gusev-2020">4.1.7 Decentralized mixture-of-experts (<a href="https://arxiv.org/pdf/2002.04013.pdf">Ryabinin &amp; Gusev, 2020</a>)<a class="anchor-link" href="#417-decentralized-mixture-of-experts-ryabinin--gusev-2020" title="Permanent link">&para;</a></h3>
<h4 id="4171-åŠ¨æœº">4.1.7.1 åŠ¨æœº<a class="anchor-link" href="#4171-åŠ¨æœº" title="Permanent link">&para;</a></h4>
<ul>
<li>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ··åˆä¸“å®¶çº¯ç²¹æ˜¯ä¸­å¿ƒæœºæ„ï¼ˆå¦‚è°·æ­Œæˆ–Facebookï¼‰ä»æ‰©å¤§å¤§è¯­è¨€æ¨¡å‹çš„è§’åº¦å‡ºå‘çš„ã€‚</li>
<li>ç„¶è€Œï¼Œæ··åˆä¸“å®¶è‡ªç„¶åœ°æŒ‡ç¤ºäº†ä¸€ç§æ›´æ¿€è¿›çš„æƒåŠ›ä¸‹æ”¾ã€‚</li>
<li>ä¸ºä¾‹è®­ç»ƒGPT-3ï¼Œ<a href="https://blogs.microsoft.com/ai/openai-azure-supercomputer/">Azureè¶…çº§è®¡ç®—æœºé›†ç¾¤</a>è€—èµ„2.5äº¿ç¾å…ƒã€‚</li>
<li>æˆ‘ä»¬å¦‚ä½•åˆ©ç”¨<a href="https://lisbdnet.com/how-many-computers-are-there-in-the-world/">æ•°ä»¥äº¿è®¡</a>çš„æ¶ˆè´¹PCï¼Ÿ</li>
<li><a href="https://foldingathome.org/">Folding@Home</a>æ˜¯ä¸€ä¸ªå¿—æ„¿è€…è®¡ç®—é¡¹ç›®ï¼Œåˆ©ç”¨ä¸–ç•Œå„åœ°çš„å¿—æ„¿è€…æèµ è®¡ç®—æœºè¿›è¡Œåˆ†å­åŠ¨åŠ›å­¦æ¨¡æ‹Ÿã€‚</li>
<li>2020å¹´4æœˆï¼ŒFolding@Homeæœ‰70ä¸‡äººæèµ äº†äº§ç”Ÿ2.43 exaFLOPï¼ˆGPT-3éœ€è¦350åƒå…†FLOPï¼‰ï¼ˆ<a href="https://www.sciencealert.com/so-many-people-are-running-folding-home-that-it-s-created-the-world-s-biggest-supercomputer">æ–‡ç« </a>ï¼‰ã€‚</li>
<li>ä¸»è¦åŒºåˆ«åœ¨äºåˆ†å­åŠ¨åŠ›å­¦æ¨¡æ‹Ÿè®¡ç®—é‡å¤§ï¼Œä¸éœ€è¦ç½‘ç»œå¸¦å®½ã€‚</li>
</ul>
<h4 id="4172-ä¸»è¦è€ƒè™‘å› ç´ ">4.1.7.2 ä¸»è¦è€ƒè™‘å› ç´ <a class="anchor-link" href="#4172-ä¸»è¦è€ƒè™‘å› ç´ " title="Permanent link">&para;</a></h4>
<ul>
<li>èŠ‚ç‚¹ä¼—å¤šï¼ˆ <span class="math-inline">10^3 \sim 10^6</span> å¼‚æ„PCï¼‰</li>
<li>é¢‘ç¹çš„èŠ‚ç‚¹æ•…éšœï¼ˆ5-20%çš„èŠ‚ç‚¹æ¯å¤©è‡³å°‘æœ‰ä¸€æ¬¡æ•…éšœï¼‰</li>
<li>å®¶åº­äº’è”ç½‘é€šä¿¡å¸¦å®½ï¼ˆ100Mbpsï¼›ç›¸æ¯”ä¹‹ä¸‹ï¼ŒAzureè¶…çº§è®¡ç®—æœºä¸º400Gbpsï¼‰</li>
</ul>
<h4 id="4173-åˆ†å¸ƒå¼å“ˆå¸Œè¡¨">4.1.7.3 åˆ†å¸ƒå¼å“ˆå¸Œè¡¨<a class="anchor-link" href="#4173-åˆ†å¸ƒå¼å“ˆå¸Œè¡¨" title="Permanent link">&para;</a></h4>
<ul>
<li><span class="math-inline">N</span> ä¸ªèŠ‚ç‚¹</li>
<li>å•ä¸ªèŠ‚ç‚¹éœ€è¦ä¸å…¶ä»– <span class="math-inline">O(\log N)</span> èŠ‚ç‚¹é€šä¿¡</li>
<li>ä½¿ç”¨Kademlia DHTåè®®ï¼ˆè¢«BitTorrentå’Œä»¥å¤ªåŠä½¿ç”¨ï¼‰</li>
</ul>
<p><img alt="dmoe" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/202409041251343.png" /></p>
<h4 id="4174-è®ºæ–‡å®éªŒ">4.1.7.4 è®ºæ–‡å®éªŒ<a class="anchor-link" href="#4174-è®ºæ–‡å®éªŒ" title="Permanent link">&para;</a></h4>
<ul>
<li>é€‰å–top-4çš„ä¸“å®¶ï¼ˆå…±256åä¸“å®¶ï¼‰</li>
<li>æ¯ä¸ªä¸“å®¶éƒ½æ˜¯ä¸€ä¸ªTransformerå±‚</li>
<li>åœ¨4ä¸ªGPUä¸Šè®­ç»ƒäº†ä¸€ä¸ªå°å‹Transformer LM</li>
</ul>
<h3 id="418-diskin-et-al-2021">4.1.8 <a href="https://arxiv.org/pdf/2106.10207.pdf">Diskin et al., 2021</a><a class="anchor-link" href="#418-diskin-et-al-2021" title="Permanent link">&para;</a></h3>
<ul>
<li>40åå¿—æ„¿è€…</li>
<li>ä¸ºå­ŸåŠ æ‹‰è¯­è®­ç»ƒäº†ä¸€ä¸ªALBERTçš„æ©ç è¯­è¨€æ¨¡å‹</li>
<li><a href="&quot;https://training-transformers-together.github.io/">ä¸€èµ·è®­ç»ƒTransformer</a>ï¼šä»»ä½•äººéƒ½å¯ä»¥åŠ å…¥å¹¶è´¡çŒ®è®¡ç®—</li>
</ul>
<p><img alt="volunteer-dall-e" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/202409041251344.png" /></p>
<h3 id="419-æ€»ç»“">4.1.9 æ€»ç»“<a class="anchor-link" href="#419-æ€»ç»“" title="Permanent link">&para;</a></h3>
<ul>
<li>æ··åˆä¸“å®¶ï¼šèµ·æºäºå°†ä¸åŒä¸“å®¶åº”ç”¨äºä¸åŒè¾“å…¥çš„ç»å…¸ç†å¿µ</li>
<li>å…è®¸è®­ç»ƒæ›´å¤§çš„è¯­è¨€æ¨¡å‹ï¼ˆ1.1ä¸‡äº¿ä¸ªå‚æ•°ï¼‰</li>
<li>ä¸ç¨ å¯†Transformeræ¨¡å‹ç›¸æ¯”ï¼Œæ¯ä¸ªè¾“å…¥çš„æ•ˆç‡é«˜å¾—å¤šï¼ˆFLOPæ›´å°‘ï¼‰</li>
<li>æ•ˆæœéš¾ä»¥æ¯”è¾ƒï¼šåœ¨ç›¸åŒè§„æ¨¡ä¸Šï¼Œç›´æ¥æ¯”è¾ƒä»ç„¶å…·æœ‰æŒ‘æˆ˜æ€§ï¼ˆGPT-3ä¸GLaMä¸FacebookMoEï¼‰</li>
<li>å¯¹æƒåŠ›ä¸‹æ”¾çš„é‡å¤§å½±å“</li>
</ul>
<h2 id="42-åŸºäºæ£€ç´¢çš„æ¨¡å‹">4.2 åŸºäºæ£€ç´¢çš„æ¨¡å‹<a class="anchor-link" href="#42-åŸºäºæ£€ç´¢çš„æ¨¡å‹" title="Permanent link">&para;</a></h2>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬è½¬å‘å¦ä¸€ç±»è¯­è¨€æ¨¡å‹ï¼ŒåŸºäºæ£€ç´¢çš„ï¼ˆæˆ–æ£€ç´¢å¢å¼ºçš„ã€è®°å¿†å¢å¼ºçš„æ¨¡å‹ï¼‰ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬çªç ´ç¨ å¯†Transformerçš„ç¼©æ”¾ä¸Šé™ã€‚</p>
<h3 id="421-ç¼–ç å™¨-è§£ç å™¨">4.2.1 ç¼–ç å™¨-è§£ç å™¨<a class="anchor-link" href="#421-ç¼–ç å™¨-è§£ç å™¨" title="Permanent link">&para;</a></h3>
<p>è®©æˆ‘ä»¬é¦–å…ˆå…³æ³¨ä½¿ç”¨ç¼–ç å™¨-è§£ç å™¨æ¡†æ¶çš„åºåˆ—åˆ°åºåˆ—ä»»åŠ¡ï¼š</p>
<p><div class="math-display"><br />
\text{input } x \quad\Rightarrow\quad \text{output } y<br />
</div></p>
<p>ç¤ºä¾‹ï¼ˆå¼€æ”¾é—®ç­”ï¼‰ï¼š</p>
<ul>
<li>è¾“å…¥<span class="math-inline">x</span>ï¼šWhat is the capital of Canada?</li>
<li>è¾“å‡º<span class="math-inline">y</span>ï¼šOttawa</li>
</ul>
<p>å›æƒ³ä¸€ä¸‹ï¼Œ<a href="https://arxiv.org/pdf/1910.13461.pdf">BART</a>å’Œ<a href="https://arxiv.org/pdf/1910.10683.pdf">T5</a>æ˜¯ç¼–ç å™¨-è§£ç å™¨æ¨¡å‹çš„ä»£è¡¨ï¼š</p>
<p><div class="math-display"><br />
p(y \mid x)<br />
</div></p>
<p>å…¶ä½¿ç”¨å»å™ªç›®æ ‡å‡½æ•°è¿›è¡Œè®­ç»ƒã€‚<br />
ä¾‹å¦‚ï¼š<br />
è¾“å…¥ <span class="math-inline">x</span> ï¼šThank you <span class="math-inline"><X></span> me to your party <span class="math-inline"><Y></span> week.<br />
è¾“å‡º <span class="math-inline">y</span> ï¼š <span class="math-inline"><X></span> for inviting <span class="math-inline"><Y></span> last</p>
<h3 id="1022-æ£€ç´¢æ–¹æ³•">10.2.2 æ£€ç´¢æ–¹æ³•<a class="anchor-link" href="#1022-æ£€ç´¢æ–¹æ³•" title="Permanent link">&para;</a></h3>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå­˜å‚¨åº“ <span class="math-inline">S</span> ï¼Œå®ƒæ˜¯ä¸€ç»„åºåˆ—ï¼ˆé€šå¸¸æ˜¯æ–‡æ¡£æˆ–æ®µè½ï¼‰çš„é›†åˆã€‚</p>
<p><div class="math-display"><br />
S = { \text{Why is the...}, \text{Thanks for}, ..., \text{The quick...}, \text{Stanford...} }.<br />
</div></p>
<p>åŸºäºæ£€ç´¢çš„æ¨¡å‹ç›´è§‚çš„ç”Ÿæˆè¿‡ç¨‹ï¼š</p>
<ul>
<li>åŸºäºè¾“å…¥ <span class="math-inline">x</span> ï¼Œæ£€ç´¢ç›¸å…³åºåˆ— <span class="math-inline">z</span> ã€‚</li>
<li>ç»™å®šæ£€ç´¢åºåˆ— <span class="math-inline">z</span> å’Œè¾“å…¥ <span class="math-inline">x</span> ï¼Œç”Ÿæˆè¾“å‡º <span class="math-inline">y</span> ã€‚</li>
</ul>
<p>ç¤ºä¾‹ï¼ˆå¼€æ”¾é—®ç­”ï¼‰ï¼š</p>
<ul>
<li>è¾“å…¥ <span class="math-inline">x</span> ï¼šWhat is the capital of Canada?</li>
<li>æ£€ç´¢ <span class="math-inline">z</span> ï¼šOttawa is the capital city of Canada.</li>
<li>è¾“å‡º <span class="math-inline">y</span> ï¼šOttawa</li>
</ul>
<p>æœ€è¿‘é‚»æ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§æ£€ç´¢æ–¹æ³•ï¼š</p>
<ul>
<li><span class="math-inline">S</span> æ˜¯è®­ç»ƒé›†ã€‚</li>
<li>æ£€ç´¢ <span class="math-inline">(x',y') \in S</span> ï¼Œä½¿å¾— <span class="math-inline">x'</span> å’Œ <span class="math-inline">x </span> ç›¸ä¼¼ã€‚</li>
<li>ç”Ÿæˆ <span class="math-inline">y = y'</span> ã€‚</li>
</ul>
<h3 id="1023-retrieval-augmented-generation-rag-lewis-et-al-2020">10.2.3 Retrieval-augmented generation (RAG) (<a href="https://arxiv.org/pdf/2005.11401.pdf">Lewis et al., 2020</a>)<a class="anchor-link" href="#1023-retrieval-augmented-generation-rag-lewis-et-al-2020" title="Permanent link">&para;</a></h3>
<p><img alt="rag-architecture" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/202409041251345.png" /></p>
<p>å½¢å¼ä¸Šï¼ŒRAGæ¨¡å‹å®šä¹‰å¦‚ä¸‹ï¼š</p>
<p><div class="math-display"><br />
(y \mid x) = \sum_{z \in S} \underbrace{p(z \mid x)}<em>\text{retriever} \underbrace{p(y \mid z, x)}</em>\text{generator}.<br />
</div></p>
<p>åœ¨å®è·µä¸­ï¼Œ <span class="math-inline">\sum_{z \in S}</span> ç”±å‰kä¸ªä»£æ›¿ï¼ˆç±»ä¼¼äºä¸ºæ··åˆä¸“å®¶é€‰æ‹©å‰1ä¸ªæˆ–2ä¸ªä¸“å®¶ï¼‰ã€‚</p>
<h4 id="10231-æ£€ç´¢å™¨">10.2.3.1 æ£€ç´¢å™¨<a class="anchor-link" href="#10231-æ£€ç´¢å™¨" title="Permanent link">&para;</a></h4>
<p>Dense Passage Retrieval (DPR)** (<a href="https://arxiv.org/pdf/2004.04906.pdf">Karpukhin et al., 2020</a>)</p>
<p><div class="math-display"><br />
p(z \mid x) = \frac{\exp(\text{BERT}<em>\text{d}(z) \cdot \text{BERT}</em>\text{q}(x))}{\sum_{z' \in S} \exp(\text{BERT}<em>\text{d}(z') \cdot \text{BERT}</em>\text{q}(x))}.<br />
</div></p>
<ul>
<li>è¿™é‡Œä»¥ç”¨ç»´åŸºç™¾ç§‘æ–‡ç« çš„æ ‡é¢˜æ¥æ£€ç´¢æ®µè½ä¸ºä¾‹</li>
<li>ä½¿ç”¨QAæ•°æ®é›†ï¼ˆå¦‚NaturalQuestionsã€TriviQAç­‰ï¼‰çš„queryã€æ­£ä¾‹ã€è´Ÿä¾‹ <span class="math-inline">(q, p^+, p^-_1, \dots, p^-_n)</span> æ¥è®­ç»ƒæ¨¡å‹ï¼š</li>
<li>è´Ÿä¾‹ï¼šéšæœºæˆ–è€…ä½¿ç”¨BM25æ£€ç´¢å‡ºçš„ä¸åŒ…å«ç­”æ¡ˆçš„æ®µè½</li>
<li>æ¨ç†ï¼šä½¿ç”¨<a href="https://github.com/facebookresearch/faiss">FAISS</a>ï¼ˆFacebook AIç›¸ä¼¼æ€§æœç´¢ï¼‰</li>
</ul>
<h4 id="10232-ç”Ÿæˆå™¨">10.2.3.2 ç”Ÿæˆå™¨<a class="anchor-link" href="#10232-ç”Ÿæˆå™¨" title="Permanent link">&para;</a></h4>
<p><div class="math-display"><br />
p(y \mid z, x) = p(y \mid \text{concat}(z, x)).<br />
</div></p>
<ul>
<li>ä½¿ç”¨BART-largeï¼ˆ400Må‚æ•°ï¼‰ï¼Œå…¶ä¸­è¾“å…¥ä¸ºæ£€ç´¢å‡ºçš„æ®µè½ <span class="math-inline">z</span> å’Œè¾“å…¥ <span class="math-inline">x</span></li>
<li>å›æƒ³ä¸€ä¸‹ï¼ŒBARTæ˜¯åŸºäºç½‘ç»œã€æ–°é—»ã€ä¹¦ç±å’Œæ•…äº‹æ•°æ®ï¼Œä½¿ç”¨å»å™ªç›®æ ‡å‡½æ•°ï¼ˆä¾‹å¦‚ï¼Œæ©ç ï¼‰è®­ç»ƒå¾—åˆ°çš„</li>
</ul>
<h4 id="10233-è®­ç»ƒ">10.2.3.3 è®­ç»ƒ<a class="anchor-link" href="#10233-è®­ç»ƒ" title="Permanent link">&para;</a></h4>
<ul>
<li>ç”¨BARTã€DPRï¼ˆç”¨BERTåˆå§‹åŒ–ï¼‰åˆå§‹åŒ–</li>
<li>è®­ç»ƒ <span class="math-inline">\text{BART}</span> <span class="math-inline">\text{BERT}_\text{q}</span></li>
</ul>
<h4 id="10234-å®éªŒ">10.2.3.4 å®éªŒ<a class="anchor-link" href="#10234-å®éªŒ" title="Permanent link">&para;</a></h4>
<ul>
<li>åœ¨Jeopardyé—®é¢˜ç”Ÿæˆä»»åŠ¡ä¸Šï¼Œè¾“å…¥Hemingwayçš„æ£€ç´¢ç»“æœï¼š</li>
</ul>
<p><img alt="rag-example" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/202409041251347.png" /></p>
<ul>
<li>å®éªŒç»“æœè¡¨æ˜ï¼Œä¼˜äºéæ£€ç´¢æ–¹æ³•ï¼š<br />
<img alt="rag-results" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/202409041251348.png" /></li>
</ul>
<p>è¿™é‡Œå¼•ç”¨GPT-3 few-shotçš„ç»“æœè¿›è¡Œæ¯”è¾ƒï¼šNaturalQuestions (29.9%), WebQuestions (41.5%), TriviaQA (71.2%)</p>
<h3 id="1024-retro-borgeaud-et-al-2021">10.2.4 RETRO (<a href="https://arxiv.org/pdf/2112.04426.pdf">Borgeaud et al., 2021</a>)<a class="anchor-link" href="#1024-retro-borgeaud-et-al-2021" title="Permanent link">&para;</a></h3>
<ul>
<li>åŸºäº32ä¸ªtokençš„å—è¿›è¡Œæ£€ç´¢</li>
<li>å­˜å‚¨åº“ï¼š2 trillion tokens</li>
<li>70äº¿å‚æ•°ï¼ˆæ¯”GPT-3å°‘25å€ï¼‰</li>
<li>ä½¿ç”¨å†»ç»“çš„BERTè¿›è¡Œæ£€ç´¢ï¼ˆä¸æ›´æ–°ï¼‰</li>
<li>åœ¨MassiveTextä¸Šè®­ç»ƒï¼ˆä¸è®­ç»ƒGopherçš„æ•°æ®é›†ç›¸åŒï¼‰</li>
</ul>
<h4 id="10241-å®éªŒç»“æœ">10.2.4.1 å®éªŒç»“æœ<a class="anchor-link" href="#10241-å®éªŒç»“æœ" title="Permanent link">&para;</a></h4>
<ul>
<li>åœ¨è¯­è¨€å»ºæ¨¡æ–¹é¢è¡¨ç°å‡ºè‰²</li>
<li>NaturalQuestionså‡†ç¡®ç‡ï¼š45.5%ï¼ˆSOTAä¸º54.7%ï¼‰</li>
</ul>
<p><img alt="retro-lm-results" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/202409041251349.png" /></p>
<h3 id="1025-è®¨è®º">10.2.5 è®¨è®º<a class="anchor-link" href="#1025-è®¨è®º" title="Permanent link">&para;</a></h3>
<ul>
<li>åŸºäºæ£€ç´¢çš„æ¨¡å‹é«˜åº¦é€‚åˆçŸ¥è¯†å¯†é›†å‹çš„é—®ç­”ä»»åŠ¡ã€‚</li>
<li>é™¤äº†å¯æ‰©å±•æ€§ä¹‹å¤–ï¼ŒåŸºäºæ£€ç´¢çš„æ¨¡å‹è¿˜æä¾›äº†å¯è§£é‡Šæ€§å’Œæ›´æ–°å­˜å‚¨åº“çš„èƒ½åŠ›ã€‚</li>
<li>ç›®å‰å°šä¸æ¸…æ¥šè¿™äº›æ¨¡å‹æ˜¯å¦å…·æœ‰ä¸ç¨ å¯†Transformerç›¸åŒçš„é€šç”¨èƒ½åŠ›ã€‚</li>
</ul>
<h2 id="103-æ€»ä½“æ€»ç»“">10.3 æ€»ä½“æ€»ç»“<a class="anchor-link" href="#103-æ€»ä½“æ€»ç»“" title="Permanent link">&para;</a></h2>
<ul>
<li>ä¸ºäº†æ‰©å¤§æ¨¡å‹è§„æ¨¡ï¼Œéœ€è¦æ”¹è¿›ç¨ å¯†Transformerã€‚</li>
<li>æ··åˆä¸“å®¶å’ŒåŸºäºæ£€ç´¢çš„æ–¹æ³•ç›¸ç»“åˆæ›´æœ‰æ•ˆã€‚</li>
<li>å¦‚ä½•è®¾è®¡æ›´å¥½çš„ã€å¯æ‰©å±•çš„ä½“ç³»ç»“æ„ä»ç„¶æ˜¯ä¸€ä¸ªæ‚¬è€Œæœªå†³çš„é—®é¢˜ã€‚</li>
</ul>
<h2 id="reference">Reference<a class="anchor-link" href="#reference" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://blog.csdn.net/TFATS/article/details/135548188">LLM ä¸»æµæ¡†æ¶ï¼šCausal Decoderã€Prefix Decoder å’Œ Encoder-Decoder</a></li>
<li><a href="https://blog.csdn.net/qq_35812205/article/details/130734021">æ¯”è¾ƒ Causal decoderã€Prefix decoder å’Œ encoder-decoder</a></li>
</ul>
                </div>

                <!-- Comments Section (Giscus) -->
                <section class="comments-section">
                    <h3><i class="fas fa-comments"></i> è¯„è®º</h3>
                    <script src="https://giscus.app/client.js"
                        data-repo="Geeks-Z/Geeks-Z.github.io"
                        data-repo-id=""
                        data-category="Announcements"
                        data-category-id=""
                        data-mapping="pathname"
                        data-strict="0"
                        data-reactions-enabled="1"
                        data-emit-metadata="0"
                        data-input-position="bottom"
                        data-theme="preferred_color_scheme"
                        data-lang="zh-CN"
                        crossorigin="anonymous"
                        async>
                    </script>
                </section>
            </article>

            <footer class="post-footer">
                <p>Â© 2025 Hongwei Zhao. Built with â¤ï¸</p>
            </footer>
        </main>
    </div>

    <!-- Theme Toggle Button -->
    <button class="theme-toggle" id="themeToggle" aria-label="åˆ‡æ¢ä¸»é¢˜">
        <i class="fas fa-moon"></i>
    </button>

    <script>
        // Theme Toggle
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;
        const icon = themeToggle.querySelector('i');
        const hljsDark = document.getElementById('hljs-theme-dark');
        const hljsLight = document.getElementById('hljs-theme-light');
        
        // Check saved theme or system preference
        const savedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        
        if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
            html.setAttribute('data-theme', 'dark');
            icon.className = 'fas fa-sun';
            hljsDark.disabled = false;
            hljsLight.disabled = true;
        }
        
        themeToggle.addEventListener('click', () => {
            const isDark = html.getAttribute('data-theme') === 'dark';
            if (isDark) {
                html.removeAttribute('data-theme');
                icon.className = 'fas fa-moon';
                localStorage.setItem('theme', 'light');
                hljsDark.disabled = true;
                hljsLight.disabled = false;
            } else {
                html.setAttribute('data-theme', 'dark');
                icon.className = 'fas fa-sun';
                localStorage.setItem('theme', 'dark');
                hljsDark.disabled = false;
                hljsLight.disabled = true;
            }
            
            // Update Giscus theme
            const giscusFrame = document.querySelector('iframe.giscus-frame');
            if (giscusFrame) {
                giscusFrame.contentWindow.postMessage({
                    giscus: {
                        setConfig: {
                            theme: isDark ? 'light' : 'dark'
                        }
                    }
                }, 'https://giscus.app');
            }
        });
        
        // Highlight.js
        document.addEventListener('DOMContentLoaded', () => {
            hljs.highlightAll();
        });
        
        // KaTeX auto-render
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof renderMathInElement !== 'undefined') {
                renderMathInElement(document.body, {
                    delimiters: [
                        {left: '$$', right: '$$', display: true},
                        {left: '$', right: '$', display: false},
                        {left: '\\[', right: '\\]', display: true},
                        {left: '\\(', right: '\\)', display: false}
                    ],
                    throwOnError: false
                });
            }
        });
        
        // TOC active state
        const tocLinks = document.querySelectorAll('.toc-container a');
        const headings = document.querySelectorAll('.post-content h2, .post-content h3, .post-content h4');
        
        function updateTocActive() {
            let current = '';
            headings.forEach(heading => {
                const rect = heading.getBoundingClientRect();
                if (rect.top <= 100) {
                    current = heading.getAttribute('id');
                }
            });
            
            tocLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + current) {
                    link.classList.add('active');
                }
            });
        }
        
        window.addEventListener('scroll', updateTocActive);
        updateTocActive();
    </script>
</body>
</html>
