<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>model_download.py</title>
    <meta name="description" content="model_download.py - Hongwei Zhao's Blog">
    <meta name="author" content="Hongwei Zhao">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+SC:wght@300;400;500;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Code Highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" id="hljs-theme-dark">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css" id="hljs-theme-light" disabled>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- KaTeX for Math -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    
    <style>
        :root {
            /* Light Theme */
            --primary-color: #2980b9;
            --primary-hover: #1a5276;
            --link-color: #c0392b;
            --text-color: #333;
            --text-light: #666;
            --text-muted: #999;
            --bg-color: #fff;
            --bg-secondary: #f8f9fa;
            --bg-code: #f5f5f5;
            --border-color: #e5e7eb;
            --shadow: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-lg: 0 4px 15px rgba(0,0,0,0.1);
        }

        [data-theme="dark"] {
            --primary-color: #5dade2;
            --primary-hover: #85c1e9;
            --link-color: #e74c3c;
            --text-color: #e5e7eb;
            --text-light: #9ca3af;
            --text-muted: #6b7280;
            --bg-color: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-code: #0f0f23;
            --border-color: #374151;
            --shadow: 0 1px 3px rgba(0,0,0,0.3);
            --shadow-lg: 0 4px 15px rgba(0,0,0,0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', 'Noto Sans SC', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-size: 16px;
            line-height: 1.8;
            color: var(--text-color);
            background: var(--bg-color);
            transition: background-color 0.3s, color 0.3s;
        }

        a {
            color: var(--primary-color);
            text-decoration: none;
            transition: color 0.2s;
        }

        a:hover {
            color: var(--primary-hover);
            text-decoration: underline;
        }

        /* Layout */
        .page-wrapper {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            gap: 3rem;
        }

        /* Sidebar TOC */
        .toc-sidebar {
            width: 260px;
            flex-shrink: 0;
            position: sticky;
            top: 2rem;
            height: fit-content;
            max-height: calc(100vh - 4rem);
            overflow-y: auto;
        }

        .toc-container {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .toc-container h3 {
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .toc-container ul {
            list-style: none;
        }

        .toc-container li {
            margin-bottom: 0.5rem;
        }

        .toc-container a {
            font-size: 0.9rem;
            color: var(--text-light);
            display: block;
            padding: 0.25rem 0;
            border-left: 2px solid transparent;
            padding-left: 0.75rem;
            transition: all 0.2s;
        }

        .toc-container a:hover,
        .toc-container a.active {
            color: var(--primary-color);
            border-left-color: var(--primary-color);
            text-decoration: none;
        }

        .toc-container ul ul {
            margin-left: 1rem;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            min-width: 0;
            max-width: 800px;
        }

        /* Header */
        .post-header {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 1.5rem;
        }

        .back-link:hover {
            color: var(--primary-color);
            text-decoration: none;
        }

        .post-header h1 {
            font-size: 2.25rem;
            font-weight: 700;
            line-height: 1.3;
            margin-bottom: 1rem;
            color: var(--text-color);
        }

        .post-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .post-meta span {
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .post-meta i {
            color: var(--text-muted);
        }

        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .tag {
            display: inline-block;
            font-size: 0.8rem;
            background: var(--bg-secondary);
            color: var(--text-light);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            transition: all 0.2s;
        }

        .tag:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* Article Content */
        .post-content {
            font-size: 1rem;
            line-height: 1.9;
        }

        .post-content h1,
        .post-content h2,
        .post-content h3,
        .post-content h4,
        .post-content h5,
        .post-content h6 {
            margin-top: 2rem;
            margin-bottom: 1rem;
            font-weight: 600;
            line-height: 1.4;
            color: var(--text-color);
        }

        .post-content h1 { font-size: 1.875rem; }
        .post-content h2 { 
            font-size: 1.5rem; 
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        .post-content h3 { font-size: 1.25rem; }
        .post-content h4 { font-size: 1.125rem; }

        .post-content p {
            margin-bottom: 1.25rem;
        }

        .post-content ul,
        .post-content ol {
            margin: 1.25rem 0;
            padding-left: 1.5rem;
        }

        .post-content li {
            margin-bottom: 0.5rem;
        }

        .post-content blockquote {
            margin: 1.5rem 0;
            padding: 1rem 1.5rem;
            background: var(--bg-secondary);
            border-left: 4px solid var(--primary-color);
            border-radius: 0 8px 8px 0;
            color: var(--text-light);
            font-style: italic;
        }

        .post-content blockquote p:last-child {
            margin-bottom: 0;
        }

        /* Code */
        .post-content code {
            font-family: 'JetBrains Mono', 'Fira Code', Consolas, monospace;
            font-size: 0.9em;
            background: var(--bg-code);
            padding: 0.2em 0.4em;
            border-radius: 4px;
            color: var(--link-color);
        }

        .post-content pre {
            margin: 1.5rem 0;
            padding: 1.25rem;
            background: var(--bg-code);
            border-radius: 10px;
            overflow-x: auto;
            border: 1px solid var(--border-color);
        }

        .post-content pre code {
            background: none;
            padding: 0;
            color: inherit;
            font-size: 0.875rem;
            line-height: 1.6;
        }

        /* Images */
        .post-content img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            margin: 1.5rem 0;
            box-shadow: var(--shadow-lg);
        }

        /* Tables */
        .post-content table {
            width: 100%;
            margin: 1.5rem 0;
            border-collapse: collapse;
            font-size: 0.95rem;
        }

        .post-content th,
        .post-content td {
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            text-align: left;
        }

        .post-content th {
            background: var(--bg-secondary);
            font-weight: 600;
        }

        .post-content tr:nth-child(even) {
            background: var(--bg-secondary);
        }

        /* Math */
        .math-display {
            margin: 1.5rem 0;
            overflow-x: auto;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: 8px;
        }

        /* Anchor links */
        .anchor-link {
            opacity: 0;
            margin-left: 0.5rem;
            color: var(--text-muted);
            font-weight: 400;
            transition: opacity 0.2s;
        }

        .post-content h2:hover .anchor-link,
        .post-content h3:hover .anchor-link,
        .post-content h4:hover .anchor-link {
            opacity: 1;
        }

        /* Theme Toggle */
        .theme-toggle {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            box-shadow: var(--shadow-lg);
            transition: transform 0.2s, background 0.2s;
            z-index: 1000;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
            background: var(--primary-hover);
        }

        /* Comments Section */
        .comments-section {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
        }

        .comments-section h3 {
            font-size: 1.25rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Footer */
        .post-footer {
            margin-top: 3rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
            text-align: center;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .toc-sidebar {
                display: none;
            }
            
            .page-wrapper {
                padding: 1.5rem;
            }
        }

        @media (max-width: 768px) {
            .post-header h1 {
                font-size: 1.75rem;
            }
            
            .post-meta {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .theme-toggle {
                bottom: 1rem;
                right: 1rem;
                width: 44px;
                height: 44px;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }
    </style>
</head>
<body>
    <div class="page-wrapper">
        <!-- TOC Sidebar -->
        <aside class="toc-sidebar">
            <div class="toc-container">
                <h3><i class="fas fa-list"></i> ç›®å½•</h3>
                <div class="toc">
<ul>
<li><a href="#openai-o1-model-ç®€ä»‹">OpenAI o1 model ç®€ä»‹</a></li>
<li><a href="#ç¯å¢ƒå‡†å¤‡">ç¯å¢ƒå‡†å¤‡</a></li>
<li><a href="#æ¨¡å‹ä¸‹è½½">æ¨¡å‹ä¸‹è½½</a></li>
<li><a href="#ä»£ç å‡†å¤‡">ä»£ç å‡†å¤‡</a><ul>
<li><a href="#æ ¸å¿ƒä»£ç ">æ ¸å¿ƒä»£ç </a></li>
<li><a href="#å®ç°åŸç†">å®ç°åŸç†</a></li>
<li><a href="#åˆ›å»ºå…¼å®¹-openai-api-æ¥å£çš„æœåŠ¡">åˆ›å»ºå…¼å®¹ OpenAI API æ¥å£çš„æœåŠ¡</a></li>
<li><a href="#å¯åŠ¨-streamlit-ç•Œé¢">å¯åŠ¨ Streamlit ç•Œé¢</a></li>
</ul>
</li>
</ul>
</div>

            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <article>
                <header class="post-header">
                    <a href="../../../../index.html" class="back-link">
                        <i class="fas fa-arrow-left"></i> è¿”å›åšå®¢åˆ—è¡¨
                    </a>
                    <h1>model_download.py</h1>
                    <div class="post-meta">
                        <span><i class="fas fa-calendar-alt"></i> 2026-01-28</span>
                        <span><i class="fas fa-folder"></i> å¤§æ¨¡å‹/07.å®æˆ˜ç¯‡/101.Qwen2.5-7B-Instruct</span>
                        <span><i class="fas fa-user"></i> Hongwei Zhao</span>
                    </div>
                    <div class="tags">
                        
                    </div>
                </header>

                <div class="post-content">
                    <h2 id="openai-o1-model-ç®€ä»‹"><strong>OpenAI o1 model ç®€ä»‹</strong><a class="anchor-link" href="#openai-o1-model-ç®€ä»‹" title="Permanent link">&para;</a></h2>
<p><strong>OpenAI o1</strong> ç³»åˆ—æ¨¡å‹æ˜¯ä½¿ç”¨å¼ºåŒ–å­¦ä¹ è®­ç»ƒçš„å¤§è¯­è¨€æ¨¡å‹ï¼Œç”¨äºæ‰§è¡Œå¤æ‚æ¨ç†ã€‚o1 æ¨¡å‹åœ¨å›ç­”ä¹‹å‰ä¼šæ€è€ƒï¼Œåœ¨å‘ç”¨æˆ·åšå‡ºå›åº”ä¹‹å‰å¯ä»¥äº§ç”Ÿä¸€ä¸ªé•¿çš„å†…éƒ¨æ€ç»´é“¾ã€‚ o1 æ¨¡å‹åœ¨ç§‘å­¦æ¨ç†æ–¹é¢è¡¨ç°å‡ºè‰²ï¼Œåœ¨ç¼–ç¨‹ç«èµ›ï¼ˆCodeforcesï¼‰ä¸­æ’å 89%ï¼Œåœ¨ç¾å›½æ•°å­¦å¥¥æ—åŒ¹å…‹ç«èµ›ï¼ˆAIMEï¼‰çš„é¢„é€‰ä¸­ä½åˆ—å‰ 500 åï¼Œåœ¨ç‰©ç†ã€ç”Ÿç‰©å­¦å’ŒåŒ–å­¦é—®é¢˜åŸºå‡†æµ‹è¯•ï¼ˆGPQAï¼‰ä¸­è¶…è¶Šäº†äººç±»åšå£«æ°´å¹³ã€‚</p>
<p><img alt="06-1" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/202412231037401.png" /></p>
<p><strong>OpenAI o1</strong> ç³»åˆ—æ¨¡å‹ä¸ä»…æé«˜äº†æ¨¡å‹çš„å®ç”¨æ€§ï¼Œè¿˜ä¸ºæœªæ¥AIæŠ€æœ¯çš„å‘å±•å¼€è¾Ÿäº†æ–°çš„é“è·¯ã€‚ç›®å‰ï¼Œo1æ¨¡å‹åŒ…æ‹¬ <code>o1-preview</code> å’Œ<code>o1-mini</code> ä¸¤ä¸ªç‰ˆæœ¬ï¼Œå…¶ä¸­ <code>o1-preview</code> é€‚ç”¨äºè§£å†³å„ä¸ªé¢†åŸŸçš„å¤æ‚é—®é¢˜ï¼Œè€Œ <code>o1-mini</code> åˆ™é€Ÿåº¦æ›´å¿«ï¼Œæ€§ä»·æ¯”æ›´é«˜ï¼Œä¸”æ›´æ“…é•¿ä»£ç é¢†åŸŸã€‚</p>
<p><img alt="06-2" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/202412231037402.png" /></p>
<p>å‚è€ƒæ–‡æ¡£ï¼š </p>
<p><a href="https://platform.openai.com/docs/guides/reasoning/quickstart">Reasoning - OpenAI API</a></p>
<p><a href="https://openai.com/index/openai-o1-system-card/">o1 System Card | OpenAI</a></p>
<h2 id="ç¯å¢ƒå‡†å¤‡">ç¯å¢ƒå‡†å¤‡<a class="anchor-link" href="#ç¯å¢ƒå‡†å¤‡" title="Permanent link">&para;</a></h2>
<p>æœ¬æ–‡åŸºç¡€ç¯å¢ƒå¦‚ä¸‹ï¼š</p>
<pre><code>----------------
ubuntu 22.04
python 3.12
cuda 12.1
pytorch 2.3.0
----------------
</code></pre>
<blockquote>
<p>æœ¬æ–‡é»˜è®¤å­¦ä¹ è€…å·²é…ç½®å¥½ä»¥ä¸Š <code>Pytorch (cuda)</code> ç¯å¢ƒï¼Œå¦‚æœªé…ç½®è¯·å…ˆè‡ªè¡Œå®‰è£…ã€‚</p>
</blockquote>
<p>é¦–å…ˆ <code>pip</code> æ¢æºåŠ é€Ÿä¸‹è½½å¹¶å®‰è£…ä¾èµ–åŒ…</p>
<pre><code class="language-bash">python -m pip install --upgrade pip
pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple

pip install modelscope==1.18.0
pip install openai==1.46.0
pip install tqdm==4.66.2
pip install transformers==4.44.2
pip install vllm==0.6.1.post2
pip install streamlit==1.38.0
</code></pre>
<blockquote>
<p>è€ƒè™‘åˆ°éƒ¨åˆ†åŒå­¦é…ç½®ç¯å¢ƒå¯èƒ½ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨AutoDLå¹³å°å‡†å¤‡äº† <code>Qwen2.5</code> çš„ç¯å¢ƒé•œåƒï¼Œç‚¹å‡»ä¸‹æ–¹é“¾æ¥å¹¶ç›´æ¥åˆ›å»º <code>AutoDL</code> ç¤ºä¾‹å³å¯ã€‚<br />
<strong><em>https://www.codewithgpu.com/i/datawhalechina/self-llm/Qwen2.5-self-llm</em></strong></p>
</blockquote>
<h2 id="æ¨¡å‹ä¸‹è½½">æ¨¡å‹ä¸‹è½½<a class="anchor-link" href="#æ¨¡å‹ä¸‹è½½" title="Permanent link">&para;</a></h2>
<p>ä½¿ç”¨ <code>modelscope</code> ä¸­çš„ <code>snapshot_download</code> å‡½æ•°ä¸‹è½½æ¨¡å‹ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ¨¡å‹åç§°ï¼Œå‚æ•° <code>cache_dir</code>ä¸ºæ¨¡å‹çš„ä¸‹è½½è·¯å¾„ã€‚</p>
<p>å…ˆåˆ‡æ¢åˆ° <code>autodl-tmp</code> ç›®å½•ï¼Œ<code>cd /root/autodl-tmp</code> </p>
<p>ç„¶åæ–°å»ºåä¸º <code>model_download.py</code> çš„ <code>python</code> è„šæœ¬ï¼Œå¹¶åœ¨å…¶ä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹å¹¶ä¿å­˜</p>
<pre><code class="language-python"># model_download.py
from modelscope import snapshot_download
model_dir = snapshot_download('qwen/Qwen2.5-7B-Instruct', cache_dir='/root/autodl-tmp', revision='master')
</code></pre>
<p>ç„¶ååœ¨ç»ˆç«¯ä¸­è¾“å…¥ <code>python model_download.py</code> æ‰§è¡Œä¸‹è½½ï¼Œè¿™é‡Œéœ€è¦è€å¿ƒç­‰å¾…ä¸€æ®µæ—¶é—´ç›´åˆ°æ¨¡å‹ä¸‹è½½å®Œæˆã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šè®°å¾—ä¿®æ”¹ <code>cache_dir</code> ä¸ºä½ çš„æ¨¡å‹ä¸‹è½½è·¯å¾„å“¦~</p>
</blockquote>
<p><img alt="03-1" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/202412231037403.png" /></p>
<h2 id="ä»£ç å‡†å¤‡"><strong>ä»£ç å‡†å¤‡</strong><a class="anchor-link" href="#ä»£ç å‡†å¤‡" title="Permanent link">&para;</a></h2>
<h4 id="æ ¸å¿ƒä»£ç "><strong>æ ¸å¿ƒä»£ç </strong><a class="anchor-link" href="#æ ¸å¿ƒä»£ç " title="Permanent link">&para;</a></h4>
<p>åœ¨ <code>/root/autodl-tmp</code> è·¯å¾„ä¸‹æ–°å»º <code>app_qwen.py</code> æ–‡ä»¶å¹¶åœ¨å…¶ä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼Œç²˜è´´ä»£ç åè¯·åŠæ—¶ä¿å­˜æ–‡ä»¶ã€‚</p>
<pre><code class="language-python"># app_qwen.py
import os
import json
import time
import streamlit as st
from openai import OpenAI

client = OpenAI(
    api_key=&quot;sk-xxx&quot;,
    base_url=&quot;http://localhost:8000/v1&quot;,
)

def make_api_call(messages, max_tokens, is_final_answer=False):
    for attempt in range(3):
        try:
            response = client.chat.completions.create(
                model=&quot;Qwen2.5-7B-Instruct&quot;,
                messages=messages,
                max_tokens=max_tokens,
                temperature=0.2,
                response_format={&quot;type&quot;: &quot;json_object&quot;}
            )
            content = response.choices[0].message.content
            print(f&quot;Raw API response: {content}&quot;)  # æ·»åŠ æ­¤è¡Œæ¥æ‰“å°åŸå§‹å“åº”
            try:
                return json.loads(content)
            except json.JSONDecodeError as json_error:
                print(f&quot;JSONè§£æé”™è¯¯: {json_error}&quot;)
                # å¦‚æœJSONè§£æå¤±è´¥ï¼Œè¿”å›ä¸€ä¸ªåŒ…å«åŸå§‹å†…å®¹çš„å­—å…¸
                return {
                    &quot;title&quot;: &quot;API Response&quot;,
                    &quot;content&quot;: content,
                    &quot;next_action&quot;: &quot;final_answer&quot; if is_final_answer else &quot;continue&quot;
                }
        except Exception as e:
            if attempt == 2:
                return {
                    &quot;title&quot;: &quot;Error&quot;,
                    &quot;content&quot;: f&quot;Failed after 3 attempts. Error: {str(e)}&quot;,
                    &quot;next_action&quot;: &quot;final_answer&quot;
                }
            time.sleep(1)  # é‡è¯•å‰ç­‰å¾…1ç§’

def generate_response(prompt):
    messages = [
        {&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;&quot;&quot;
        ä½ æ˜¯ä¸€ä½å…·æœ‰é«˜çº§æ¨ç†èƒ½åŠ›çš„ä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯æä¾›è¯¦ç»†çš„ã€é€æ­¥çš„æ€ç»´è¿‡ç¨‹è§£é‡Šã€‚å¯¹äºæ¯ä¸€æ­¥:
        1. æä¾›ä¸€ä¸ªæ¸…æ™°ã€ç®€æ´çš„æ ‡é¢˜,æè¿°å½“å‰çš„æ¨ç†é˜¶æ®µã€‚
        2. åœ¨å†…å®¹éƒ¨åˆ†è¯¦ç»†é˜è¿°ä½ çš„æ€ç»´è¿‡ç¨‹ã€‚
        3. å†³å®šæ˜¯ç»§ç»­æ¨ç†è¿˜æ˜¯æä¾›æœ€ç»ˆç­”æ¡ˆã€‚

        è¾“å‡ºæ ¼å¼è¯´æ˜:
        è¾“å‡ºè¯·ä¸¥æ ¼éµå¾ªJSONæ ¼å¼, åŒ…å«ä»¥ä¸‹é”®: 'title', 'content', 'next_action'(å€¼åªèƒ½ä¸º'continue' æˆ– 'final_answer'äºŒè€…ä¹‹ä¸€)

        å…³é”®æŒ‡ç¤º:
        - è‡³å°‘ä½¿ç”¨5ä¸ªä¸åŒçš„æ¨ç†æ­¥éª¤ã€‚
        - æ‰¿è®¤ä½ ä½œä¸ºAIçš„å±€é™æ€§,æ˜ç¡®è¯´æ˜ä½ èƒ½åšä»€ä¹ˆå’Œä¸èƒ½åšä»€ä¹ˆã€‚
        - ä¸»åŠ¨æ¢ç´¢å’Œè¯„ä¼°æ›¿ä»£ç­”æ¡ˆæˆ–æ–¹æ³•ã€‚
        - æ‰¹åˆ¤æ€§åœ°è¯„ä¼°ä½ è‡ªå·±çš„æ¨ç†;è¯†åˆ«æ½œåœ¨çš„ç¼ºé™·æˆ–åè§ã€‚
        - å½“é‡æ–°å®¡è§†æ—¶,é‡‡ç”¨æ ¹æœ¬ä¸åŒçš„æ–¹æ³•æˆ–è§†è§’ã€‚
        - è‡³å°‘ä½¿ç”¨3ç§ä¸åŒçš„æ–¹æ³•æ¥å¾—å‡ºæˆ–éªŒè¯ä½ çš„ç­”æ¡ˆã€‚
        - åœ¨ä½ çš„æ¨ç†ä¸­èå…¥ç›¸å…³çš„é¢†åŸŸçŸ¥è¯†å’Œæœ€ä½³å®è·µã€‚
        - åœ¨é€‚ç”¨çš„æƒ…å†µä¸‹,é‡åŒ–æ¯ä¸ªæ­¥éª¤å’Œæœ€ç»ˆç»“è®ºçš„ç¡®å®šæ€§æ°´å¹³ã€‚
        - è€ƒè™‘ä½ æ¨ç†ä¸­å¯èƒ½å­˜åœ¨çš„è¾¹ç¼˜æƒ…å†µæˆ–ä¾‹å¤–ã€‚
        - ä¸ºæ’é™¤æ›¿ä»£å‡è®¾æä¾›æ¸…æ™°çš„ç†ç”±ã€‚

        ç¤ºä¾‹JSONè¾“å‡º:
        {
            &quot;title&quot;: &quot;åˆæ­¥é—®é¢˜åˆ†æ&quot;,
            &quot;content&quot;: &quot;ä¸ºäº†æœ‰æ•ˆåœ°è§£å†³è¿™ä¸ªé—®é¢˜,æˆ‘é¦–å…ˆä¼šå°†ç»™å®šçš„ä¿¡æ¯åˆ†è§£ä¸ºå…³é”®ç»„æˆéƒ¨åˆ†ã€‚è¿™æ¶‰åŠåˆ°è¯†åˆ«...[è¯¦ç»†è§£é‡Š]...é€šè¿‡è¿™æ ·æ„å»ºé—®é¢˜,æˆ‘ä»¬å¯ä»¥ç³»ç»Ÿåœ°è§£å†³æ¯ä¸ªæ–¹é¢ã€‚&quot;,
            &quot;next_action&quot;: &quot;continue&quot;
        }

        è®°ä½: å…¨é¢æ€§å’Œæ¸…æ™°åº¦è‡³å…³é‡è¦ã€‚æ¯ä¸€æ­¥éƒ½åº”è¯¥ä¸ºæœ€ç»ˆè§£å†³æ–¹æ¡ˆæä¾›æœ‰æ„ä¹‰çš„è¿›å±•ã€‚
        å†æ¬¡æé†’: è¾“å‡ºè¯·åŠ¡å¿…ä¸¥æ ¼éµå¾ªJSONæ ¼å¼, åŒ…å«ä»¥ä¸‹é”®: 'title', 'content', 'next_action'(å€¼åªèƒ½ä¸º'continue' æˆ– 'final_answer'äºŒè€…ä¹‹ä¸€)
        &quot;&quot;&quot;},
        {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: prompt},
        {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;ç°åœ¨æˆ‘å°†ä¸€æ­¥æ­¥æ€è€ƒï¼Œä»åˆ†æé—®é¢˜å¼€å§‹å¹¶å°†é—®é¢˜åˆ†è§£ã€‚&quot;}
    ]

    steps = []
    step_count = 1
    total_thinking_time = 0

    while True:
        start_time = time.time()
        step_data = make_api_call(messages, 1000)
        end_time = time.time()
        thinking_time = end_time - start_time
        total_thinking_time += thinking_time

        title = step_data.get('title', f'Step {step_count}')
        content = step_data.get('content', 'No content provided')
        next_action = step_data.get('next_action', 'continue')

        steps.append((f&quot;Step {step_count}: {title}&quot;, content, thinking_time))

        messages.append({&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: json.dumps(step_data)})

        if next_action == 'final_answer' or step_count &gt; 25: # æœ€å¤š25æ­¥ï¼Œä»¥é˜²æ­¢æ— é™çš„æ€è€ƒã€‚å¯ä»¥é€‚å½“è°ƒæ•´ã€‚
            break

        step_count += 1

        yield steps, None  # åœ¨ç»“æŸæ—¶ç”Ÿæˆæ€»æ—¶é—´

    # ç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ
    messages.append({&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;è¯·æ ¹æ®ä½ ä¸Šé¢çš„æ¨ç†æä¾›æœ€ç»ˆç­”æ¡ˆã€‚&quot;})

    start_time = time.time()
    final_data = make_api_call(messages, 1000, is_final_answer=True)
    end_time = time.time()
    thinking_time = end_time - start_time
    total_thinking_time += thinking_time

    final_content = final_data.get('content', 'æ²¡æœ‰æ¨ç†å‡ºæœ€ç»ˆç»“æœ')
    steps.append((&quot;æœ€ç»ˆæ¨ç†ç»“æœ&quot;, final_content, thinking_time))

    yield steps, total_thinking_time

def main():
    st.set_page_config(page_title=&quot;Qwen2.5 o1-like Reasoning Chain&quot;, page_icon=&quot;ğŸ’¬&quot;, layout=&quot;wide&quot;)

    st.title(&quot;Qwen2.5å®ç°ç±»ä¼¼o1 modelçš„æ¨ç†é“¾&quot;)
    st.caption(&quot;ğŸš€ A streamlit implementation powered by [å¼€æºå¤§æ¨¡å‹é£Ÿç”¨æŒ‡å— self-llm](https://github.com/datawhalechina/self-llm)&quot;)

    st.markdown(&quot;&quot;&quot;
    é€šè¿‡vLLMéƒ¨ç½²è°ƒç”¨Qwen2.5-7B-Instructå¹¶å®ç°ç±»ä¼¼OpenAI o1 modelçš„é•¿æ¨ç†é“¾æ•ˆæœä»¥æé«˜å¯¹å¤æ‚é—®é¢˜çš„æ¨ç†å‡†ç¡®æ€§ã€‚
    &quot;&quot;&quot;)

    # ç”¨æˆ·è¾“å…¥æŸ¥è¯¢
    user_query = st.text_input(&quot;è¾“å…¥é—®é¢˜:&quot;, placeholder=&quot;ç¤ºä¾‹ï¼šstrawberryä¸­æœ‰å¤šå°‘ä¸ªå­—æ¯rï¼Ÿ&quot;)

    if user_query:
        st.write(&quot;æ­£åœ¨ç”Ÿæˆæ¨ç†é“¾ä¸­...&quot;)

        # åˆ›å»ºç©ºå…ƒç´ ä»¥ä¿å­˜ç”Ÿæˆçš„æ–‡æœ¬å’Œæ€»æ—¶é—´
        response_container = st.empty()
        time_container = st.empty()

        # ç”Ÿæˆå¹¶æ˜¾ç¤ºå“åº”
        for steps, total_thinking_time in generate_response(user_query):
            with response_container.container():
                for i, (title, content, thinking_time) in enumerate(steps):
                    if title.startswith(&quot;æœ€ç»ˆæ¨ç†ç»“æœ&quot;):
                        st.markdown(f&quot;### {title}&quot;)
                        st.markdown(content.replace('\n', '&lt;br&gt;'), unsafe_allow_html=True)
                    else:
                        with st.expander(title, expanded=True):
                            st.markdown(content.replace('\n', '&lt;br&gt;'), unsafe_allow_html=True)

            # ä»…åœ¨ç»“æŸæ—¶æ˜¾ç¤ºæ€»æ—¶é—´
            if total_thinking_time is not None:
                time_container.markdown(f&quot;**æ€»æ¨ç†æ—¶é—´: {total_thinking_time:.2f} ç§’**&quot;)

if __name__ == &quot;__main__&quot;:
    main()
</code></pre>
<h4 id="å®ç°åŸç†">å®ç°åŸç†<a class="anchor-link" href="#å®ç°åŸç†" title="Permanent link">&para;</a></h4>
<p><img alt="06-3" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/202412231037404.png" /></p>
<p>æ³¨æ„ï¼šä»£ç ä¸­åªæ˜¯å°è¯•å®ç°äº† <strong><code>o1-like</code></strong> çš„ <code>Reasoning Chain</code> çš„æ•ˆæœï¼Œè€Œå¹¶éæ˜¯åœ¨ <code>pretrain</code> è¿‡ç¨‹ä¸­è®­ç»ƒå¾—åˆ° <code>Chain of Thought</code> å†…ç½®èƒ½åŠ›çš„ o1 æ¨¡å‹ã€‚</p>
<h4 id="åˆ›å»ºå…¼å®¹-openai-api-æ¥å£çš„æœåŠ¡">åˆ›å»ºå…¼å®¹ OpenAI API æ¥å£çš„æœåŠ¡<a class="anchor-link" href="#åˆ›å»ºå…¼å®¹-openai-api-æ¥å£çš„æœåŠ¡" title="Permanent link">&para;</a></h4>
<p><code>Qwen</code> å…¼å®¹ <code>OpenAI API</code> åè®®ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>vLLM</code> åˆ›å»º <code>OpenAI API</code> æœåŠ¡å™¨ã€‚<code>vLLM</code> éƒ¨ç½²å®ç° <code>OpenAI API</code> åè®®çš„æœåŠ¡å™¨éå¸¸æ–¹ä¾¿ã€‚é»˜è®¤ä¼šåœ¨ http://localhost:8000 å¯åŠ¨æœåŠ¡å™¨ã€‚æœåŠ¡å™¨å½“å‰ä¸€æ¬¡æ‰˜ç®¡ä¸€ä¸ªæ¨¡å‹ï¼Œå¹¶å®ç°åˆ—è¡¨æ¨¡å‹ã€<code>completions</code> å’Œ <code>chat completions</code> ç«¯å£ã€‚</p>
<ul>
<li><code>completions</code>ï¼šæ˜¯åŸºæœ¬çš„æ–‡æœ¬ç”Ÿæˆä»»åŠ¡ï¼Œæ¨¡å‹ä¼šåœ¨ç»™å®šçš„æç¤ºåç”Ÿæˆä¸€æ®µæ–‡æœ¬ã€‚è¿™ç§ç±»å‹çš„ä»»åŠ¡é€šå¸¸ç”¨äºç”Ÿæˆæ–‡ç« ã€æ•…äº‹ã€é‚®ä»¶ç­‰ã€‚</li>
<li><code>chat completions</code>ï¼šæ˜¯é¢å‘å¯¹è¯çš„ä»»åŠ¡ï¼Œæ¨¡å‹éœ€è¦ç†è§£å’Œç”Ÿæˆå¯¹è¯ã€‚è¿™ç§ç±»å‹çš„ä»»åŠ¡é€šå¸¸ç”¨äºæ„å»ºèŠå¤©æœºå™¨äººæˆ–è€…å¯¹è¯ç³»ç»Ÿã€‚</li>
</ul>
<p>åœ¨åˆ›å»ºæœåŠ¡å™¨æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šæ¨¡å‹åç§°ã€æ¨¡å‹è·¯å¾„ã€èŠå¤©æ¨¡æ¿ç­‰å‚æ•°ã€‚</p>
<ul>
<li><code>--host</code> å’Œ <code>--port</code> å‚æ•°æŒ‡å®šåœ°å€ã€‚</li>
<li><code>--model</code> å‚æ•°æŒ‡å®šæ¨¡å‹åç§°ã€‚</li>
<li><code>--chat-template</code> å‚æ•°æŒ‡å®šèŠå¤©æ¨¡æ¿ã€‚</li>
<li><code>--served-model-name</code> æŒ‡å®šæœåŠ¡æ¨¡å‹çš„åç§°ã€‚</li>
<li><code>--max-model-len</code> æŒ‡å®šæ¨¡å‹çš„æœ€å¤§é•¿åº¦ã€‚</li>
</ul>
<pre><code class="language-bash">python -m vllm.entrypoints.openai.api_server --model /root/autodl-tmp/qwen/Qwen2.5-7B-Instruct  --served-model-name Qwen2.5-7B-Instruct --max-model-len=32768 --port 8000
</code></pre>
<p>åŠ è½½å®Œæ¯•åå‡ºç°å¦‚ä¸‹ä¿¡æ¯è¯´æ˜æœåŠ¡æˆåŠŸå¯åŠ¨</p>
<p><img alt="03-3" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/202412231037405.png" /></p>
<h4 id="å¯åŠ¨-streamlit-ç•Œé¢">å¯åŠ¨ Streamlit ç•Œé¢<a class="anchor-link" href="#å¯åŠ¨-streamlit-ç•Œé¢" title="Permanent link">&para;</a></h4>
<pre><code class="language-shell">streamlit run /root/autodl-tmp/app_qwen.py --server.address 127.0.0.1 --server.port 6004
</code></pre>
<p>åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­æ‰“å¼€é“¾æ¥ http://127.0.0.1:6004/ ï¼Œå³å¯è¿›å…¥éƒ¨ç½²çš„ <code>Streamlit</code> ç•Œé¢ã€‚è¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img alt="06-4" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/202412231037406.png" /></p>
<p>æˆ‘ä»¬å¯ä»¥å°è¯•ç¤ºä¾‹ä¸­çš„é—®é¢˜ï¼Œ<code>strawberryä¸­æœ‰å¤šå°‘ä¸ªå­—æ¯rï¼Ÿ</code> æ¥è®©å®ç°äº†æ¨ç†é“¾çš„ <code>Qwen2.5-7B-Instruct</code> ç»™å‡ºæ¨ç†ç»“æœ</p>
<p><img alt="06-5" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/202412231037407.png" /></p>
<p>æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°ç»è¿‡4æ­¥æ¨ç†å’Œæ€è€ƒï¼Œæœ€ç»ˆçš„æ¨ç†ç»“æœæ˜¯<strong>æ­£ç¡®çš„</strong>ï¼Œä¸”æ€»æ¨ç†è€—æ—¶2è¿˜æ˜¯å¾ˆé•¿çš„ï¼Œè¿™ä¹Ÿç¬¦åˆäº† o1 æ¨¡å‹çš„åŸºæœ¬ç‰¹å¾ï¼Œç”¨æ¨ç†æ—¶é—´çš„å¢åŠ æ¢å–æ›´é«˜çš„æ¨ç†å‡†ç¡®ç‡ã€‚</p>
<p><strong>è¯´æ˜</strong>ï¼šæœ‰è¯»è€…å¯èƒ½ä¼šè®¤ä¸ºè¿™ä¸ªé—®é¢˜æ ¹æœ¬æ²¡æœ‰éš¾åº¦ï¼Œä½†æ˜¯å®é™…ä¸Šå¯¹äºç°é˜¶æ®µçš„å¤§è¯­è¨€æ¨¡å‹æ¥è¯´ï¼Œå¾ˆå°‘æœ‰èƒ½å¤Ÿå›ç­”æ­£ç¡®çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥å›åˆ° <a href="./04-Qwen2_5-7B-Instruct WebDemoéƒ¨ç½².md">04-Qwen2.5-7B-Instruct WebDemo éƒ¨ç½²</a> æ¥å°è¯•ä¸€ä¸‹æé—®ç›¸åŒçš„é—®é¢˜ï¼Œæœ€åå¾—åˆ°çš„ç»“æœæ˜¾ç„¶æ˜¯<strong>é”™è¯¯çš„</strong>ã€‚</p>
<p><img alt="06-6" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/202412231037408.png" /> </p>
                </div>

                <!-- Comments Section (Giscus) -->
                <section class="comments-section">
                    <h3><i class="fas fa-comments"></i> è¯„è®º</h3>
                    <script src="https://giscus.app/client.js"
                        data-repo="Geeks-Z/Geeks-Z.github.io"
                        data-repo-id=""
                        data-category="Announcements"
                        data-category-id=""
                        data-mapping="pathname"
                        data-strict="0"
                        data-reactions-enabled="1"
                        data-emit-metadata="0"
                        data-input-position="bottom"
                        data-theme="preferred_color_scheme"
                        data-lang="zh-CN"
                        crossorigin="anonymous"
                        async>
                    </script>
                </section>
            </article>

            <footer class="post-footer">
                <p>Â© 2025 Hongwei Zhao. Built with â¤ï¸</p>
            </footer>
        </main>
    </div>

    <!-- Theme Toggle Button -->
    <button class="theme-toggle" id="themeToggle" aria-label="åˆ‡æ¢ä¸»é¢˜">
        <i class="fas fa-moon"></i>
    </button>

    <script>
        // Theme Toggle
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;
        const icon = themeToggle.querySelector('i');
        const hljsDark = document.getElementById('hljs-theme-dark');
        const hljsLight = document.getElementById('hljs-theme-light');
        
        // Check saved theme or system preference
        const savedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        
        if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
            html.setAttribute('data-theme', 'dark');
            icon.className = 'fas fa-sun';
            hljsDark.disabled = false;
            hljsLight.disabled = true;
        }
        
        themeToggle.addEventListener('click', () => {
            const isDark = html.getAttribute('data-theme') === 'dark';
            if (isDark) {
                html.removeAttribute('data-theme');
                icon.className = 'fas fa-moon';
                localStorage.setItem('theme', 'light');
                hljsDark.disabled = true;
                hljsLight.disabled = false;
            } else {
                html.setAttribute('data-theme', 'dark');
                icon.className = 'fas fa-sun';
                localStorage.setItem('theme', 'dark');
                hljsDark.disabled = false;
                hljsLight.disabled = true;
            }
            
            // Update Giscus theme
            const giscusFrame = document.querySelector('iframe.giscus-frame');
            if (giscusFrame) {
                giscusFrame.contentWindow.postMessage({
                    giscus: {
                        setConfig: {
                            theme: isDark ? 'light' : 'dark'
                        }
                    }
                }, 'https://giscus.app');
            }
        });
        
        // Highlight.js
        document.addEventListener('DOMContentLoaded', () => {
            hljs.highlightAll();
        });
        
        // KaTeX auto-render
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof renderMathInElement !== 'undefined') {
                renderMathInElement(document.body, {
                    delimiters: [
                        {left: '$$', right: '$$', display: true},
                        {left: '$', right: '$', display: false},
                        {left: '\\[', right: '\\]', display: true},
                        {left: '\\(', right: '\\)', display: false}
                    ],
                    throwOnError: false
                });
            }
        });
        
        // TOC active state
        const tocLinks = document.querySelectorAll('.toc-container a');
        const headings = document.querySelectorAll('.post-content h2, .post-content h3, .post-content h4');
        
        function updateTocActive() {
            let current = '';
            headings.forEach(heading => {
                const rect = heading.getBoundingClientRect();
                if (rect.top <= 100) {
                    current = heading.getAttribute('id');
                }
            });
            
            tocLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + current) {
                    link.classList.add('active');
                }
            });
        }
        
        window.addEventListener('scroll', updateTocActive);
        updateTocActive();
    </script>
</body>
</html>
