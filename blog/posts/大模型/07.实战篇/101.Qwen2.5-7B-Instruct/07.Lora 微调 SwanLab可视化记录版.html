<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ›´æ¢ pypi æºåŠ é€Ÿåº“çš„å®‰è£…</title>
    <meta name="description" content="æ›´æ¢ pypi æºåŠ é€Ÿåº“çš„å®‰è£… - Hongwei Zhao's Blog">
    <meta name="author" content="Hongwei Zhao">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+SC:wght@300;400;500;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Code Highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" id="hljs-theme-dark">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css" id="hljs-theme-light" disabled>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- KaTeX for Math -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    
    <style>
        :root {
            /* Light Theme */
            --primary-color: #2980b9;
            --primary-hover: #1a5276;
            --link-color: #c0392b;
            --text-color: #333;
            --text-light: #666;
            --text-muted: #999;
            --bg-color: #fff;
            --bg-secondary: #f8f9fa;
            --bg-code: #f5f5f5;
            --border-color: #e5e7eb;
            --shadow: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-lg: 0 4px 15px rgba(0,0,0,0.1);
        }

        [data-theme="dark"] {
            --primary-color: #5dade2;
            --primary-hover: #85c1e9;
            --link-color: #e74c3c;
            --text-color: #e5e7eb;
            --text-light: #9ca3af;
            --text-muted: #6b7280;
            --bg-color: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-code: #0f0f23;
            --border-color: #374151;
            --shadow: 0 1px 3px rgba(0,0,0,0.3);
            --shadow-lg: 0 4px 15px rgba(0,0,0,0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', 'Noto Sans SC', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-size: 16px;
            line-height: 1.8;
            color: var(--text-color);
            background: var(--bg-color);
            transition: background-color 0.3s, color 0.3s;
        }

        a {
            color: var(--primary-color);
            text-decoration: none;
            transition: color 0.2s;
        }

        a:hover {
            color: var(--primary-hover);
            text-decoration: underline;
        }

        /* Layout */
        .page-wrapper {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            gap: 3rem;
        }

        /* Sidebar TOC */
        .toc-sidebar {
            width: 260px;
            flex-shrink: 0;
            position: sticky;
            top: 2rem;
            height: fit-content;
            max-height: calc(100vh - 4rem);
            overflow-y: auto;
        }

        .toc-container {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .toc-container h3 {
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .toc-container ul {
            list-style: none;
        }

        .toc-container li {
            margin-bottom: 0.5rem;
        }

        .toc-container a {
            font-size: 0.9rem;
            color: var(--text-light);
            display: block;
            padding: 0.25rem 0;
            border-left: 2px solid transparent;
            padding-left: 0.75rem;
            transition: all 0.2s;
        }

        .toc-container a:hover,
        .toc-container a.active {
            color: var(--primary-color);
            border-left-color: var(--primary-color);
            text-decoration: none;
        }

        .toc-container ul ul {
            margin-left: 1rem;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            min-width: 0;
            max-width: 800px;
        }

        /* Header */
        .post-header {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 1.5rem;
        }

        .back-link:hover {
            color: var(--primary-color);
            text-decoration: none;
        }

        .post-header h1 {
            font-size: 2.25rem;
            font-weight: 700;
            line-height: 1.3;
            margin-bottom: 1rem;
            color: var(--text-color);
        }

        .post-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .post-meta span {
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .post-meta i {
            color: var(--text-muted);
        }

        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .tag {
            display: inline-block;
            font-size: 0.8rem;
            background: var(--bg-secondary);
            color: var(--text-light);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            transition: all 0.2s;
        }

        .tag:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* Article Content */
        .post-content {
            font-size: 1rem;
            line-height: 1.9;
        }

        .post-content h1,
        .post-content h2,
        .post-content h3,
        .post-content h4,
        .post-content h5,
        .post-content h6 {
            margin-top: 2rem;
            margin-bottom: 1rem;
            font-weight: 600;
            line-height: 1.4;
            color: var(--text-color);
        }

        .post-content h1 { font-size: 1.875rem; }
        .post-content h2 { 
            font-size: 1.5rem; 
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        .post-content h3 { font-size: 1.25rem; }
        .post-content h4 { font-size: 1.125rem; }

        .post-content p {
            margin-bottom: 1.25rem;
        }

        .post-content ul,
        .post-content ol {
            margin: 1.25rem 0;
            padding-left: 1.5rem;
        }

        .post-content li {
            margin-bottom: 0.5rem;
        }

        .post-content blockquote {
            margin: 1.5rem 0;
            padding: 1rem 1.5rem;
            background: var(--bg-secondary);
            border-left: 4px solid var(--primary-color);
            border-radius: 0 8px 8px 0;
            color: var(--text-light);
            font-style: italic;
        }

        .post-content blockquote p:last-child {
            margin-bottom: 0;
        }

        /* Code */
        .post-content code {
            font-family: 'JetBrains Mono', 'Fira Code', Consolas, monospace;
            font-size: 0.9em;
            background: var(--bg-code);
            padding: 0.2em 0.4em;
            border-radius: 4px;
            color: var(--link-color);
        }

        .post-content pre {
            margin: 1.5rem 0;
            padding: 1.25rem;
            background: var(--bg-code);
            border-radius: 10px;
            overflow-x: auto;
            border: 1px solid var(--border-color);
        }

        .post-content pre code {
            background: none;
            padding: 0;
            color: inherit;
            font-size: 0.875rem;
            line-height: 1.6;
        }

        /* Images */
        .post-content img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            margin: 1.5rem 0;
            box-shadow: var(--shadow-lg);
        }

        /* Tables */
        .post-content table {
            width: 100%;
            margin: 1.5rem 0;
            border-collapse: collapse;
            font-size: 0.95rem;
        }

        .post-content th,
        .post-content td {
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            text-align: left;
        }

        .post-content th {
            background: var(--bg-secondary);
            font-weight: 600;
        }

        .post-content tr:nth-child(even) {
            background: var(--bg-secondary);
        }

        /* Math */
        .math-display {
            margin: 1.5rem 0;
            overflow-x: auto;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: 8px;
        }

        /* Anchor links */
        .anchor-link {
            opacity: 0;
            margin-left: 0.5rem;
            color: var(--text-muted);
            font-weight: 400;
            transition: opacity 0.2s;
        }

        .post-content h2:hover .anchor-link,
        .post-content h3:hover .anchor-link,
        .post-content h4:hover .anchor-link {
            opacity: 1;
        }

        /* Theme Toggle */
        .theme-toggle {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            box-shadow: var(--shadow-lg);
            transition: transform 0.2s, background 0.2s;
            z-index: 1000;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
            background: var(--primary-hover);
        }

        /* Comments Section */
        .comments-section {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
        }

        .comments-section h3 {
            font-size: 1.25rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Footer */
        .post-footer {
            margin-top: 3rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
            text-align: center;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .toc-sidebar {
                display: none;
            }
            
            .page-wrapper {
                padding: 1.5rem;
            }
        }

        @media (max-width: 768px) {
            .post-header h1 {
                font-size: 1.75rem;
            }
            
            .post-meta {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .theme-toggle {
                bottom: 1rem;
                right: 1rem;
                width: 44px;
                height: 44px;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }
    </style>
</head>
<body>
    <div class="page-wrapper">
        <!-- TOC Sidebar -->
        <aside class="toc-sidebar">
            <div class="toc-container">
                <h3><i class="fas fa-list"></i> ç›®å½•</h3>
                <div class="toc">
<ul>
<li><a href="#ç›®å½•">ç›®å½•</a></li>
<li><a href="#-swanlabç®€ä»‹">ğŸ‘‹ SwanLabç®€ä»‹</a></li>
<li><a href="#-ç¯å¢ƒé…ç½®">ğŸŒ ç¯å¢ƒé…ç½®</a></li>
<li><a href="#-å‡†å¤‡æ•°æ®é›†">ğŸ“š å‡†å¤‡æ•°æ®é›†</a></li>
<li><a href="#-æ¨¡å‹ä¸‹è½½ä¸åŠ è½½">ğŸ¤– æ¨¡å‹ä¸‹è½½ä¸åŠ è½½</a></li>
<li><a href="#-é›†æˆswanlab">ğŸ¦â€ é›†æˆSwanLab</a></li>
<li><a href="#-å¼€å§‹å¾®è°ƒ">ğŸš€ å¼€å§‹å¾®è°ƒ</a></li>
<li><a href="#-è®­ç»ƒç»“æœæ¼”ç¤º">ğŸ’» è®­ç»ƒç»“æœæ¼”ç¤º</a></li>
<li><a href="#è¡¥å……">è¡¥å……</a><ul>
<li><a href="#05b15b7b14bæ¨¡å‹åœ¨æ³•å¾‹é—®ç­”ä»»åŠ¡ä¸Šçš„è¡¨ç°å¯¹æ¯”">0.5B/1.5B/7B/14Bæ¨¡å‹åœ¨æ³•å¾‹é—®ç­”ä»»åŠ¡ä¸Šçš„è¡¨ç°å¯¹æ¯”</a></li>
<li><a href="#è¯¦ç»†ç¡¬ä»¶é…ç½®å’Œå‚æ•°è¯´æ˜">è¯¦ç»†ç¡¬ä»¶é…ç½®å’Œå‚æ•°è¯´æ˜</a></li>
</ul>
</li>
</ul>
</div>

            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <article>
                <header class="post-header">
                    <a href="../../../../index.html" class="back-link">
                        <i class="fas fa-arrow-left"></i> è¿”å›åšå®¢åˆ—è¡¨
                    </a>
                    <h1>æ›´æ¢ pypi æºåŠ é€Ÿåº“çš„å®‰è£…</h1>
                    <div class="post-meta">
                        <span><i class="fas fa-calendar-alt"></i> 2026-01-28</span>
                        <span><i class="fas fa-folder"></i> å¤§æ¨¡å‹/07.å®æˆ˜ç¯‡/101.Qwen2.5-7B-Instruct</span>
                        <span><i class="fas fa-user"></i> Hongwei Zhao</span>
                    </div>
                    <div class="tags">
                        
                    </div>
                </header>

                <div class="post-content">
                    <p>æœ¬èŠ‚æˆ‘ä»¬ç®€è¦ä»‹ç»åŸºäº transformersã€peft ç­‰æ¡†æ¶ï¼Œä½¿ç”¨ Qwen2.5-7B-Instruct æ¨¡å‹åœ¨<strong>ä¸­æ–‡æ³•å¾‹é—®ç­”æ•°æ®é›† DISC-Law-SFT</strong> ä¸Šè¿›è¡ŒLoraå¾®è°ƒè®­ç»ƒï¼ŒåŒæ—¶ä½¿ç”¨ <a href="https://github.com/swanhubx/swanlab">SwanLab</a> ç›‘æ§è®­ç»ƒè¿‡ç¨‹ä¸è¯„ä¼°æ¨¡å‹æ•ˆæœï¼Œå¹¶æ¯”è¾ƒ0.5B/1.5B/7B/14Bæ¨¡å‹åœ¨æ­¤ä»»åŠ¡ä¸Šçš„è¡¨ç°ã€‚</p>
<p>Lora æ˜¯ä¸€ç§é«˜æ•ˆå¾®è°ƒæ–¹æ³•ï¼Œæ·±å…¥äº†è§£å…¶åŸç†å¯å‚è§åšå®¢ï¼š<a href="https://zhuanlan.zhihu.com/p/650197598">çŸ¥ä¹|æ·±å…¥æµ…å‡º Lora</a>ã€‚</p>
<p>è®­ç»ƒè¿‡ç¨‹ï¼š<a href="https://swanlab.cn/@ZeyiLin/Qwen2.5-LoRA-Law/charts" target="_blank">Qwen2.5-LoRA-Law</a></p>
<h2 id="ç›®å½•">ç›®å½•<a class="anchor-link" href="#ç›®å½•" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="#-SwanLabç®€ä»‹">SwanLabç®€ä»‹</a></li>
<li><a href="#-ç¯å¢ƒé…ç½®">ç¯å¢ƒé…ç½®</a></li>
<li><a href="#-å‡†å¤‡æ•°æ®é›†">å‡†å¤‡æ•°æ®é›†</a></li>
<li><a href="#-æ¨¡å‹ä¸‹è½½ä¸åŠ è½½">æ¨¡å‹ä¸‹è½½ä¸åŠ è½½</a></li>
<li><a href="#-é›†æˆSwanLab">é›†æˆSwanLab</a></li>
<li><a href="#-å¼€å§‹å¾®è°ƒ">å¼€å§‹å¾®è°ƒï¼ˆå®Œæ•´ä»£ç ï¼‰</a></li>
<li><a href="#-è®­ç»ƒç»“æœæ¼”ç¤º">è®­ç»ƒç»“æœæ¼”ç¤º</a></li>
<li><a href="#è¡¥å……">è¡¥å……</a></li>
</ul>
<h2 id="-swanlabç®€ä»‹">ğŸ‘‹ SwanLabç®€ä»‹<a class="anchor-link" href="#-swanlabç®€ä»‹" title="Permanent link">&para;</a></h2>
<p><img alt="07-1" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/202412231036393.jpg" /></p>
<p><a href="https://github.com/swanhubx/swanlab">SwanLab</a> æ˜¯ä¸€ä¸ªå¼€æºçš„æ¨¡å‹è®­ç»ƒè®°å½•å·¥å…·ï¼Œé¢å‘AIç ”ç©¶è€…ï¼Œæä¾›äº†è®­ç»ƒå¯è§†åŒ–ã€è‡ªåŠ¨æ—¥å¿—è®°å½•ã€è¶…å‚æ•°è®°å½•ã€å®éªŒå¯¹æ¯”ã€å¤šäººååŒç­‰åŠŸèƒ½ã€‚åœ¨SwanLabä¸Šï¼Œç ”ç©¶è€…èƒ½åŸºäºç›´è§‚çš„å¯è§†åŒ–å›¾è¡¨å‘ç°è®­ç»ƒé—®é¢˜ï¼Œå¯¹æ¯”å¤šä¸ªå®éªŒæ‰¾åˆ°ç ”ç©¶çµæ„Ÿï¼Œå¹¶é€šè¿‡åœ¨çº¿é“¾æ¥çš„åˆ†äº«ä¸åŸºäºç»„ç»‡çš„å¤šäººååŒè®­ç»ƒï¼Œæ‰“ç ´å›¢é˜Ÿæ²Ÿé€šçš„å£å’ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆè¦è®°å½•è®­ç»ƒ</strong></p>
<p>ç›¸è¾ƒäºè½¯ä»¶å¼€å‘ï¼Œæ¨¡å‹è®­ç»ƒæ›´åƒä¸€ä¸ªå®éªŒç§‘å­¦ã€‚ä¸€ä¸ªå“è´¨ä¼˜ç§€çš„æ¨¡å‹èƒŒåï¼Œå¾€å¾€æ˜¯æˆåƒä¸Šä¸‡æ¬¡å®éªŒã€‚ç ”ç©¶è€…éœ€è¦ä¸æ–­å°è¯•ã€è®°å½•ã€å¯¹æ¯”ï¼Œç§¯ç´¯ç»éªŒï¼Œæ‰èƒ½æ‰¾åˆ°æœ€ä½³çš„æ¨¡å‹ç»“æ„ã€è¶…å‚æ•°ä¸æ•°æ®é…æ¯”ã€‚åœ¨è¿™ä¹‹ä¸­ï¼Œå¦‚ä½•é«˜æ•ˆè¿›è¡Œè®°å½•ä¸å¯¹æ¯”ï¼Œå¯¹äºç ”ç©¶æ•ˆç‡çš„æå‡è‡³å…³é‡è¦ã€‚</p>
<h2 id="-ç¯å¢ƒé…ç½®">ğŸŒ ç¯å¢ƒé…ç½®<a class="anchor-link" href="#-ç¯å¢ƒé…ç½®" title="Permanent link">&para;</a></h2>
<p>ç¯å¢ƒé…ç½®åˆ†ä¸ºä¸‰æ­¥ï¼š</p>
<ol>
<li>
<p>ç¡®ä¿ä½ çš„ç”µè„‘ä¸Šè‡³å°‘æœ‰ä¸€å¼ è‹±ä¼Ÿè¾¾æ˜¾å¡ï¼Œå¹¶å·²å®‰è£…å¥½äº†CUDAç¯å¢ƒã€‚</p>
</li>
<li>
<p>å®‰è£…Pythonï¼ˆç‰ˆæœ¬&gt;=3.8ï¼‰ä»¥åŠèƒ½å¤Ÿè°ƒç”¨CUDAåŠ é€Ÿçš„PyTorchã€‚</p>
</li>
<li>
<p>å®‰è£…å¾®è°ƒç›¸å…³çš„ç¬¬ä¸‰æ–¹åº“ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p>
</li>
</ol>
<pre><code class="language-bash">python -m pip install --upgrade pip
# æ›´æ¢ pypi æºåŠ é€Ÿåº“çš„å®‰è£…
pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple

pip install modelscope==1.18.0
pip install transformers==4.44.2
pip install sentencepiece==0.2.0
pip install accelerate==0.34.2
pip install datasets==2.20.0
pip install peft==0.11.1
pip install swanlab==0.3.23
</code></pre>
<h2 id="-å‡†å¤‡æ•°æ®é›†">ğŸ“š å‡†å¤‡æ•°æ®é›†<a class="anchor-link" href="#-å‡†å¤‡æ•°æ®é›†" title="Permanent link">&para;</a></h2>
<p>æœ¬èŠ‚ä½¿ç”¨çš„æ˜¯ <a href="https://huggingface.co/datasets/ShengbinYue/DISC-Law-SFT">DISC-Law-SFT</a> æ•°æ®é›†ï¼Œè¯¥æ•°æ®é›†ä¸»è¦ç”¨äºä¸­æ–‡æ³•å¾‹å¤§è¯­è¨€æ¨¡å‹çš„å¾®è°ƒã€‚</p>
<blockquote>
<p>HF READMEï¼šåœ¨ä¸­å›½ï¼Œæ³•å¾‹æ™ºèƒ½ç³»ç»Ÿéœ€è¦ç»“åˆå„ç§èƒ½åŠ›ï¼ŒåŒ…æ‹¬æ³•å¾‹æ–‡æœ¬ç†è§£å’Œç”Ÿæˆã€‚ä¸ºäº†å®ç°è¿™ä¸€ç›®æ ‡ï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªé«˜è´¨é‡çš„ç›‘ç£å¾®è°ƒæ•°æ®é›†ï¼Œåä¸ºDISC-Law-SFTï¼Œæ¶µç›–äº†ä¸åŒçš„æ³•å¾‹åœºæ™¯ï¼Œå¦‚æ³•å¾‹ä¿¡æ¯æå–ã€æ³•å¾‹åˆ¤å†³é¢„æµ‹ã€æ³•å¾‹æ–‡ä»¶æ‘˜è¦å’Œæ³•å¾‹é—®é¢˜å›ç­”ã€‚DISC-Law-SFTåŒ…æ‹¬ä¸¤ä¸ªå­é›†ï¼ŒDISC-Law-SFT-Pairå’ŒDISC-Law-SFT-Tripletã€‚å‰è€…æ—¨åœ¨å‘LLMå¼•å…¥æ³•å¾‹æ¨ç†èƒ½åŠ›ï¼Œè€Œåè€…æœ‰åŠ©äºå¢å¼ºæ¨¡å‹åˆ©ç”¨å¤–éƒ¨æ³•å¾‹çŸ¥è¯†çš„èƒ½åŠ›ã€‚</p>
</blockquote>
<p><img alt="07-2" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/202412231036394.png" /></p>
<p>åœ¨æœ¬èŠ‚çš„ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦ä½¿ç”¨å…¶ä¸­çš„ <a href="https://huggingface.co/datasets/ShengbinYue/DISC-Law-SFT/blob/main/DISC-Law-SFT-Pair-QA-released.jsonl">DISC-Law-SFT-Pair-QA-released</a> å­é›†ï¼Œå¹¶å¯¹å®ƒè¿›è¡Œæ ¼å¼è°ƒæ•´ï¼Œç»„åˆæˆå¦‚ä¸‹æ ¼å¼çš„jsonæ–‡ä»¶ï¼š</p>
<pre><code class="language-json">{
  &quot;instruction&quot;: &quot;ä½ æ˜¯ä¸€ä¸ªæ³•å¾‹ä¸“å®¶ï¼Œè¯·æ ¹æ®ç”¨æˆ·çš„é—®é¢˜ç»™å‡ºä¸“ä¸šçš„å›ç­”&quot;,
  &quot;input&quot;: &quot;è¯ˆéª—ç½ªé‡åˆ‘æ ‡å‡†æ˜¯ä»€ä¹ˆ?&quot;,
  &quot;output&quot;: &quot;è¯ˆéª—ç½ªæŒ‡çš„æ˜¯ä»¥éæ³•å æœ‰ä¸ºç›®çš„ï¼Œä½¿ç”¨æ¬ºéª—æ–¹æ³•ï¼Œéª—å–æ•°é¢è¾ƒå¤§çš„å…¬ç§è´¢ç‰©çš„è¡Œä¸º...&quot;
}
</code></pre>
<p>å…¶ä¸­ï¼Œ<code>instruction</code> æ˜¯ç”¨æˆ·æŒ‡ä»¤ï¼Œå‘ŠçŸ¥æ¨¡å‹å…¶éœ€è¦å®Œæˆçš„ä»»åŠ¡ï¼›<code>input</code> æ˜¯ç”¨æˆ·è¾“å…¥ï¼Œå³æ¨¡æ‹ŸçœŸå®åœºæ™¯ä¸‹ç”¨æˆ·çš„é—®é¢˜ï¼›<code>output</code> æ˜¯æ¨¡å‹åº”è¯¥ç»™å‡ºçš„è¾“å‡ºï¼Œå³æ¨¡å‹çš„å›ç­”ã€‚</p>
<p><strong>æ•°æ®é›†ä¸‹è½½ä¸å¤„ç†æ–¹å¼</strong></p>
<ol>
<li>åœ¨HuggingFaceä¸Šç›´æ¥ä¸‹è½½<a href="https://huggingface.co/datasets/ShengbinYue/DISC-Law-SFT/blob/main/DISC-Law-SFT-Pair-QA-released.jsonl">DISC-Law-SFT-Pair-QA-released.jsonl</a>ï¼Œæ”¾åˆ°é¡¹ç›®æ ¹ç›®å½•ä¸‹</li>
<li>åœ¨åŒä¸€ç›®å½•ä¸‹ï¼Œç”¨ä»¥ä¸‹ä»£ç å¤„ç†æ•°æ®é›†ï¼Œå¾—åˆ°æ–°æ•°æ®é›†æ–‡ä»¶ï¼š</li>
</ol>
<pre><code class="language-python">import json

# å®šä¹‰å›ºå®šçš„instruction
INSTRUCTION = &quot;ä½ æ˜¯ä¸€ä¸ªæ³•å¾‹ä¸“å®¶ï¼Œè¯·æ ¹æ®ç”¨æˆ·çš„é—®é¢˜ç»™å‡ºä¸“ä¸šçš„å›ç­”&quot;

def process_jsonl(input_file, output_file):
    with open(input_file, 'r', encoding='utf-8') as infile, open(output_file, 'w', encoding='utf-8') as outfile:
        for line in infile:
            # è¯»å–æ¯ä¸€è¡Œå¹¶è§£æJSON
            data = json.loads(line)

            # åˆ›å»ºæ–°çš„å­—å…¸ï¼ŒåŒ…å«instruction, inputå’Œoutput
            new_data = {
                &quot;instruction&quot;: INSTRUCTION,
                &quot;input&quot;: data[&quot;input&quot;],
                &quot;output&quot;: data[&quot;output&quot;]
            }

            # å°†æ–°çš„å­—å…¸å†™å…¥è¾“å‡ºæ–‡ä»¶
            json.dump(new_data, outfile, ensure_ascii=False)
            outfile.write('\n')

# ä½¿ç”¨ç¤ºä¾‹
input_file = &quot;DISC-Law-SFT-Pair-QA-released.jsonl&quot;
output_file = &quot;DISC-Law-SFT-Pair-QA-released-new.jsonl&quot;

process_jsonl(input_file, output_file)
print(f&quot;å¤„ç†å®Œæˆã€‚è¾“å‡ºæ–‡ä»¶ï¼š{output_file}&quot;)
</code></pre>
<ol start="3">
<li>è‡³æ­¤æˆ‘ä»¬å®Œæˆäº†æ•°æ®é›†å‡†å¤‡</li>
</ol>
<h2 id="-æ¨¡å‹ä¸‹è½½ä¸åŠ è½½">ğŸ¤– æ¨¡å‹ä¸‹è½½ä¸åŠ è½½<a class="anchor-link" href="#-æ¨¡å‹ä¸‹è½½ä¸åŠ è½½" title="Permanent link">&para;</a></h2>
<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨modelscopeä¸‹è½½Qwen2.5-7B-Instructæ¨¡å‹ï¼Œç„¶åæŠŠå®ƒåŠ è½½åˆ°Transformersä¸­è¿›è¡Œè®­ç»ƒï¼š</p>
<pre><code class="language-python">from modelscope import snapshot_download, AutoTokenizer
from transformers import AutoModelForCausalLM, TrainingArguments, Trainer, DataCollatorForSeq2Seq
import torch

# åœ¨modelscopeä¸Šä¸‹è½½Qwenæ¨¡å‹åˆ°æœ¬åœ°ç›®å½•ä¸‹
model_dir = snapshot_download(&quot;qwen/Qwen2.5-7B-Instruct&quot;, cache_dir=&quot;./&quot;, revision=&quot;master&quot;)

# TransformersåŠ è½½æ¨¡å‹æƒé‡
tokenizer = AutoTokenizer.from_pretrained(&quot;./qwen/Qwen2___5-7B-Instruct/&quot;, use_fast=False,trust_remote_code=True)
model = AutoModelForCausalLM.from_pretrained(&quot;./qwen/Qwen2___5-7B-Instruct/&quot;, device_map=&quot;auto&quot;,torch_dtype=torch.bfloat16)
model.enable_input_require_grads()  # å¼€å¯æ¢¯åº¦æ£€æŸ¥ç‚¹æ—¶ï¼Œè¦æ‰§è¡Œè¯¥æ–¹æ³•
</code></pre>
<p>æ¨¡å‹å¤§å°ä¸º 15GBï¼Œä¸‹è½½æ¨¡å‹å¤§æ¦‚éœ€è¦ 5 åˆ†é’Ÿã€‚</p>
<h2 id="-é›†æˆswanlab">ğŸ¦â€ é›†æˆSwanLab<a class="anchor-link" href="#-é›†æˆswanlab" title="Permanent link">&para;</a></h2>
<p>SwanLabä¸Transformerså·²ç»åšå¥½äº†é›†æˆï¼Œç”¨æ³•æ˜¯åœ¨Trainerçš„<code>callbacks</code>å‚æ•°ä¸­æ·»åŠ <code>SwanLabCallback</code>å®ä¾‹ï¼Œå°±å¯ä»¥è‡ªåŠ¨è®°å½•è¶…å‚æ•°å’Œè®­ç»ƒæŒ‡æ ‡ï¼Œç®€åŒ–ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-python">from swanlab.integration.transformers import SwanLabCallback
from transformers import Trainer

swanlab_callback = SwanLabCallback()

trainer = Trainer(
    ...
    callbacks=[swanlab_callback],
)
</code></pre>
<p>é¦–æ¬¡ä½¿ç”¨SwanLabï¼Œéœ€è¦å…ˆåœ¨<a href="https://swanlab.cn">å®˜ç½‘</a>æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œç„¶ååœ¨ç”¨æˆ·è®¾ç½®é¡µé¢å¤åˆ¶ä½ çš„API Keyï¼Œç„¶ååœ¨è®­ç»ƒå¼€å§‹æç¤ºç™»å½•æ—¶ç²˜è´´å³å¯ï¼Œåç»­æ— éœ€å†æ¬¡ç™»å½•ï¼š</p>
<p><img alt="07-3" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/202412231036395.png" /></p>
<p>æ›´å¤šç”¨æ³•å¯å‚è€ƒ<a href="https://docs.swanlab.cn/zh/guide_cloud/general/quick-start.html">å¿«é€Ÿå¼€å§‹</a>ã€<a href="https://docs.swanlab.cn/zh/guide_cloud/integration/integration-huggingface-transformers.html">Transformersé›†æˆ</a>ã€‚</p>
<h2 id="-å¼€å§‹å¾®è°ƒ">ğŸš€ å¼€å§‹å¾®è°ƒ<a class="anchor-link" href="#-å¼€å§‹å¾®è°ƒ" title="Permanent link">&para;</a></h2>
<p>æŸ¥çœ‹å¯è§†åŒ–è®­ç»ƒè¿‡ç¨‹ï¼š<a href="https://swanlab.cn/@ZeyiLin/Qwen2.5-LoRA-Law/charts" target="_blank">Qwen2.5-LoRA-Law</a></p>
<p><strong>æœ¬èŠ‚ä»£ç åšäº†ä»¥ä¸‹å‡ ä»¶äº‹</strong>ï¼š<br />
1. ä¸‹è½½å¹¶åŠ è½½Qwen2.5-7B-Instructæ¨¡å‹<br />
2. åŠ è½½æ•°æ®é›†ï¼Œå–å‰5000æ¡æ•°æ®å‚ä¸è®­ç»ƒï¼Œ5æ¡æ•°æ®è¿›è¡Œä¸»è§‚è¯„æµ‹<br />
3. é…ç½®Loraï¼Œå‚æ•°ä¸ºr=64, lora_alpha=16, lora_dropout=0.1<br />
4. ä½¿ç”¨SwanLabè®°å½•è®­ç»ƒè¿‡ç¨‹ï¼ŒåŒ…æ‹¬è¶…å‚æ•°ã€æŒ‡æ ‡å’Œæ¯ä¸ªepochçš„æ¨¡å‹è¾“å‡ºç»“æœ<br />
5. è®­ç»ƒ2ä¸ªepoch</p>
<p><strong>å®Œæ•´ä»£ç å¦‚ä¸‹</strong></p>
<pre><code class="language-python">import json
import pandas as pd
import torch
from datasets import Dataset
from modelscope import snapshot_download, AutoTokenizer
from swanlab.integration.transformers import SwanLabCallback
from peft import LoraConfig, TaskType, get_peft_model
from transformers import (
    AutoModelForCausalLM,
    TrainingArguments,
    Trainer,
    DataCollatorForSeq2Seq,
)
import swanlab


def process_func(example):
    &quot;&quot;&quot;
    å°†æ•°æ®é›†è¿›è¡Œé¢„å¤„ç†
    &quot;&quot;&quot;
    MAX_LENGTH = 384
    input_ids, attention_mask, labels = [], [], []
    instruction = tokenizer(
        f&quot;&lt;|im_start|&gt;system\n{example['instruction']}&lt;|im_end|&gt;\n&lt;|im_start|&gt;user\n{example['input']}&lt;|im_end|&gt;\n&lt;|im_start|&gt;assistant\n&quot;,
        add_special_tokens=False,
    )
    response = tokenizer(f&quot;{example['output']}&quot;, add_special_tokens=False)
    input_ids = (
        instruction[&quot;input_ids&quot;] + response[&quot;input_ids&quot;] + [tokenizer.pad_token_id]
    )
    attention_mask = instruction[&quot;attention_mask&quot;] + response[&quot;attention_mask&quot;] + [1]
    labels = (
        [-100] * len(instruction[&quot;input_ids&quot;])
        + response[&quot;input_ids&quot;]
        + [tokenizer.pad_token_id]
    )
    if len(input_ids) &gt; MAX_LENGTH:  # åšä¸€ä¸ªæˆªæ–­
        input_ids = input_ids[:MAX_LENGTH]
        attention_mask = attention_mask[:MAX_LENGTH]
        labels = labels[:MAX_LENGTH]

    return {&quot;input_ids&quot;: input_ids, &quot;attention_mask&quot;: attention_mask, &quot;labels&quot;: labels}


def predict(messages, model, tokenizer):
    device = &quot;cuda&quot;
    text = tokenizer.apply_chat_template(
        messages, tokenize=False, add_generation_prompt=True
    )
    model_inputs = tokenizer([text], return_tensors=&quot;pt&quot;).to(device)

    generated_ids = model.generate(model_inputs.input_ids, max_new_tokens=512)
    generated_ids = [
        output_ids[len(input_ids) :]
        for input_ids, output_ids in zip(model_inputs.input_ids, generated_ids)
    ]

    response = tokenizer.batch_decode(generated_ids, skip_special_tokens=True)[0]

    return response


# åœ¨modelscopeä¸Šä¸‹è½½Qwenæ¨¡å‹åˆ°æœ¬åœ°ç›®å½•ä¸‹
model_dir = snapshot_download(&quot;qwen/Qwen2.5-7B-Instruct&quot;, cache_dir=&quot;./&quot;, revision=&quot;master&quot;)

# TransformersåŠ è½½æ¨¡å‹æƒé‡
tokenizer = AutoTokenizer.from_pretrained(&quot;./qwen/Qwen2___5-7B-Instruct/&quot;, use_fast=False, trust_remote_code=True)
model = AutoModelForCausalLM.from_pretrained(&quot;./qwen/Qwen2___5-7B-Instruct/&quot;, device_map=&quot;auto&quot;, torch_dtype=torch.bfloat16)
model.enable_input_require_grads()  # å¼€å¯æ¢¯åº¦æ£€æŸ¥ç‚¹æ—¶ï¼Œè¦æ‰§è¡Œè¯¥æ–¹æ³•

# å¤„ç†æ•°æ®é›†
train_jsonl_path = &quot;DISC-Law-SFT-Pair-QA-released-new.jsonl&quot;
train_df = pd.read_json(train_jsonl_path, lines=True)[5:5000]
train_ds = Dataset.from_pandas(train_df)
train_dataset = train_ds.map(process_func, remove_columns=train_ds.column_names)
test_df = pd.read_json(train_jsonl_path, lines=True)[:5]

config = LoraConfig(
    task_type=TaskType.CAUSAL_LM,
    target_modules=[
        &quot;q_proj&quot;,
        &quot;k_proj&quot;,
        &quot;v_proj&quot;,
        &quot;o_proj&quot;,
        &quot;gate_proj&quot;,
        &quot;up_proj&quot;,
        &quot;down_proj&quot;,
    ],
    inference_mode=False,  # è®­ç»ƒæ¨¡å¼
    r=64,  # Lora ç§©
    lora_alpha=16,  # Lora alaphï¼Œå…·ä½“ä½œç”¨å‚è§ Lora åŸç†
    lora_dropout=0.1,  # Dropout æ¯”ä¾‹
)

peft_model = get_peft_model(model, config)

args = TrainingArguments(
    output_dir=&quot;./output/Qwen2.5-7b&quot;,
    per_device_train_batch_size=4,
    gradient_accumulation_steps=4,
    logging_steps=10,
    num_train_epochs=2,
    save_steps=100,
    learning_rate=1e-4,
    save_on_each_node=True,
    gradient_checkpointing=True,
    report_to=&quot;none&quot;,
)

class HuanhuanSwanLabCallback(SwanLabCallback):   
    def on_train_begin(self, args, state, control, model=None, **kwargs):
        if not self._initialized:
            self.setup(args, state, model, **kwargs)

        print(&quot;è®­ç»ƒå¼€å§‹&quot;)
        print(&quot;æœªå¼€å§‹å¾®è°ƒï¼Œå…ˆå–3æ¡ä¸»è§‚è¯„æµ‹ï¼š&quot;)
        test_text_list = []
        for index, row in test_df[:3].iterrows():
            instruction = row[&quot;instruction&quot;]
            input_value = row[&quot;input&quot;]

            messages = [
                {&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: f&quot;{instruction}&quot;},
                {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: f&quot;{input_value}&quot;},
            ]

            response = predict(messages, peft_model, tokenizer)
            messages.append({&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: f&quot;{response}&quot;})

            result_text = f&quot;ã€Qã€‘{messages[1]['content']}\nã€LLMã€‘{messages[2]['content']}\n&quot;
            print(result_text)

            test_text_list.append(swanlab.Text(result_text, caption=response))

        swanlab.log({&quot;Prediction&quot;: test_text_list}, step=0)

    def on_epoch_end(self, args, state, control, **kwargs):
        # ===================æµ‹è¯•é˜¶æ®µ======================
        test_text_list = []
        for index, row in test_df.iterrows():
            instruction = row[&quot;instruction&quot;]
            input_value = row[&quot;input&quot;]
            ground_truth = row[&quot;output&quot;]

            messages = [
                {&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: f&quot;{instruction}&quot;},
                {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: f&quot;{input_value}&quot;},
            ]

            response = predict(messages, peft_model, tokenizer)
            messages.append({&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: f&quot;{response}&quot;})

            if index == 0:
                print(&quot;epoch&quot;, round(state.epoch), &quot;ä¸»è§‚è¯„æµ‹ï¼š&quot;)

            result_text = f&quot;ã€Qã€‘{messages[1]['content']}\nã€LLMã€‘{messages[2]['content']}\nã€GTã€‘ {ground_truth}&quot;
            print(result_text)

            test_text_list.append(swanlab.Text(result_text, caption=response))

        swanlab.log({&quot;Prediction&quot;: test_text_list}, step=round(state.epoch))


swanlab_callback = HuanhuanSwanLabCallback(
    project=&quot;Qwen2.5-LoRA-Law&quot;,
    experiment_name=&quot;7b&quot;,
    config={
        &quot;model&quot;: &quot;https://modelscope.cn/models/Qwen/Qwen2.5-7B-Instruct&quot;,
        &quot;dataset&quot;: &quot;https://huggingface.co/datasets/ShengbinYue/DISC-Law-SFT&quot;,
        &quot;github&quot;: &quot;https://github.com/datawhalechina/self-llm&quot;,
        &quot;system_prompt&quot;: &quot;ä½ æ˜¯ä¸€ä¸ªæ³•å¾‹ä¸“å®¶ï¼Œè¯·æ ¹æ®ç”¨æˆ·çš„é—®é¢˜ç»™å‡ºä¸“ä¸šçš„å›ç­”&quot;,
        &quot;lora_rank&quot;: 64,
        &quot;lora_alpha&quot;: 16,
        &quot;lora_dropout&quot;: 0.1,
    },
)

trainer = Trainer(
    model=peft_model,
    args=args,
    train_dataset=train_dataset,
    data_collator=DataCollatorForSeq2Seq(tokenizer=tokenizer, padding=True),
    callbacks=[swanlab_callback],
)

trainer.train()

# åœ¨Jupyter Notebookä¸­è¿è¡Œæ—¶è¦åœæ­¢SwanLabè®°å½•ï¼Œéœ€è¦è°ƒç”¨swanlab.finish()
swanlab.finish()
</code></pre>
<p>çœ‹åˆ°ä¸‹é¢çš„è¿›åº¦æ¡å³ä»£è¡¨è®­ç»ƒå¼€å§‹ï¼š</p>
<p><img alt="07-4" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/202412231036396.png" /></p>
<h2 id="-è®­ç»ƒç»“æœæ¼”ç¤º">ğŸ’» è®­ç»ƒç»“æœæ¼”ç¤º<a class="anchor-link" href="#-è®­ç»ƒç»“æœæ¼”ç¤º" title="Permanent link">&para;</a></h2>
<p><img alt="07-5" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/202412231036397.png" /></p>
<p>ä»å›¾è¡¨ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œlrçš„ä¸‹é™ç­–ç•¥æ˜¯çº¿æ€§ä¸‹é™ï¼Œlosséšepochå‘ˆç°ä¸‹é™è¶‹åŠ¿ï¼Œè€Œgrad_normåˆ™åœ¨ä¸Šå‡ã€‚è¿™ç§å½¢æ€å¾€å¾€åæ˜ äº†æ¨¡å‹æœ‰è¿‡æ‹Ÿåˆçš„é£é™©ï¼Œè®­ç»ƒä¸è¦è¶…è¿‡2ä¸ªepochã€‚</p>
<p>åœ¨<code>Prediction</code>å›¾è¡¨ä¸­è®°å½•ç€æ¯ä¸ªepochçš„æ¨¡å‹è¾“å‡ºç»“æœï¼Œå¯ä»¥ç›´è§‚çœ‹åˆ°åœ¨å¾®è°ƒè¿‡ç¨‹ä¸­ï¼Œæ¨¡å‹å¯¹åŒä¸€è¾“å…¥æ–‡æœ¬çš„è¾“å‡ºå˜åŒ–ï¼š</p>
<p>æ²¡æœ‰è¢«å¾®è°ƒçš„æ¨¡å‹ï¼š<br />
<img alt="07-6" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/202412231036398.png" /></p>
<p>å¾®è°ƒåï¼š<br />
<img alt="07-7" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/202412231036399.png" /></p>
<p>å¯ä»¥çœ‹åˆ°Loraå¾®è°ƒåçš„æ¨¡å‹ï¼Œåœ¨å›ç­”çš„é£æ ¼ä¸Šè¦æ›´è´´è¿‘æ•°æ®é›†ï¼Œæ›´ç¬¦åˆé¢„æœŸã€‚</p>
<h2 id="è¡¥å……">è¡¥å……<a class="anchor-link" href="#è¡¥å……" title="Permanent link">&para;</a></h2>
<h3 id="05b15b7b14bæ¨¡å‹åœ¨æ³•å¾‹é—®ç­”ä»»åŠ¡ä¸Šçš„è¡¨ç°å¯¹æ¯”">0.5B/1.5B/7B/14Bæ¨¡å‹åœ¨æ³•å¾‹é—®ç­”ä»»åŠ¡ä¸Šçš„è¡¨ç°å¯¹æ¯”<a class="anchor-link" href="#05b15b7b14bæ¨¡å‹åœ¨æ³•å¾‹é—®ç­”ä»»åŠ¡ä¸Šçš„è¡¨ç°å¯¹æ¯”" title="Permanent link">&para;</a></h3>
<p>è¿™é‡Œæˆ‘ä»¬è¡¥å……ä¸€ç»„å®éªŒï¼Œæ¢ç©¶åŒä¸€ä¸ªæ•°æ®é›†çš„loraå¾®è°ƒä»»åŠ¡ï¼Œä¸åŒè§„æ¨¡å¤§å°çš„æ¨¡å‹çš„è¡¨ç°ã€‚</p>
<p><img alt="07-8" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/202412231036400.png" /></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè¶Šå¤§è§„æ¨¡çš„æ¨¡å‹ï¼Œlossæ˜æ˜¾è¦è¶Šä½ï¼Œåæ˜ äº†æ¨¡å‹çš„å­¦ä¹ èƒ½åŠ›ã€‚</p>
<h3 id="è¯¦ç»†ç¡¬ä»¶é…ç½®å’Œå‚æ•°è¯´æ˜">è¯¦ç»†ç¡¬ä»¶é…ç½®å’Œå‚æ•°è¯´æ˜<a class="anchor-link" href="#è¯¦ç»†ç¡¬ä»¶é…ç½®å’Œå‚æ•°è¯´æ˜" title="Permanent link">&para;</a></h3>
<p>ä½¿ç”¨4å¼ A100 40GBæ˜¾å¡ï¼Œbatch sizeä¸º4ï¼Œgradient accumulation stepsä¸º4ï¼Œè®­ç»ƒ2ä¸ªepochçš„ç”¨æ—¶ä¸º29åˆ†é’Ÿ6ç§’ã€‚</p>
<p><img alt="07-9" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/202412231036401.png" /></p>
                </div>

                <!-- Comments Section (Giscus) -->
                <section class="comments-section">
                    <h3><i class="fas fa-comments"></i> è¯„è®º</h3>
                    <script src="https://giscus.app/client.js"
                        data-repo="Geeks-Z/Geeks-Z.github.io"
                        data-repo-id=""
                        data-category="Announcements"
                        data-category-id=""
                        data-mapping="pathname"
                        data-strict="0"
                        data-reactions-enabled="1"
                        data-emit-metadata="0"
                        data-input-position="bottom"
                        data-theme="preferred_color_scheme"
                        data-lang="zh-CN"
                        crossorigin="anonymous"
                        async>
                    </script>
                </section>
            </article>

            <footer class="post-footer">
                <p>Â© 2025 Hongwei Zhao. Built with â¤ï¸</p>
            </footer>
        </main>
    </div>

    <!-- Theme Toggle Button -->
    <button class="theme-toggle" id="themeToggle" aria-label="åˆ‡æ¢ä¸»é¢˜">
        <i class="fas fa-moon"></i>
    </button>

    <script>
        // Theme Toggle
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;
        const icon = themeToggle.querySelector('i');
        const hljsDark = document.getElementById('hljs-theme-dark');
        const hljsLight = document.getElementById('hljs-theme-light');
        
        // Check saved theme or system preference
        const savedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        
        if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
            html.setAttribute('data-theme', 'dark');
            icon.className = 'fas fa-sun';
            hljsDark.disabled = false;
            hljsLight.disabled = true;
        }
        
        themeToggle.addEventListener('click', () => {
            const isDark = html.getAttribute('data-theme') === 'dark';
            if (isDark) {
                html.removeAttribute('data-theme');
                icon.className = 'fas fa-moon';
                localStorage.setItem('theme', 'light');
                hljsDark.disabled = true;
                hljsLight.disabled = false;
            } else {
                html.setAttribute('data-theme', 'dark');
                icon.className = 'fas fa-sun';
                localStorage.setItem('theme', 'dark');
                hljsDark.disabled = false;
                hljsLight.disabled = true;
            }
            
            // Update Giscus theme
            const giscusFrame = document.querySelector('iframe.giscus-frame');
            if (giscusFrame) {
                giscusFrame.contentWindow.postMessage({
                    giscus: {
                        setConfig: {
                            theme: isDark ? 'light' : 'dark'
                        }
                    }
                }, 'https://giscus.app');
            }
        });
        
        // Highlight.js
        document.addEventListener('DOMContentLoaded', () => {
            hljs.highlightAll();
        });
        
        // KaTeX auto-render
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof renderMathInElement !== 'undefined') {
                renderMathInElement(document.body, {
                    delimiters: [
                        {left: '$$', right: '$$', display: true},
                        {left: '$', right: '$', display: false},
                        {left: '\\[', right: '\\]', display: true},
                        {left: '\\(', right: '\\)', display: false}
                    ],
                    throwOnError: false
                });
            }
        });
        
        // TOC active state
        const tocLinks = document.querySelectorAll('.toc-container a');
        const headings = document.querySelectorAll('.post-content h2, .post-content h3, .post-content h4');
        
        function updateTocActive() {
            let current = '';
            headings.forEach(heading => {
                const rect = heading.getBoundingClientRect();
                if (rect.top <= 100) {
                    current = heading.getAttribute('id');
                }
            });
            
            tocLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + current) {
                    link.classList.add('active');
                }
            });
        }
        
        window.addEventListener('scroll', updateTocActive);
        updateTocActive();
    </script>
</body>
</html>
