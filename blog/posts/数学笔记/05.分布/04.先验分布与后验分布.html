<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>先验分布与后验分布</title>
    <meta name="description" content="先验分布与后验分布 - Hongwei Zhao's Blog">
    <meta name="author" content="Hongwei Zhao">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+SC:wght@300;400;500;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Code Highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" id="hljs-theme-dark">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css" id="hljs-theme-light" disabled>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- KaTeX for Math -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    
    <style>
        :root {
            /* Light Theme */
            --primary-color: #2980b9;
            --primary-hover: #1a5276;
            --link-color: #c0392b;
            --text-color: #333;
            --text-light: #666;
            --text-muted: #999;
            --bg-color: #fff;
            --bg-secondary: #f8f9fa;
            --bg-code: #f5f5f5;
            --border-color: #e5e7eb;
            --shadow: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-lg: 0 4px 15px rgba(0,0,0,0.1);
        }

        [data-theme="dark"] {
            --primary-color: #5dade2;
            --primary-hover: #85c1e9;
            --link-color: #e74c3c;
            --text-color: #e5e7eb;
            --text-light: #9ca3af;
            --text-muted: #6b7280;
            --bg-color: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-code: #0f0f23;
            --border-color: #374151;
            --shadow: 0 1px 3px rgba(0,0,0,0.3);
            --shadow-lg: 0 4px 15px rgba(0,0,0,0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', 'Noto Sans SC', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-size: 16px;
            line-height: 1.8;
            color: var(--text-color);
            background: var(--bg-color);
            transition: background-color 0.3s, color 0.3s;
        }

        a {
            color: var(--primary-color);
            text-decoration: none;
            transition: color 0.2s;
        }

        a:hover {
            color: var(--primary-hover);
            text-decoration: underline;
        }

        /* Layout */
        .page-wrapper {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            gap: 3rem;
        }

        /* Sidebar TOC */
        .toc-sidebar {
            width: 260px;
            flex-shrink: 0;
            position: sticky;
            top: 2rem;
            height: fit-content;
            max-height: calc(100vh - 4rem);
            overflow-y: auto;
        }

        .toc-container {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .toc-container h3 {
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .toc-container ul {
            list-style: none;
        }

        .toc-container li {
            margin-bottom: 0.5rem;
        }

        .toc-container a {
            font-size: 0.9rem;
            color: var(--text-light);
            display: block;
            padding: 0.25rem 0;
            border-left: 2px solid transparent;
            padding-left: 0.75rem;
            transition: all 0.2s;
        }

        .toc-container a:hover,
        .toc-container a.active {
            color: var(--primary-color);
            border-left-color: var(--primary-color);
            text-decoration: none;
        }

        .toc-container ul ul {
            margin-left: 1rem;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            min-width: 0;
            max-width: 800px;
        }

        /* Header */
        .post-header {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 1.5rem;
        }

        .back-link:hover {
            color: var(--primary-color);
            text-decoration: none;
        }

        .post-header h1 {
            font-size: 2.25rem;
            font-weight: 700;
            line-height: 1.3;
            margin-bottom: 1rem;
            color: var(--text-color);
        }

        .post-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .post-meta span {
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .post-meta i {
            color: var(--text-muted);
        }

        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .tag {
            display: inline-block;
            font-size: 0.8rem;
            background: var(--bg-secondary);
            color: var(--text-light);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            transition: all 0.2s;
        }

        .tag:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* Article Content */
        .post-content {
            font-size: 1rem;
            line-height: 1.9;
        }

        .post-content h1,
        .post-content h2,
        .post-content h3,
        .post-content h4,
        .post-content h5,
        .post-content h6 {
            margin-top: 2rem;
            margin-bottom: 1rem;
            font-weight: 600;
            line-height: 1.4;
            color: var(--text-color);
        }

        .post-content h1 { font-size: 1.875rem; }
        .post-content h2 { 
            font-size: 1.5rem; 
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        .post-content h3 { font-size: 1.25rem; }
        .post-content h4 { font-size: 1.125rem; }

        .post-content p {
            margin-bottom: 1.25rem;
        }

        .post-content ul,
        .post-content ol {
            margin: 1.25rem 0;
            padding-left: 1.5rem;
        }

        .post-content li {
            margin-bottom: 0.5rem;
        }

        .post-content blockquote {
            margin: 1.5rem 0;
            padding: 1rem 1.5rem;
            background: var(--bg-secondary);
            border-left: 4px solid var(--primary-color);
            border-radius: 0 8px 8px 0;
            color: var(--text-light);
            font-style: italic;
        }

        .post-content blockquote p:last-child {
            margin-bottom: 0;
        }

        /* Code */
        .post-content code {
            font-family: 'JetBrains Mono', 'Fira Code', Consolas, monospace;
            font-size: 0.9em;
            background: var(--bg-code);
            padding: 0.2em 0.4em;
            border-radius: 4px;
            color: var(--link-color);
        }

        .post-content pre {
            margin: 1.5rem 0;
            padding: 1.25rem;
            background: var(--bg-code);
            border-radius: 10px;
            overflow-x: auto;
            border: 1px solid var(--border-color);
        }

        .post-content pre code {
            background: none;
            padding: 0;
            color: inherit;
            font-size: 0.875rem;
            line-height: 1.6;
        }

        /* Images */
        .post-content img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            margin: 1.5rem 0;
            box-shadow: var(--shadow-lg);
        }

        /* Tables */
        .post-content table {
            width: 100%;
            margin: 1.5rem 0;
            border-collapse: collapse;
            font-size: 0.95rem;
        }

        .post-content th,
        .post-content td {
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            text-align: left;
        }

        .post-content th {
            background: var(--bg-secondary);
            font-weight: 600;
        }

        .post-content tr:nth-child(even) {
            background: var(--bg-secondary);
        }

        /* Math */
        .math-display {
            margin: 1.5rem 0;
            overflow-x: auto;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: 8px;
        }

        /* Anchor links */
        .anchor-link {
            opacity: 0;
            margin-left: 0.5rem;
            color: var(--text-muted);
            font-weight: 400;
            transition: opacity 0.2s;
        }

        .post-content h2:hover .anchor-link,
        .post-content h3:hover .anchor-link,
        .post-content h4:hover .anchor-link {
            opacity: 1;
        }

        /* Theme Toggle */
        .theme-toggle {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            box-shadow: var(--shadow-lg);
            transition: transform 0.2s, background 0.2s;
            z-index: 1000;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
            background: var(--primary-hover);
        }

        /* Comments Section */
        .comments-section {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
        }

        .comments-section h3 {
            font-size: 1.25rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Footer */
        .post-footer {
            margin-top: 3rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
            text-align: center;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .toc-sidebar {
                display: none;
            }
            
            .page-wrapper {
                padding: 1.5rem;
            }
        }

        @media (max-width: 768px) {
            .post-header h1 {
                font-size: 1.75rem;
            }
            
            .post-meta {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .theme-toggle {
                bottom: 1rem;
                right: 1rem;
                width: 44px;
                height: 44px;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }
    </style>
</head>
<body>
    <div class="page-wrapper">
        <!-- TOC Sidebar -->
        <aside class="toc-sidebar">
            <div class="toc-container">
                <h3><i class="fas fa-list"></i> 目录</h3>
                <div class="toc">
<ul>
<li><a href="#1回顾贝叶斯定理">1.回顾贝叶斯定理</a></li>
<li><a href="#2贝叶斯推断与后验分布">2.贝叶斯推断与后验分布</a></li>
<li><a href="#3贝叶斯推断求解过程">3.贝叶斯推断求解过程</a></li>
<li><a href="#4贝叶斯推断实际举例">4.贝叶斯推断实际举例</a></li>
<li><a href="#5模拟实验验证">5.模拟实验验证</a></li>
<li><a href="#6实验结果分析">6.实验结果分析</a></li>
<li><a href="#7关于共轭先验的问题">7.关于共轭先验的问题</a></li>
<li><a href="#什么是贝叶斯统计">什么是贝叶斯统计？</a></li>
<li><a href="#example">Example</a></li>
<li><a href="#小结">小结</a></li>
<li><a href="#附录">附录</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>

            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <article>
                <header class="post-header">
                    <a href="../../../index.html" class="back-link">
                        <i class="fas fa-arrow-left"></i> 返回博客列表
                    </a>
                    <h1>先验分布与后验分布</h1>
                    <div class="post-meta">
                        <span><i class="fas fa-calendar-alt"></i> 2026-01-28</span>
                        <span><i class="fas fa-folder"></i> 数学笔记/05.分布</span>
                        <span><i class="fas fa-user"></i> Hongwei Zhao</span>
                    </div>
                    <div class="tags">
                        
                    </div>
                </header>

                <div class="post-content">
                    <h2 id="1回顾贝叶斯定理">1.回顾贝叶斯定理<a class="anchor-link" href="#1回顾贝叶斯定理" title="Permanent link">&para;</a></h2>
<p>首先，我们先来复习一下贝叶斯定理：<br />
<div class="math-display"><br />
p(\Theta|X)=\frac{p(X|\Theta)p(\Theta)}{p(X)}<br />
</div><br />
在这个简简单单的式子当中，蕴含了我们要掌握的很多重要内容：</p>
<p><span class="math-inline">p(\Theta)</span> <strong>：先验分布。</strong> 反映的是在观测到数据之前我们对待估计的参数 <span class="math-inline">\Theta</span> 的了解和认识。</p>
<p><span class="math-inline">p(X|\Theta)</span> ： 在确定了参数的情况下，试验数据的概率分布。实际上这就是对实际观测数据的一种描述。</p>
<p><span class="math-inline">p(\Theta|X)</span> <strong>：后验分布。</strong> 后验分布就是我们通过贝叶斯定理得到的最终的分析结果，反映的是在给定观测数据的基础上，我们对于参数的新的认知。说的更直白一点，就是最开始没有观测数据的时候，我们依据以往的经验赋予了参数一个先验分布，然后来了实际的观测数据之后，我们就对先验进行了更新，得到了这次分析过程的后验分布。</p>
<p><span class="math-inline">p(X)</span> <strong>：边缘概率。</strong> 这是一个与我们待估计的参数 <span class="math-inline">\Theta</span> 无关的一个边缘概率值： <span class="math-inline">p(X)=\sum_{\theta}p(X,\Theta)=\sum_{\theta}p(X|\Theta)p(\Theta)</span> ，因此我们并不用太关心这个值，仅仅把他当做是后验概率 <span class="math-inline">p(\Theta|X)</span> 算过程中的归一化系数即可。</p>
<p>因此我们更需要聚焦的就是如下的这个正比关系：<span class="math-inline">p(\Theta|X)\propto p(X|\Theta)p(\Theta)</span></p>
<p>实际上，有一个概念需要大家树立，那就是后验分布也是不断的处在动态更新过程当中的。一次试验得到的后验分布，对于后续进一步收集到的新的观测数据，他又可以看作是后续分析的一个先验。</p>
<h2 id="2贝叶斯推断与后验分布">2.贝叶斯推断与后验分布<a class="anchor-link" href="#2贝叶斯推断与后验分布" title="Permanent link">&para;</a></h2>
<p>在贝叶斯推断中，我们将待估计的量记为 <span class="math-inline">\Theta</span> ，视其为一个随机变量，我们的目标就是基于观测到的样本数据值 <span class="math-inline">X=(X_1,X_2,...,X_n)</span> 来提取 <span class="math-inline">\Theta</span> 的信息，我们称 <span class="math-inline">X=(X_1,X_2,...,X_n)</span> 为观测值，那么我们需要首先知道或者明确以下两方面内容：</p>
<p>第一个是视作随机变量 <span class="math-inline">\Theta</span> 的待估计未知参数的先验分布 <span class="math-inline">p_{\Theta}</span>​，如果 <span class="math-inline">\Theta</span> 是连续的则相应的记作是 <span class="math-inline">f_{\Theta}</span> 。</p>
<p>第二个是基于参数 <span class="math-inline">\Theta</span> 的观测数据的分布模型，也就是条件分布 <span class="math-inline">p_{X|\Theta}</span>​或者说是 <span class="math-inline">f_{X|\Theta}</span> ​，当然这取决于 <span class="math-inline">\Theta</span> 是连续型还是离散型随机变量。</p>
<p>一旦确立了 <span class="math-inline">X</span> 的观测值 <span class="math-inline">x</span> ，贝叶斯推断的完整答案就由随机变量 <span class="math-inline">\Theta</span> 的后验分布 <span class="math-inline">p_{\Theta|X}(\theta|x)</span> 或者 <span class="math-inline">f_{\Theta|X}(\theta|x)</span> 来描述和决定，这个后验分布的计算就是依赖贝叶斯定理来进行的。后验分布的精髓就在于他利用已经得知的观测数据，抓住了关于 <span class="math-inline">\Theta</span> 的一切信息。</p>
<h2 id="3贝叶斯推断求解过程">3.贝叶斯推断求解过程<a class="anchor-link" href="#3贝叶斯推断求解过程" title="Permanent link">&para;</a></h2>
<p>这里我们总结一下上述的整个过程：</p>
<p>首先，贝叶斯推断的起点是未知随机变量 <span class="math-inline">\Theta</span> 的先验分布 <span class="math-inline">p_{\Theta}</span>​或者 <span class="math-inline">f_{\Theta}</span> ​。</p>
<p>然后，我们需要确定观测数据 <span class="math-inline">X</span> 的分布模型，他是一个基于随机变量 <span class="math-inline">\Theta</span> 的条件概率： <span class="math-inline">p_{X|\Theta}</span> ​或者 <span class="math-inline">f_{X|\Theta}</span>​。</p>
<p>一旦我们观察到了 <span class="math-inline">X</span> 的一个特定值 <span class="math-inline">x</span> 之后，我们就可以开始运用贝叶斯法则去计算 <span class="math-inline">\Theta</span> 的后验分布：</p>
<p><div class="math-display">p_{\Theta|X}(\theta|x)=\frac{p_{\Theta}(\theta)p_{X|\Theta}(x|\theta)}{p_X(x)}=\frac{p_{\Theta}(\theta)p_{X|\Theta}(x|\theta)}{\sum_{\theta'}p_{\Theta}(\theta')p_{X|\Theta}(x|\theta')}</div></p>
<p>如果是连续型的随机变量，就把上面的概率质量函数替换成概率密度函数就可以了。</p>
<h2 id="4贝叶斯推断实际举例">4.贝叶斯推断实际举例<a class="anchor-link" href="#4贝叶斯推断实际举例" title="Permanent link">&para;</a></h2>
<p>感觉说来说去，还是比较理论，很多量该怎么确定可能还是不知道如何下手。那么我们通过一个抛掷硬币的例子来把贝叶斯推断的过程演练一遍：</p>
<p>假设我们有一个并不均匀的硬币，投掷出正面和反面的概率并不是相等的0.5，因此我们通过不断的进行硬币抛掷试验来估计正面的概率 <span class="math-inline">\theta</span> 。</p>
<p>那么我们首先为 <span class="math-inline">\theta</span> 选择一个先验分布，实际上，我们对他一无所知，只知道这个 <span class="math-inline">\theta</span> 应该介于 <span class="math-inline">[0,1]</span> 之间，这个范围很粗犷，因此我们选择 <span class="math-inline">beta</span> 分布作为参数 <span class="math-inline">\theta</span> 的先验分布。</p>
<p><strong>4.1.</strong> <span class="math-inline">beta</span> <strong>先验分布</strong></p>
<p><span class="math-inline">beta</span> 分布是一个连续型随机变量的分布，他的概率密度函数为：</p>
<p><div class="math-display">f(\theta)=\frac{\Gamma(\alpha+\beta)}{\Gamma(\alpha)\Gamma(\beta)}\theta^{\alpha-1}(1-\theta)^{\beta-1}</div></p>
<p>这个先验分布我们之前很少接触，除了未知参数 <span class="math-inline">\theta</span> 以外，他还有两个参数 <span class="math-inline">\alpha</span> 和 <span class="math-inline">\beta</span> ，用来控制整个 <span class="math-inline">beta</span> 分布的图像，并且分式 <span class="math-inline">\frac{\Gamma(\alpha+\beta)}{\Gamma(\alpha)\Gamma(\beta)}</span> ​中间含有复杂的伽马函数。</p>
<p>其实这个分式大家不用特别关心，他可以被理解为一个正则项，保证整个概率密度函数的积分为1即可。</p>
<p>那么我们为什么要选择 <span class="math-inline">beta</span> 分布作为未知参数 <span class="math-inline">\theta</span> 的先验分布呢？相信大家都有疑问，那么我们通过下面的内容讲解来慢慢揭示，首先我们来看一下 <span class="math-inline">beta</span> 分布的具体形态。</p>
<p>我们刚刚说过， <span class="math-inline">beta</span> 分布概率密度函数中，参数 <span class="math-inline">\alpha</span> 和参数 <span class="math-inline">\beta</span> 是用来控制分布的形状的，具体指的什么，我们让参数 <span class="math-inline">\alpha</span> 和参数 <span class="math-inline">\beta</span> 分别依次从 <span class="math-inline">[0.25, 1, 10]</span> 中取值作为参数，这样就构成了9组参数对，我们来依次画出他们的分布形态。</p>
<p><strong>代码片段</strong>：</p>
<pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt
from scipy.stats import beta
import seaborn
seaborn.set()

params = [0.25, 1, 10]
x = np.linspace(0, 1, 100)
f, ax = plt.subplots(len(params), len(params), sharex=True, sharey=True)

for i in range(len(params)):
    for j in range(len(params)):
        a = params[i]
        b = params[j]
        y = beta(a, b).pdf(x)
        ax[i, j].plot(x, y, color='red')
        ax[i, j].set_title('<span class="math-inline">\\alpha</span>={},<span class="math-inline">\\beta={}</span>'.format(a, b))
        ax[i, j].set_ylim(0, 10)

ax[0, 0].set_xticks([0, 0.2, 0.4, 0.6, 0.8, 1])
ax[0, 0].set_yticks([0, 2.5, 5, 7.5,  10])
ax[1, 0].set_ylabel('<span class="math-inline">p(\\theta)</span>')
ax[2, 1].set_xlabel('<span class="math-inline">\\theta</span>')
plt.show()
</code></pre>
<p><strong>运行结果</strong>：</p>
<div align=center><img src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/20241101201846.png" style="zoom: 60%;" /></div>

<p>参数 <span class="math-inline">\alpha</span> 和 <span class="math-inline">\beta</span> 的不同取值组合，我们能够得到类似于 <span class="math-inline">U</span> 型分布，正态分布，均匀分布，指数分布等等许多不同分布的形状，具有很强的通用性和适应性。</p>
<p>其次一点是共轭性，他能够极大的简化后验分布的计算，这一点我们接下来继续展开。</p>
<p><strong>4.2.关于观测数据的分布</strong></p>
<p>接下来，我们选择观测数据的分布，在抛掷硬币的过程中，确定了某一次抛掷硬币正面向上的概率 <span class="math-inline">\theta</span> 之后，抛掷 <span class="math-inline">n</span> 次硬币，其中 <span class="math-inline">y</span> 次向上的概率是满足二项分布的，这个我们之前也反复讲过：</p>
<p><div class="math-display">p(y|\theta)=\frac{n!}{y!(n-y)!}\theta^y(1-\theta)^{n-y}</div></p>
<p>这里我们就抛掷10次硬币，其中令正面向上的概率分别是0.35,0.5,0.8，来看看观测数据所服从的分布：</p>
<p><strong>代码片段</strong>：</p>
<pre><code class="language-python">from scipy.stats import binom
import matplotlib.pyplot as plt
import numpy as np
import seaborn

seaborn.set()

n = 10
p_params = [0.35, 0.5, 0.8]
x = np.arange(0, n + 1)
f, ax = plt.subplots(len(p_params), 1)

for i in range(len(p_params)):
    p = p_params[i]
    y = binom(n=n, p=p).pmf(x)

    ax[i].vlines(x, 0, y, colors='red', lw=10)
    ax[i].set_ylim(0, 0.5)
    ax[i].plot(0, 0, label='n={}\n<span class="math-inline">\\theta</span>={}'.format(n, p), alpha=0)
    ax[i].legend()
    ax[i].set_xlabel('y')
    ax[i].set_xticks(x)

ax[1].set_ylabel('<span class="math-inline">p(y|\\theta)</span>')
plt.show()
</code></pre>
<p><strong>运行结果</strong>：</p>
<div align=center><img src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/20241102103745.png" style="zoom: 60%;" /></div>

<p><strong>4.3.后验的计算</strong></p>
<p>我们接下来就来计算后验：</p>
<p><div class="math-display">f(\theta|y)\propto f(\theta)p(y|\theta)$4</p>
<p></div>f(\theta)=\frac{\Gamma(\alpha+\beta)}{\Gamma(\alpha)\Gamma(\beta)}\theta^{\alpha-1}(1-\theta)^{\beta-1}<div class="math-display"></p>
<p></div>p(y|\theta)=\frac{n!}{y!(n-y)!}\theta^y(1-\theta)^{n-y}<div class="math-display"></p>
<p>因此： <span class="math-inline">f(\theta|y)\propto \frac{\Gamma(\alpha+\beta)}{\Gamma(\alpha)\Gamma(\beta)}\theta^{\alpha-1}(1-\theta)^{\beta-1}\frac{n!}{y!(n-y)!}\theta^y(1-\theta)^{n-y}</span></p>
<p>而针对选定的先验，参数 <span class="math-inline">\alpha</span> 和 <span class="math-inline">\beta</span> 是已知的，针对一组已知的观测数据，抛掷的次数 <span class="math-inline">n</span> 和正面向上的次数 <span class="math-inline">y</span> 也是已知的，因此 <span class="math-inline"> \frac{\Gamma(\alpha+\beta)}{\Gamma(\alpha)\Gamma(\beta)}</span>​和 <span class="math-inline">\frac{n!}{y!(n-y)!}</span> ​都是与未知参数 <span class="math-inline">\theta</span> 无关的项，他们可以被合并到归一化项当中去，因此我们可以进一步化简：</p>
<p></div>f(\theta|y)\propto \theta^{\alpha-1}(1-\theta)^{\beta-1}\theta^y(1-\theta)^{n-y}=\theta^{\alpha+y-1}(1-\theta)^{\beta+n-y-1}<div class="math-display"></p>
<p>最终实际的后验 <span class="math-inline">f(\theta|y)</span> 就是在 <span class="math-inline">\theta^{\alpha+y-1}(1-\theta)^{\beta+n-y-1}</span> 的基础上加上一个归一化的项，使之在整个 <span class="math-inline">\theta</span> 的取值域上积分为1。</p>
<p>此时你可能会问，后面我们再该怎么处理？我们从后验分布的概率密度函数的正比表达式： <span class="math-inline">\theta^{\alpha+y-1}(1-\theta)^{\beta+n-y-1}</span> 中惊奇的发现，后验分布同样也是一个 <span class="math-inline">beta</span> 分布，只不过这个 <span class="math-inline">beta</span> 分布的参数变了：</p>
<p></div>\alpha_{posterior}=\alpha+y<span class="math-inline"> </span>\beta_{posterior}=\beta+n-y<div class="math-display"></p>
<p>那么我们很容易就能根据先验分布和观测数据得到后验分布了。</p>
<h2 id="5模拟实验验证">5.模拟实验验证<a class="anchor-link" href="#5模拟实验验证" title="Permanent link">&para;</a></h2>
<p>首先我们写一段模拟抛硬币的程序，我们手上的这枚硬币，正面向上的实际概率为0.62，我们模拟随机抛掷1000次硬币的试验，并且记录抛掷过程中，抛掷次数为 <span class="math-inline">[5, 10, 20, 100, 500, 1000]</span> 时，正面出现的次数。这个0.62就是我们需要根据观测数据来估计的未知参数，并且我们可以用它来和估计值进行对比。</p>
<p><strong>代码片段</strong>：</p>
<pre><code class="language-python">import random

def bernoulli_trial(p):
    u = random.uniform(0, 1)
    if u &lt;= p:
        return 1
    else:
        return 0

def coin_experiments(n_array, p):
    y = 0
    n_max = max(n_array)
    results = []
    for n in range(1, n_max+1):
        y = y + bernoulli_trial(p)
        if n in n_array:
            results.append((y, n))

    return results

print(coin_experiments([5, 10, 20, 100, 500, 1000], 0.62))
</code></pre>
<p><strong>运行结果</strong>：</p>
<pre><code class="language-python">[(2, 5), (4, 10), (11, 20), (60, 100), (306, 500), (614, 1000)]
</code></pre>
<p>这个结果中，每一个元组表示的含义为(正面的次数，试验的次数)，记录了完成1000次试验的过程中，抛掷到5次，10次，20次，100次，500次和1000次的时候，相应的正面向上的次数。</p>
<p>例如 <span class="math-inline">(311, 500)</span> 表示当试验进行了500次时，正面出现的次数为311次。</p>
<p>请大家放心的是，这个试验生成的结果完全是按照伯努利试验随机生成的，你可以再重复运行5次该实验，一定会得到完全不同的5组试验结果：</p>
<p><strong>代码片段</strong>：</p>
<pre><code class="language-python">for i in range(5):
    print(coin_experiments([5, 10, 20, 100, 1000, 10000], 0.62))
</code></pre>
<p><strong>运行结果</strong>：</p>
<pre><code class="language-python">[(3, 5), (7, 10), (13, 20), (55, 100), (306, 500), (622, 1000)]
[(4, 5), (6, 10), (12, 20), (68, 100), (319, 500), (632, 1000)]
[(2, 5), (6, 10), (12, 20), (57, 100), (319, 500), (645, 1000)]
[(4, 5), (7, 10), (14, 20), (64, 100), (309, 500), (626, 1000)]
[(4, 5), (8, 10), (15, 20), (56, 100), (309, 500), (607, 1000)]
</code></pre>
<p>最后，我们利用三组 <span class="math-inline">(\alpha,\beta)</span> 分别为 <span class="math-inline">(0.25,0.25),(1,1),(10,10)</span> 的 <span class="math-inline">beta</span> 分布作为先验分布：</p>
<p><strong>代码片段</strong>：</p>
<pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt
from scipy.stats import beta
import seaborn
seaborn.set()

params = [0.25, 1, 10]
x = np.linspace(0, 1, 100)

plt.plot(x, beta(0.25, 0.25).pdf(x), color='b', label='<span class="math-inline">\\alpha=0.25,\\beta=0.25</span>')
plt.fill_between(x, 0, beta(0.25, 0.25).pdf(x), color='b', alpha=0.25)

plt.plot(x, beta(1, 1).pdf(x), color='g',label='<span class="math-inline">\\alpha=1,\\beta=1</span>')
plt.fill_between(x, 0, beta(1, 1).pdf(x), color='g', alpha=0.25)

plt.plot(x, beta(10, 10).pdf(x), color='r',label='<span class="math-inline">\\alpha=10,\\beta=10</span>')
plt.fill_between(x, 0, beta(10, 10).pdf(x), color='r', alpha=0.25)

plt.gca().axes.set_ylim(0,10)
plt.gca().axes.set_xlabel('<span class="math-inline">\\theta</span>')
plt.gca().axes.set_ylabel('<span class="math-inline">p(\\theta)</span>')
plt.legend()
plt.show()
</code></pre>
<p><strong>运行结果</strong>：</p>
<div align=center><img src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/20241102103907.png" style="zoom: 60%;" /></div>

<p>我们选择：</p>
<p><span class="math-inline">[(2, 5), (4, 10), (11, 20), (60, 100), (306, 500), (614, 1000)]</span> 作为观测数据，利用贝叶斯推断的方法，来得到后验分布</p>
<p><strong>代码片段</strong>：</p>
<pre><code class="language-python">from scipy.stats import beta
import matplotlib.pyplot as plt
import numpy as np
import seaborn

seaborn.set()

theta_real = 0.62
n_array = [5, 10, 20, 100, 500, 1000]
y_array = [2, 4, 11, 60, 306, 614]

beta_params = [(0.25, 0.25), (1, 1), (10, 10)]
x = np.linspace(0, 1, 100)

fig, ax = plt.subplots(2, 3, sharex=True, sharey=True)

for i in range(2):
    for j in range(3):
        n = n_array[3 * i + j]
        y = y_array[3 * i + j]
        for (a_prior, b_prior), c in zip(beta_params, ('b', 'r', 'g')):
            a_post = a_prior + y
            b_post = b_prior + n - y
            p_theta_given_y = beta.pdf(x, a_post, b_post)
            ax[i, j].plot(x, p_theta_given_y, c)
            ax[i, j].fill_between(x, 0, p_theta_given_y, color=c, alpha=0.25)

        ax[i, j].axvline(theta_real, ymax=0.5, color='k')
        ax[i, j].set_xticks([0, 0.2, 0.4, 0.6, 0.8, 1])
        ax[i, j].set_title('n={},y={}'.format(n, y))

ax[0, 0].set_ylabel('<span class="math-inline">p(\\theta|y)</span>')
ax[1, 0].set_ylabel('<span class="math-inline">p(\\theta|y)</span>')
ax[1, 1].set_xlabel('<span class="math-inline">\\theta</span>')
plt.show()
</code></pre>
<p><strong>运行结果</strong>：</p>
<div align=center><img src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/20241102103926.png" style="zoom: 60%;" /></div>

<h2 id="6实验结果分析">6.实验结果分析<a class="anchor-link" href="#6实验结果分析" title="Permanent link">&para;</a></h2>
<p>我们来分析一下试验结果，首先我们设置了三种典型的先验分布，均匀分布、 <span class="math-inline">U</span> 型分布和类似正态分布，分别代表了我们对于未知参数 <span class="math-inline">\theta</span> 不同的认识，比如如果我们选择均匀分布，意味着我们认为， <span class="math-inline">\theta</span> 在 <span class="math-inline">[0,1]</span> 范围内的取值是等概率的； <span class="math-inline">U</span> 型分布代表了在靠近0和1的两头， <span class="math-inline">\theta</span> 的取值概率越高，类正态分布表示我们认为越靠近中心0.5的位置，取值概率越高。这三者的认识是截然不同的。</p>
<p>在整个实验的每一个阶段，通过先验分布与观测数据的综合，我们得到了每个阶段的后验结果，我们从图中可以看出，贝叶斯推断得到的是一个后验分布，而不像极大似然估计中得到的是一个具体值。他表示了在给定观测数据的情况下，推断得到的未知参数 <span class="math-inline">\theta</span> 的分布情况。</p>
<p>一般而言我们都会选择后验分布概率密度函数曲线的峰值作为我们最终对于未知参数的估计值。这就是贝叶斯推断中的最大后验概率（ <span class="math-inline">MAP</span> ）准则，即选择在一个给定数据下，具有最大后验概率的值。</p>
<p>从这个结果图中，我们可以看出很多的结论：</p>
<p>首先，随着观测数据的不断增多，后验分布会越来越集中，分布越集中表示对于参数的确定性越高，这很显然，观测数据的增多意味着有更多的数据、更多的信息来更新和支撑我们对于参数的认识。</p>
<p>其次，当观测数据的量足够多的时候，不同的先验分布对应的后验分布都会收敛到一个相同的结果，数据越多，通过最大后验概率准则得到的估计值就会与参数的实际值（黑色竖线）越接近。</p>
<h2 id="7关于共轭先验的问题">7.关于共轭先验的问题<a class="anchor-link" href="#7关于共轭先验的问题" title="Permanent link">&para;</a></h2>
<p>那么这里有一个重要的点要强调，当然也是我们当初没有谈到的，先验选择 <span class="math-inline">beta</span> 分布的第三个好处，那就是：</p>
<p>先验分布是 <span class="math-inline">beta</span> 分布，观测数据服从二项分布，得到的后验仍然是 <span class="math-inline">beta</span> 分布，也就是说 <span class="math-inline">beta</span> 分布是二项分布的共轭先验：即将先验 <span class="math-inline">beta</span> 分布与二项分布组合在一起之后，得到的后验分布与先验分布的表达式形式仍然是一样的。除此之外，正态分布也是自身的共轭先验。</p>
<p>这种分布的共轭特性，极大的简化了我们求解后验分布的计算复杂性。但是，共轭分布的情形并不普遍，因此如果不是在共轭先验的条件下去解决贝叶斯推断问题，那么在计算后验分布的过程中将会遇到非常大的困难，后验分布绝大多数情况下就不再是一个标准分布，甚至没有解析解，在这种情况下想了解后验分布的形态将遇到巨大的挑战，基于他去做后续的统计分析将难上加难。</p>
<hr />
<h1 id="先验分布与后验分布">先验分布与后验分布<a class="anchor-link" href="#先验分布与后验分布" title="Permanent link">&para;</a></h1>
<h2 id="什么是贝叶斯统计">什么是贝叶斯统计？<a class="anchor-link" href="#什么是贝叶斯统计" title="Permanent link">&para;</a></h2>
<p>贝叶斯统计的重要特点在于，我们在建模前需要给出模型参数 <span class="math-inline">\theta</span> 的<strong>先验分布（prior distribution）</strong> <span class="math-inline">p(\theta)</span> 。也就是说，在得到任何数据，或者将任何数据对模型进行拟合之前，我们需要先给定模型参数服从的分布。例如，对于抛掷一枚硬币一次可能出现的结果，我们可以构建一个参数为 <span class="math-inline">\theta</span> 的伯努利分布概率模型 <span class="math-inline">X\sim bernoulli(\theta)</span> 。那么在使用数据估计参数 <span class="math-inline">\theta</span> 之前，我们需要给这个参数设定一个分布（<strong>注意，先验分布是关于模型参数的分布，而不是我们建模的对象本身，下文中将要介绍的后验分布，也是关于模型参数的分布）。</strong>给出参数的先验分布，是贝叶斯统计的核心部分之一，也是对于长期接触频率学派思想的贝叶斯初学者来说最容易困惑的部分<strong>：没有数据的支持，在贝叶斯统计中的先验分布到底如何设定？</strong></p>
<p>实际上，先验分布的存在正是贝叶斯学派相对于频率学派更贴近实际问题的一点。虽然理论上我们在利用现有数据之前，不存在任何数据支持我们对 <span class="math-inline">\theta</span> 做出假设，但在现实中，我们对我们要建模的目标总会存在一些经验判断。由此，我们可以在利用数据来估计 <span class="math-inline">\theta</span> 之前，将我们的实际经验作为有价值的信息加入到模型参数的估计过程当中。</p>
<p>继续上面的例子，反复投掷同一枚硬币，我们通过常识可以知道其正面朝上的概率 <span class="math-inline">\theta</span> 在 0.5 左右浮动。概率的浮动是由这一枚硬币的实际情况导致（密度均匀程度，以及外形是否完美等等）。由于先验分布可以是任意的，我们因此可以依据经验，假设先验分布则</p>
<p><span class="math-inline">p(\theta)=4xI(0\leq x&lt;0.5)+4(1-x)I(0.5\leq x\leq 1). \</span></p>
<p><img alt="" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/202410312116391.jpg" />  </p>
<p>这是我随意举例的一个先验分布。理论上，<strong>我们可以使用任何的分布作为先验分布</strong>。但一个好的先验分布需要囊括我们对参数的经验判断信息，而上文构造的分布则成功包含了关于 <span class="math-inline">\theta</span> 分布应有的部分特征：</p>
<ol>
<li>它当 <span class="math-inline">\theta=0.5</span> 时概率密度最大，符合上文所描述的对硬币的认知。</li>
<li>概率密度函数从 <span class="math-inline">\theta=0.5</span> 处向两端递减，这同样具有现实意义。我们几乎不可能找到正面朝上概率为 <span class="math-inline">0.99</span> 的硬币，甚至无法想象。</li>
</ol>
<p>在得到了模型参数的先验分布之后，我们便可以通过样本数据 <span class="math-inline">x_1,...,x_n</span> 来进一步更新模型参数的分布。这便是贝叶斯学派与频率学派的另一个重要的不同之处<strong>：在贝叶斯统计中，数据被用于更新参数的分布，而非作为参数极大似然估计的组成部分。</strong>事实上，我们已经能够通过研究模型参数的先验分布 <span class="math-inline">p(\theta)</span> ，了解 <span class="math-inline">\theta</span> 的性质。而利用数据更新模型参数的分布，能够使我们更加充分地利用已知信息进行统计推断。更新模型参数分布的过程，本质上是在给定 <span class="math-inline">x_1,...,x_{10}</span> 下得到的关于 <span class="math-inline">\theta</span> 的新的分布，即 <span class="math-inline">p(\theta|x_1,...,x_{10})=p(\theta|X)</span> ，其中 <span class="math-inline">p(\theta|X)</span> 被称作 <span class="math-inline">\theta</span> 的<strong>后验分布（posterior distribution）</strong>。根据贝叶斯定理，我们有<br />
</div><br />
p(\theta|X)=\frac{p(\theta,X)}{p(X)}=\frac{p(X|\theta)p(\theta)}{\int_{-\infty}^{+\infty}p(X|\theta)p(\theta)d\theta}. \<br />
<div class="math-display"><br />
可以看到，通过贝叶斯公式，我们将 <span class="math-inline">\theta</span> 的后验分布 <span class="math-inline">p(\theta|X)</span> 与先验分布 <span class="math-inline">p(\theta)</span> 结合在了一起。而在这个公式中，<span class="math-inline">p(X|\theta)</span> <strong>是在给定</strong> <span class="math-inline">\theta</span> <strong>下关于数据样本的似然函数。</strong>对于初学者而言，这个公式可能仍然比较抽象。我们可以使用如下例子加以理解：若希望计算在给定了数据后 <span class="math-inline">\theta=0.5</span> 的后验<strong>概率密度</strong>，利用上述公式，我们可以得到<br />
</div><br />
p(\theta=0.5|X)=\frac{p(X|\theta=0.5)p(\theta=0.5)}{\int_{-\infty}^{+\infty}p(X|\theta)p(\theta)d\theta}. \<br />
<div class="math-display"><br />
事实上，我们可以发现式子中的 <span class="math-inline">{\int_{-\infty}^{+\infty}p(X|\theta)p(\theta)d\theta}</span> 是某个常数 <span class="math-inline">c</span> ，因此我们可以极大地化简我们后验分布的形式为<br />
</div><br />
p(\theta|X)\propto p(X|\theta)p(\theta). \<br />
<div class="math-display"><br />
我们只要对 <span class="math-inline">p(X|\theta)p(\theta)</span> 稍加放缩，使 <span class="math-inline">p(\theta|X)</span> 曲线下的面积等于1，即可以得到 <span class="math-inline">\theta</span> 的后验分布概率密度函数(probability density function)。</p>
<p>下面是一个特殊的例子，能够帮助读者深化对于贝叶斯思想的印象：</p>
<h2 id="example">Example<a class="anchor-link" href="#example" title="Permanent link">&para;</a></h2>
<p>当我非常肯定，所有的硬币投掷正面朝上概率为0.5时，我可以设先验分布 <span class="math-inline">p(\theta=0.5)=1</span> , 除此之外 <span class="math-inline">p(\theta)=0</span> 。由于 <span class="math-inline">\theta</span> 的后验分布表示如下：<br />
</div><br />
p(\theta|X)\propto p(X|\theta)p(\theta). \<br />
<div class="math-display"><br />
我们可以得出， <span class="math-inline">\theta \ne 0.5</span> 的后验概率在任何 <span class="math-inline">X</span> 下都等于 <span class="math-inline">0</span> ，而 <span class="math-inline">\theta=0.5</span> 的后验概率在任何 <span class="math-inline">X</span> 下都等于 <span class="math-inline">1</span> 。也就是说，当我们 <span class="math-inline">\theta</span> 为 0.5 的概率为100%时，不论真实数据如何，都无法改变 <span class="math-inline">\theta</span> 为0.5的概率为100%这一现状。这个例子的现实意义就在于，当我们对一个参数的值有百分百的自信时，再多数据都无法更新参数的后验分布。这是贝叶斯统计比较有意思的一点。</p>
<h2 id="小结">小结<a class="anchor-link" href="#小结" title="Permanent link">&para;</a></h2>
<p>事实上，本文所举的考察二项分布的参数 <span class="math-inline">\theta</span> 是较为简单的应用情形，贝叶斯学派的这一套思想可以进一步用来研究泊松分布、指数分布、正态分布乃至线性回归模型；除此之外，本文所构造的先验分布也是相对随意的。在实际问题中，我们往往会构造<strong>共轭先验分布（conjugate prior distribution）</strong>，保证我们在不断使用数据更新参数后验分布时，该分布与先验分布属于同一已知分布族当中。我们将在下一篇文章中介绍共轭先验分布，敬请期待。</p>
<h2 id="附录">附录<a class="anchor-link" href="#附录" title="Permanent link">&para;</a></h2>
<ol>
<li>贝叶斯公式</li>
</ol>
<p>我们回忆贝叶斯公式的形式：<br />
</div><br />
p(y_j|x)=\frac{p(x|y_j)p(y_j)}{\sum_{i=0}^{n}{p(x|y_i)p(y_i)}} \<br />
<div class="math-display"><br />
注意上式描述的是 <span class="math-inline">y</span> 为离散的随机变量的情况，当 <span class="math-inline">y </span> 服从连续分布时，公式改写为<br />
</div><br />
p(y_0|x)=\frac{p(x|y_0)p(y_0)}{\int_{-\infty}^{+\infty}p(x|y)p(y)dy} \<br />
$$</p>
<h2 id="references">References<a class="anchor-link" href="#references" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://www.zhihu.com/question/24261751/answer/2355943888">石溪</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/401258319">走进贝叶斯统计（一）—— 先验分布与后验分布</a></li>
</ul>
                </div>

                <!-- Comments Section (Giscus) -->
                <section class="comments-section">
                    <h3><i class="fas fa-comments"></i> 评论</h3>
                    <script src="https://giscus.app/client.js"
                        data-repo="Geeks-Z/Geeks-Z.github.io"
                        data-repo-id=""
                        data-category="Announcements"
                        data-category-id=""
                        data-mapping="pathname"
                        data-strict="0"
                        data-reactions-enabled="1"
                        data-emit-metadata="0"
                        data-input-position="bottom"
                        data-theme="preferred_color_scheme"
                        data-lang="zh-CN"
                        crossorigin="anonymous"
                        async>
                    </script>
                </section>
            </article>

            <footer class="post-footer">
                <p>© 2025 Hongwei Zhao. Built with ❤️</p>
            </footer>
        </main>
    </div>

    <!-- Theme Toggle Button -->
    <button class="theme-toggle" id="themeToggle" aria-label="切换主题">
        <i class="fas fa-moon"></i>
    </button>

    <script>
        // Theme Toggle
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;
        const icon = themeToggle.querySelector('i');
        const hljsDark = document.getElementById('hljs-theme-dark');
        const hljsLight = document.getElementById('hljs-theme-light');
        
        // Check saved theme or system preference
        const savedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        
        if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
            html.setAttribute('data-theme', 'dark');
            icon.className = 'fas fa-sun';
            hljsDark.disabled = false;
            hljsLight.disabled = true;
        }
        
        themeToggle.addEventListener('click', () => {
            const isDark = html.getAttribute('data-theme') === 'dark';
            if (isDark) {
                html.removeAttribute('data-theme');
                icon.className = 'fas fa-moon';
                localStorage.setItem('theme', 'light');
                hljsDark.disabled = true;
                hljsLight.disabled = false;
            } else {
                html.setAttribute('data-theme', 'dark');
                icon.className = 'fas fa-sun';
                localStorage.setItem('theme', 'dark');
                hljsDark.disabled = false;
                hljsLight.disabled = true;
            }
            
            // Update Giscus theme
            const giscusFrame = document.querySelector('iframe.giscus-frame');
            if (giscusFrame) {
                giscusFrame.contentWindow.postMessage({
                    giscus: {
                        setConfig: {
                            theme: isDark ? 'light' : 'dark'
                        }
                    }
                }, 'https://giscus.app');
            }
        });
        
        // Highlight.js
        document.addEventListener('DOMContentLoaded', () => {
            hljs.highlightAll();
        });
        
        // KaTeX auto-render
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof renderMathInElement !== 'undefined') {
                renderMathInElement(document.body, {
                    delimiters: [
                        {left: '$$', right: '$$', display: true},
                        {left: '$', right: '$', display: false},
                        {left: '\\[', right: '\\]', display: true},
                        {left: '\\(', right: '\\)', display: false}
                    ],
                    throwOnError: false
                });
            }
        });
        
        // TOC active state
        const tocLinks = document.querySelectorAll('.toc-container a');
        const headings = document.querySelectorAll('.post-content h2, .post-content h3, .post-content h4');
        
        function updateTocActive() {
            let current = '';
            headings.forEach(heading => {
                const rect = heading.getBoundingClientRect();
                if (rect.top <= 100) {
                    current = heading.getAttribute('id');
                }
            });
            
            tocLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + current) {
                    link.classList.add('active');
                }
            });
        }
        
        window.addEventListener('scroll', updateTocActive);
        updateTocActive();
    </script>
</body>
</html>
