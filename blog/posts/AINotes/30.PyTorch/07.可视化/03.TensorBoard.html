<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>参数如下：</title>
    <meta name="description" content="参数如下： - Hongwei Zhao's Blog">
    <meta name="author" content="Hongwei Zhao">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+SC:wght@300;400;500;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Code Highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" id="hljs-theme-dark">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css" id="hljs-theme-light" disabled>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- KaTeX for Math -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    
    <style>
        :root {
            /* Light Theme - 明亮清新配色 */
            --primary-color: #4A90D9;
            --primary-hover: #3678C2;
            --link-color: #E86B5F;
            --text-color: #2D2D2D;
            --text-light: #5A5A5A;
            --text-muted: #8A8A8A;
            --bg-color: #FFFFFF;
            --bg-secondary: #F5F7FA;
            --bg-code: #F8F9FC;
            --border-color: #E8ECF0;
            --shadow: 0 2px 8px rgba(0,0,0,0.06);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.08);
        }

        [data-theme="dark"] {
            --primary-color: #5dade2;
            --primary-hover: #85c1e9;
            --link-color: #e74c3c;
            --text-color: #e5e7eb;
            --text-light: #9ca3af;
            --text-muted: #6b7280;
            --bg-color: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-code: #0f0f23;
            --border-color: #374151;
            --shadow: 0 1px 3px rgba(0,0,0,0.3);
            --shadow-lg: 0 4px 15px rgba(0,0,0,0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', 'Noto Sans SC', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-size: 16px;
            line-height: 1.8;
            color: var(--text-color);
            background: var(--bg-color);
            transition: background-color 0.3s, color 0.3s;
        }

        a {
            color: var(--primary-color);
            text-decoration: none;
            transition: color 0.2s;
        }

        a:hover {
            color: var(--primary-hover);
            text-decoration: underline;
        }

        /* Layout */
        .page-wrapper {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            gap: 3rem;
        }

        /* Sidebar TOC */
        .toc-sidebar {
            width: 260px;
            flex-shrink: 0;
            position: sticky;
            top: 2rem;
            height: fit-content;
            max-height: calc(100vh - 4rem);
            overflow-y: auto;
        }

        .toc-container {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .toc-container h3 {
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .toc-container ul {
            list-style: none;
        }

        .toc-container li {
            margin-bottom: 0.5rem;
        }

        .toc-container a {
            font-size: 0.9rem;
            color: var(--text-light);
            display: block;
            padding: 0.25rem 0;
            border-left: 2px solid transparent;
            padding-left: 0.75rem;
            transition: all 0.2s;
        }

        .toc-container a:hover,
        .toc-container a.active {
            color: var(--primary-color);
            border-left-color: var(--primary-color);
            text-decoration: none;
        }

        .toc-container ul ul {
            margin-left: 1rem;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            min-width: 0;
            max-width: 800px;
        }

        /* Header */
        .post-header {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 1.5rem;
        }

        .back-link:hover {
            color: var(--primary-color);
            text-decoration: none;
        }

        .post-header h1 {
            font-size: 2.25rem;
            font-weight: 700;
            line-height: 1.3;
            margin-bottom: 1rem;
            color: var(--text-color);
        }

        .post-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .post-meta span {
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .post-meta i {
            color: var(--text-muted);
        }

        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .tag {
            display: inline-block;
            font-size: 0.8rem;
            background: var(--bg-secondary);
            color: var(--text-light);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            transition: all 0.2s;
        }

        .tag:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* Article Content */
        .post-content {
            font-size: 1rem;
            line-height: 1.9;
        }

        .post-content h1,
        .post-content h2,
        .post-content h3,
        .post-content h4,
        .post-content h5,
        .post-content h6 {
            margin-top: 2rem;
            margin-bottom: 1rem;
            font-weight: 600;
            line-height: 1.4;
            color: var(--text-color);
        }

        .post-content h1 { font-size: 1.875rem; }
        .post-content h2 { 
            font-size: 1.5rem; 
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        .post-content h3 { font-size: 1.25rem; }
        .post-content h4 { font-size: 1.125rem; }

        .post-content p {
            margin-bottom: 1.25rem;
        }

        .post-content ul,
        .post-content ol {
            margin: 1.25rem 0;
            padding-left: 1.5rem;
        }

        .post-content li {
            margin-bottom: 0.5rem;
        }

        .post-content blockquote {
            margin: 1.5rem 0;
            padding: 1rem 1.5rem;
            background: var(--bg-secondary);
            border-left: 4px solid var(--primary-color);
            border-radius: 0 8px 8px 0;
            color: var(--text-light);
            font-style: italic;
        }

        .post-content blockquote p:last-child {
            margin-bottom: 0;
        }

        /* Code */
        .post-content code {
            font-family: 'JetBrains Mono', 'Fira Code', Consolas, monospace;
            font-size: 0.9em;
            background: var(--bg-code);
            padding: 0.2em 0.4em;
            border-radius: 4px;
            color: var(--link-color);
        }

        .post-content pre {
            margin: 1.5rem 0;
            padding: 1.25rem;
            background: var(--bg-code);
            border-radius: 10px;
            overflow-x: auto;
            border: 1px solid var(--border-color);
        }

        .post-content pre code {
            background: none;
            padding: 0;
            color: inherit;
            font-size: 0.875rem;
            line-height: 1.6;
        }

        /* Images */
        .post-content img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            margin: 1.5rem 0;
            box-shadow: var(--shadow-lg);
        }

        /* Tables */
        .post-content table {
            width: 100%;
            margin: 1.5rem 0;
            border-collapse: collapse;
            font-size: 0.95rem;
        }

        .post-content th,
        .post-content td {
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            text-align: left;
        }

        .post-content th {
            background: var(--bg-secondary);
            font-weight: 600;
        }

        .post-content tr:nth-child(even) {
            background: var(--bg-secondary);
        }

        /* Math */
        .math-display {
            margin: 1.5rem 0;
            overflow-x: auto;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: 8px;
        }

        /* Anchor links */
        .anchor-link {
            opacity: 0;
            margin-left: 0.5rem;
            color: var(--text-muted);
            font-weight: 400;
            transition: opacity 0.2s;
        }

        .post-content h2:hover .anchor-link,
        .post-content h3:hover .anchor-link,
        .post-content h4:hover .anchor-link {
            opacity: 1;
        }

        /* Theme Toggle */
        .theme-toggle {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            box-shadow: var(--shadow-lg);
            transition: transform 0.2s, background 0.2s;
            z-index: 1000;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
            background: var(--primary-hover);
        }

        /* Comments Section */
        .comments-section {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
        }

        .comments-section h3 {
            font-size: 1.25rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Footer */
        .post-footer {
            margin-top: 3rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
            text-align: center;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .toc-sidebar {
                display: none;
            }
            
            .page-wrapper {
                padding: 1.5rem;
            }
        }

        @media (max-width: 768px) {
            .post-header h1 {
                font-size: 1.75rem;
            }
            
            .post-meta {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .theme-toggle {
                bottom: 1rem;
                right: 1rem;
                width: 44px;
                height: 44px;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }
    </style>
</head>
<body>
    <div class="page-wrapper">
        <!-- TOC Sidebar -->
        <aside class="toc-sidebar">
            <div class="toc-container">
                <h3><i class="fas fa-list"></i> 目录</h3>
                <div class="toc">
<ul>
<li><a href="#tensorboard-安装">TensorBoard 安装</a></li>
<li><a href="#tensorboard-可视化的基本逻辑">TensorBoard 可视化的基本逻辑</a></li>
<li><a href="#tensorboard-的配置与启动">TensorBoard 的配置与启动</a></li>
<li><a href="#tensorboard-模型结构可视化">TensorBoard 模型结构可视化</a></li>
<li><a href="#tensorboard-图像可视化">TensorBoard 图像可视化</a></li>
<li><a href="#tensorboard-连续变量可视化">TensorBoard 连续变量可视化</a><ul>
<li><a href="#writeradd_scalar">writer.add_scalar()</a></li>
<li><a href="#writeradd_scalars">writer.add_scalars()</a></li>
<li><a href="#两者区别">两者区别</a></li>
<li><a href="#两种共同点">两种共同点</a></li>
</ul>
</li>
<li><a href="#tensorboard-参数分布可视化">TensorBoard 参数分布可视化</a><ul>
<li><a href="#histograms">HISTOGRAMS</a></li>
<li><a href="#distributions">DISTRIBUTIONS</a></li>
</ul>
</li>
<li><a href="#服务器端使用-tensorboard">服务器端使用 TensorBoard</a></li>
<li><a href="#总结">总结</a></li>
<li><a href="#参考资料">参考资料</a></li>
</ul>
</div>

            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <article>
                <header class="post-header">
                    <a href="../../../../index.html" class="back-link">
                        <i class="fas fa-arrow-left"></i> 返回博客列表
                    </a>
                    <h1>参数如下：</h1>
                    <div class="post-meta">
                        <span><i class="fas fa-calendar-alt"></i> 2026-02-04</span>
                        <span><i class="fas fa-folder"></i> AINotes/30.PyTorch/07.可视化</span>
                        <span><i class="fas fa-user"></i> Hongwei Zhao</span>
                    </div>
                    <div class="tags">
                        
                    </div>
                </header>

                <div class="post-content">
                    <h2 id="tensorboard-安装">TensorBoard 安装<a class="anchor-link" href="#tensorboard-安装" title="Permanent link">&para;</a></h2>
<p>在已安装 PyTorch 的环境下使用 pip 安装即可：</p>
<pre><code class="language-bash">pip install tensorboardX
</code></pre>
<p>也可以使用 PyTorch 自带的 tensorboard 工具，此时不需要额外安装 tensorboard。</p>
<h2 id="tensorboard-可视化的基本逻辑">TensorBoard 可视化的基本逻辑<a class="anchor-link" href="#tensorboard-可视化的基本逻辑" title="Permanent link">&para;</a></h2>
<p>我们可以将 TensorBoard 看做一个记录员，它可以记录我们指定的数据，包括模型每一层的 feature map，权重，以及训练 loss 等等。TensorBoard 将记录下来的内容保存在一个用户指定的文件夹里，程序不断运行中 TensorBoard 会不断记录。记录下的内容可以通过网页的形式加以可视化。</p>
<div align=center><img src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/20240530153509.png"/ style="zoom:30%"></div>

<h2 id="tensorboard-的配置与启动">TensorBoard 的配置与启动<a class="anchor-link" href="#tensorboard-的配置与启动" title="Permanent link">&para;</a></h2>
<p>在使用 TensorBoard 前，我们需要先指定一个文件夹供 TensorBoard 保存记录下来的数据。然后调用 tensorboard 中的 SummaryWriter 作为上述“记录员”</p>
<pre><code class="language-python">'''SummaryWriter类'''
class SummaryWriter(object):
    def __init__(self, log_dir=None, comment='', purge_step=None, max_queue=10,
                 flush_secs=120, filename_suffix=''):

# 参数如下：
      # log_dir：eventfile输出文件夹地址
      # comment：当不指定log_dir时，该参数为文件夹的后缀
      # filename_suffix：eventfile文件名的后缀
</code></pre>
<pre><code class="language-python">from tensorboardX import SummaryWriter

writer = SummaryWriter('./runs')
</code></pre>
<p>上面的操作实例化 SummaryWritter 为变量 writer，并指定 writer 的输出目录为当前目录下的"runs"目录。也就是说，之后 tensorboard 记录下来的内容都会保存在 runs。</p>
<p>如果使用 PyTorch 自带的 tensorboard，则采用如下方式 import：</p>
<pre><code class="language-python">from torch.utils.tensorboard import SummaryWriter
</code></pre>
<p>启动 tensorboard 也很简单，在命令行中输入</p>
<pre><code class="language-bash">tensorboard --logdir=/path/to/logs/ --port=xxxx
</code></pre>
<p>其中“path/to/logs/"是指定的保存 tensorboard 记录结果的文件路径（等价于上面的“./runs"，port 是外部访问 TensorBoard 的端口号，可以通过访问 ip:port 访问 tensorboard，这一操作和 jupyter notebook 的使用类似。如果不是在服务器远程使用的话则不需要配置 port。</p>
<p>有时，为了 tensorboard 能够不断地在后台运行，也可以使用 nohup 命令或者 tmux 工具来运行 tensorboard。</p>
<h2 id="tensorboard-模型结构可视化">TensorBoard 模型结构可视化<a class="anchor-link" href="#tensorboard-模型结构可视化" title="Permanent link">&para;</a></h2>
<p>首先定义模型：</p>
<pre><code class="language-python">import torch.nn as nn

class Net(nn.Module):
    def __init__(self):
        super(Net, self).__init__()
        self.conv1 = nn.Conv2d(in_channels=3,out_channels=32,kernel_size = 3)
        self.pool = nn.MaxPool2d(kernel_size = 2,stride = 2)
        self.conv2 = nn.Conv2d(in_channels=32,out_channels=64,kernel_size = 5)
        self.adaptive_pool = nn.AdaptiveMaxPool2d((1,1))
        self.flatten = nn.Flatten()
        self.linear1 = nn.Linear(64,32)
        self.relu = nn.ReLU()
        self.linear2 = nn.Linear(32,1)
        self.sigmoid = nn.Sigmoid()

    def forward(self,x):
        x = self.conv1(x)
        x = self.pool(x)
        x = self.conv2(x)
        x = self.pool(x)
        x = self.adaptive_pool(x)
        x = self.flatten(x)
        x = self.linear1(x)
        x = self.relu(x)
        x = self.linear2(x)
        y = self.sigmoid(x)
        return y

model = Net()
print(model)
</code></pre>
<p>输出如下：</p>
<pre><code>Net(
  (conv1): Conv2d(3, 32, kernel_size=(3, 3), stride=(1, 1))
  (pool): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)
  (conv2): Conv2d(32, 64, kernel_size=(5, 5), stride=(1, 1))
  (adaptive_pool): AdaptiveMaxPool2d(output_size=(1, 1))
  (flatten): Flatten(start_dim=1, end_dim=-1)
  (linear1): Linear(in_features=64, out_features=32, bias=True)
  (relu): ReLU()
  (linear2): Linear(in_features=32, out_features=1, bias=True)
  (sigmoid): Sigmoid()
)
</code></pre>
<pre><code class="language-python">writer.add_graph(model, input_to_model = torch.rand(1, 3, 224, 224))
writer.close()
</code></pre>
<p>展示结果如下（其中框内部分初始会显示为“Net"，需要双击后才会展开）：</p>
<p><img alt="tb_model" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/image202404091258453.png" /></p>
<h2 id="tensorboard-图像可视化">TensorBoard 图像可视化<a class="anchor-link" href="#tensorboard-图像可视化" title="Permanent link">&para;</a></h2>
<p>当我们做图像相关的任务时，可以方便地将所处理的图片在 tensorboard 中进行可视化展示。</p>
<ul>
<li>对于单张图片的显示使用 add_image</li>
<li>对于多张图片的显示使用 add_images</li>
<li>有时需要使用 torchvision.utils.make_grid 将多张图片拼成一张图片后，用 writer.add_image 显示</li>
</ul>
<pre><code class="language-python">def make_grid(tensor, nrow=8, padding=2,
              normalize=False, range=None, scale_each=False, pad_value=0):

# 参数：
      # tensor：必须是B*C*H*W形式
      # nrow：指定行数
      # padding：图像与图像之间的间隔多少个像素单位pad_value
      # normalize：是否将像素值标准化到（0~255）
      # range：指定标准化范围，先将像素值规范到该range，然后再进行（0~255）转换
      # scale_each：是否对单张图像进行range
      # pad_value：指定padding的大小（黑色0、白色255等等）

</code></pre>
<pre><code class="language-python">'''当然也可以直接调用add_image或add_images'''
    def add_image(self, tag, img_tensor, global_step=None, walltime=None, dataformats='CHW'):
# 参数：
      # 非常不方便，只能查看一个图像！！！！
      # 当像素值为【0,1】，则乘以255，缩放回【0,255】；若像素值不在【0,1】之间，默认是0~255范围内。
      # tag：图像的标签名
      # img_tensor:注意shape，可以是3HW、HW3、HW、1HW，但不能是四维的，即有batch！！！！！！！（可以通过add_images解决或torchvision.utils.make_grid()）
      # global_step：x轴

    def add_images(self, tag, img_tensor, global_step=None, walltime=None, dataformats='NCHW'):
# 参数：
      # 无法指定行数！！！！！
      # tag：图像的标签名
      # img_tensor:注意shape，可以是NCHW or NHWC，但是，这里Channel在后续处理的时候只能为1或者3！！！！！
      # global_step：x轴
</code></pre>
<p>这里我们使用 torchvision 的 CIFAR10 数据集为例：</p>
<pre><code class="language-python">import torchvision
from torchvision import datasets, transforms
from torch.utils.data import DataLoader

transform_train = transforms.Compose(
    [transforms.ToTensor()])
transform_test = transforms.Compose(
    [transforms.ToTensor()])

train_data = datasets.CIFAR10(&quot;.&quot;, train=True, download=True, transform=transform_train)
test_data = datasets.CIFAR10(&quot;.&quot;, train=False, download=True, transform=transform_test)
train_loader = DataLoader(train_data, batch_size=64, shuffle=True)
test_loader = DataLoader(test_data, batch_size=64)

images, labels = next(iter(train_loader))

# 仅查看一张图片
writer = SummaryWriter('./pytorch_tb')
writer.add_image('images[0]', images[0])
writer.close()

# 将多张图片拼接成一张图片，中间用黑色网格分割
# create grid of images
writer = SummaryWriter('./pytorch_tb')
img_grid = torchvision.utils.make_grid(images)
writer.add_image('image_grid', img_grid)
writer.close()

# 将多张图片直接写入
writer = SummaryWriter('./pytorch_tb')
writer.add_images(&quot;images&quot;,images,global_step = 0)
writer.close()
</code></pre>
<p>依次运行上面三组可视化（注意不要同时在 notebook 的一个单元格内运行），得到的可视化结果如下（最后运行的结果在最上面）：</p>
<p><img alt="tb_images" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/image202404091258454.png" /></p>
<p><img alt="tb_image_gird" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/image202404091258455.png" /></p>
<p><img alt="tb_image" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/image202404091258456.png" /></p>
<p>另外注意上方 menu 部分，刚刚只有“GRAPHS"栏对应模型的可视化，现在则多出了”IMAGES“栏对应图像的可视化。左侧的滑动按钮可以调整图像的亮度和对比度。</p>
<p>此外，除了可视化原始图像，TensorBoard 提供的可视化方案自然也适用于我们在 Python 中用 matplotlib 等工具绘制的其他图像，用于展示分析结果等内容。</p>
<h2 id="tensorboard-连续变量可视化">TensorBoard 连续变量可视化<a class="anchor-link" href="#tensorboard-连续变量可视化" title="Permanent link">&para;</a></h2>
<p>TensorBoard 可以用来可视化连续变量（或时序变量）的变化过程，通过 add_scalar 实现：</p>
<h3 id="writeradd_scalar">writer.add_scalar()<a class="anchor-link" href="#writeradd_scalar" title="Permanent link">&para;</a></h3>
<ul>
<li>功能：将标量添加到 summary</li>
<li>参数：</li>
<li>tag (string)：数据标识符</li>
<li>scalar_value (float or string/blobname)：要保存的数值</li>
<li>global_step (int)：全局步值</li>
<li>walltime (float)：可选参数，用于记录发生的时间，默认为 time.time()</li>
</ul>
<h3 id="writeradd_scalars">writer.add_scalars()<a class="anchor-link" href="#writeradd_scalars" title="Permanent link">&para;</a></h3>
<ul>
<li>功能：添加多个标量数据到 summary 中</li>
<li>参数：</li>
<li>main_tag (string)：tag 的父级名称</li>
<li>tag_scalar_dict (dict)：保存 tag 及相应的值的键值对</li>
<li>global_step (int)：全局步值</li>
<li>walltime (float) 可选参数，可选参数，用于记录发生的时间，默认为 time.time()</li>
</ul>
<h3 id="两者区别">两者区别<a class="anchor-link" href="#两者区别" title="Permanent link">&para;</a></h3>
<ul>
<li>writer.add_scalar() 添加一个标量到 summary</li>
<li>writer.add_scalars() 可以同时添加多个标量到 summary 中，多个标量需要使用键值对的形式输入</li>
</ul>
<h3 id="两种共同点">两种共同点<a class="anchor-link" href="#两种共同点" title="Permanent link">&para;</a></h3>
<ul>
<li>第一个参数可简单理解为保存到 tensorboard 日志文件中的标量图像的名称</li>
<li>第二个参数可简单理解为图像的 y 轴数据</li>
<li>第三个参数可简单理解为图像的 x 轴数据</li>
<li>第四个参数都是可选参数，用于记录发生的时间，默认为 time.time()</li>
</ul>
<pre><code class="language-python">writer = SummaryWriter('./runs')
for _, epoch in enumerate(prog_bar):
    ……
    writer.add_scalars('Loss/Accuracy', {'train_loss': losses / len(train_loader),'train_acc': train_acc}, epoch+1)
    writer.flush()  # 及时刷新，否则无法同时观看到训练和验证
writer.close()
</code></pre>
<div align=center><img src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/20240601104026.png"/></div>

<pre><code class="language-python">writer = SummaryWriter('./pytorch_tb')
for i in range(500):
    x = i
    y = x**2
    writer.add_scalar(&quot;x&quot;, x, i) #日志中记录x在第step i 的值
    writer.add_scalar(&quot;y&quot;, y, i) #日志中记录y在第step i 的值
writer.close()
</code></pre>
<p>可视化结果如下：</p>
<p><img alt="tb_scalar" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/image202404091258457.png" /></p>
<p>如果想在同一张图中显示多个曲线，则需要分别建立存放子路径（使用 SummaryWriter 指定路径即可自动创建，但需要在 tensorboard 运行目录下），同时在 add_scalar 中修改曲线的标签使其一致即可：</p>
<pre><code class="language-python">writer1 = SummaryWriter('./pytorch_tb/x')
writer2 = SummaryWriter('./pytorch_tb/y')
for i in range(500):
    x = i
    y = x*2
    writer1.add_scalar(&quot;same&quot;, x, i) #日志中记录x在第step i 的值
    writer2.add_scalar(&quot;same&quot;, y, i) #日志中记录y在第step i 的值
writer1.close()
writer2.close()
</code></pre>
<p><img alt="tb_scalar_twolines" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/image202404091258458.png" /></p>
<p>这里也可以用一个 writer，但 for 循环中不断创建 SummaryWriter 不是一个好选项。此时左下角的 Runs 部分出现了勾选项，我们可以选择我们想要可视化的曲线。曲线名称对应存放子路径的名称（这里是 x 和 y）。</p>
<p>这部分功能非常适合损失函数的可视化，可以帮助我们更加直观地了解模型的训练情况，从而确定最佳的 checkpoint。左侧的 Smoothing 滑动按钮可以调整曲线的平滑度，当损失函数震荡较大时，将 Smoothing 调大有助于观察 loss 的整体变化趋势。</p>
<h2 id="tensorboard-参数分布可视化">TensorBoard 参数分布可视化<a class="anchor-link" href="#tensorboard-参数分布可视化" title="Permanent link">&para;</a></h2>
<blockquote>
<p>查看权重、梯度，判断是否梯度消失或发散</p>
</blockquote>
<p>当我们需要对参数（或向量）的变化，或者对其分布进行研究时，可以方便地用 TensorBoard 来进行可视化，通过 add_histogram 实现。</p>
<pre><code class="language-python">def add_histogram(self, tag, values, global_step=None, bins='tensorflow', walltime=None, max_bins=None):

</code></pre>
<blockquote>
<p>参数</p>
<ul>
<li>tag：图像的标签名</li>
<li>values：要统计的参数</li>
<li>global_step：y 轴</li>
<li>注意：values 传入的是多维数组（Tensor 或者 array）而不是标量，如果传入的是高维数组，会将其先扁平到一维，再分桶统计成直方图。统计方法与 numpy.histogram 类似。</li>
</ul>
</blockquote>
<pre><code class="language-python">import torch
import numpy as np

# 创建正态分布的张量模拟参数矩阵
def norm(mean, std):
    t = std * torch.randn((100, 20)) + mean
    return t

writer = SummaryWriter('./pytorch_tb/')
for step, mean in enumerate(range(-10, 10, 1)):
    w = norm(mean, 1)
    writer.add_histogram(&quot;w&quot;, w, step)
    writer.flush()
writer.close()
</code></pre>
<p>结果如下：</p>
<p><img alt="tb_hist" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/image202404091258459.png" /></p>
<p>可以看到相比之前多了两个选项卡【HISTOGRAMS】和【DISTRIBUTIONS】，其实这两个都是用来查看 histogram 统计结果的，只不过前者以直方形式显示统计结果， 后者提供更为抽象的统计信息。</p>
<p>在选项卡【HISTOGRAMS】中提供了两种显示模式：OVERLAY 和 OFFSET（左上角），可以看到在不同视角下的直方图分布情况。</p>
<h3 id="histograms">HISTOGRAMS<a class="anchor-link" href="#histograms" title="Permanent link">&para;</a></h3>
<p>在选项卡【HISTOGRAMS】中点开名为 <code>dec_embedding.feature_embedding.Embed.weight</code> 的图像窗口后，如下所示：</p>
<div align=center><img src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/20240612102242.png"/></div>

<p>可以看到这张图是展示了该网络层的梯度分布图像。梯度就是个向量，可以看成数组，在统计时会把所有的梯度扁平成一个一维数组，然后用直方图统计起来。</p>
<p>横轴表示这些梯度中元素值的分布范围，纵轴表示第几轮。</p>
<p>当把鼠标放在图上时，会出现的一条黑线和数字点，如上图这个黑线就表示第 30 轮的时候统计的直方图，这个黑色数字点表示第 30 轮时有 922 个梯度元素值等于 0.0000175。</p>
<p>从上图可以得以下信息：</p>
<ol>
<li>
<p>大约在第 15 轮之后，梯度中元素值的分布就不再改变了，且都集中在 0 附近。</p>
</li>
<li>
<p>结合【SCALARS】中 loss 曲线一直保持不变，说明模型可能遇到了训练瓶颈或者鞍点，或者是网络退化？</p>
</li>
</ol>
<h3 id="distributions">DISTRIBUTIONS<a class="anchor-link" href="#distributions" title="Permanent link">&para;</a></h3>
<p>【DISTRIBUTIONS】的图和【HISTOGRAMS】图显示的数据源都是相同的，只是用不同的方式对相同的内容进行展示而已。<br />
在选项卡【DISTRIBUTIONS】中点开名为<code>dec_embedding.feature_embedding.Embed.weight</code>的图像窗口后，如下图：</p>
<div align=center><img src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/20240612102952.png"/></div>

<p>从上图可以看出以下信息：</p>
<ol>
<li>
<p>总体来看，梯度中元素值在 0 附近颜色普遍最深，也就是说在 0 附近这个区域权重值的取值频次最高。</p>
</li>
<li>
<p>在第 15 轮之后，梯度值出现频次不再改变且总体出现频次范围变大了，说明很有可能梯度的方向一直在来回改变，梯度的元素值不变，我觉得可能是小幅度的梯度震荡。</p>
</li>
<li>
<p>如有错误或者补充，望指出。</p>
</li>
</ol>
<h2 id="服务器端使用-tensorboard">服务器端使用 TensorBoard<a class="anchor-link" href="#服务器端使用-tensorboard" title="Permanent link">&para;</a></h2>
<p>一般情况下，我们会连接远程的服务器来对模型进行训练，但由于服务器端是没有浏览器的（纯命令模式），因此，我们需要进行相应的配置，才可以在本地浏览器，使用 tensorboard 查看服务器运行的训练过程。<br />
本文提供以下几种方式进行，其中前两种方法都是建立 SSH 隧道，实现远程端口到本机端口的转发，最后一种方法适用于没有下载 Xshell 等 SSH 连接工具的用户</p>
<ul>
<li>MobaXterm</li>
</ul>
<ol>
<li>在 MobaXterm 点击 Tunneling</li>
<li>选择 New SSH tunnel，我们会出现以下界面。</li>
</ol>
<p><img alt="ssh_tunnel" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/image202404091258460.png" /> 3. 对新建的 SSH 通道做以下设置，第一栏我们选择<code>Local port forwarding</code>，<code>&lt; Remote Server&gt;</code>我们填写<strong>localhost</strong>，<code>&lt; Remote port&gt;</code>填写 6006，tensorboard 默认会在 6006 端口进行显示，我们也可以根据 <strong>tensorboard --logdir=/path/to/logs/ --port=xxxx</strong>的命令中的 port 进行修改，<code>&lt; SSH server&gt;</code> 填写我们连接服务器的 ip 地址，<code>&lt;SSH login&gt;</code>填写我们连接的服务器的用户名，<code>&lt;SSH port&gt;</code>填写端口号（通常为 22），<code>&lt; forwarded port&gt;</code>填写的是本地的一个端口号，以便我们后面可以对其进行访问。 4. 设定好之后，点击 Save，然后 Start。在启动 tensorboard，这样我们就可以在本地的浏览器输入<code>http://localhost:6006/</code>对其进行访问了</p>
<ul>
<li>Xshell<br />
  1.  Xshell 的连接方法与 MobaXterm 的连接方式本质上是一样的，具体操作如下：<br />
  2.  连接上服务器后，打开当前会话属性，会出现下图，我们选择隧道，点击添加<br />
<img alt="xhell_ui" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/image202404091258461.png" /><br />
  3.  按照下方图进行选择，其中目标主机代表的是服务器，源主机代表的是本地，端口的选择根据实际情况而定。<br />
<img alt="xhell_set" src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/image202404091258462.png" /><br />
  4.  启动 tensorboard，在本地 127.0.0.1:6006 或者 localhost:6006 进行访问。</li>
<li>SSH<br />
  1.  该方法是将服务器的 6006 端口重定向到自己机器上来，我们可以在本地的终端里输入以下代码：其中 16006 代表映射到本地的端口，6006 代表的是服务器上的端口。<br />
<code>shell
      ssh -L 16006:127.0.0.1:6006 username@remote_server_ip</code><br />
  2.  在服务上使用默认的 6006 端口正常启动 tensorboard<br />
<code>shell
  tensorboard --logdir=xxx --port=6006</code><br />
  3.  在本地的浏览器输入地址<br />
<code>shell
  127.0.0.1:16006 或者 localhost:16006</code></li>
</ul>
<h2 id="总结">总结<a class="anchor-link" href="#总结" title="Permanent link">&para;</a></h2>
<p>对于 TensorBoard 来说，它的功能是很强大的，可以记录的东西不只限于本节所介绍的范围。</p>
<p>主要的实现方案是构建一个 SummaryWriter，然后通过<code>add_XXX()</code>函数来实现。</p>
<p>其实 TensorBoard 的逻辑还是很简单的，它的<strong>基本逻辑就是文件的读写逻辑</strong>，写入想要可视化的数据，然后 TensorBoard 自己会读出来。</p>
<h2 id="参考资料">参考资料<a class="anchor-link" href="#参考资料" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="https://blog.csdn.net/Python_Ai_Road/article/details/107704530">TensorBoard 可视化</a></li>
<li><a href="https://www.cnblogs.com/zpc1001/p/13322902.html#histogram%E7%9B%B4%E6%96%B9%E5%9B%BE%E6%9F%A5%E7%9C%8B%E6%9D%83%E9%87%8D%E6%A2%AF%E5%BA%A6%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E6%A2%AF%E5%BA%A6%E6%B6%88%E5%A4%B1%E6%88%96%E5%8F%91%E6%95%A3">Pytorch 框架学习---（5）调整学习率、可视化操作</a></li>
<li><a href="https://blog.csdn.net/sdnuwjw/article/details/107305358">PyTorch 使用 TensorBoard 中的 writer.add_scalar 与 writer.add_scalars 的区别</a></li>
<li><a href="https://blog.csdn.net/qq_38237214/article/details/121118459">【Pytorch】Tensorboard 用法：标量曲线图、直方图、模型结构图</a></li>
</ol>
                </div>

                <!-- Comments Section (Giscus) -->
                <section class="comments-section">
                    <h3><i class="fas fa-comments"></i> 评论</h3>
                    <script src="https://giscus.app/client.js"
                        data-repo="Geeks-Z/Geeks-Z.github.io"
                        data-repo-id=""
                        data-category="Announcements"
                        data-category-id=""
                        data-mapping="pathname"
                        data-strict="0"
                        data-reactions-enabled="1"
                        data-emit-metadata="0"
                        data-input-position="bottom"
                        data-theme="preferred_color_scheme"
                        data-lang="zh-CN"
                        crossorigin="anonymous"
                        async>
                    </script>
                </section>
            </article>

            <footer class="post-footer">
                <p>© 2025 Hongwei Zhao. Built with ❤️</p>
            </footer>
        </main>
    </div>

    <!-- Theme Toggle Button -->
    <button class="theme-toggle" id="themeToggle" aria-label="切换主题">
        <i class="fas fa-moon"></i>
    </button>

    <script>
        // Theme Toggle
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;
        const icon = themeToggle.querySelector('i');
        const hljsDark = document.getElementById('hljs-theme-dark');
        const hljsLight = document.getElementById('hljs-theme-light');
        
        // Check saved theme or system preference
        const savedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        
        if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
            html.setAttribute('data-theme', 'dark');
            icon.className = 'fas fa-sun';
            hljsDark.disabled = false;
            hljsLight.disabled = true;
        }
        
        themeToggle.addEventListener('click', () => {
            const isDark = html.getAttribute('data-theme') === 'dark';
            if (isDark) {
                html.removeAttribute('data-theme');
                icon.className = 'fas fa-moon';
                localStorage.setItem('theme', 'light');
                hljsDark.disabled = true;
                hljsLight.disabled = false;
            } else {
                html.setAttribute('data-theme', 'dark');
                icon.className = 'fas fa-sun';
                localStorage.setItem('theme', 'dark');
                hljsDark.disabled = false;
                hljsLight.disabled = true;
            }
            
            // Update Giscus theme
            const giscusFrame = document.querySelector('iframe.giscus-frame');
            if (giscusFrame) {
                giscusFrame.contentWindow.postMessage({
                    giscus: {
                        setConfig: {
                            theme: isDark ? 'light' : 'dark'
                        }
                    }
                }, 'https://giscus.app');
            }
        });
        
        // Highlight.js
        document.addEventListener('DOMContentLoaded', () => {
            hljs.highlightAll();
        });
        
        // KaTeX auto-render
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof renderMathInElement !== 'undefined') {
                renderMathInElement(document.body, {
                    delimiters: [
                        {left: '$$', right: '$$', display: true},
                        {left: '$', right: '$', display: false},
                        {left: '\\[', right: '\\]', display: true},
                        {left: '\\(', right: '\\)', display: false}
                    ],
                    throwOnError: false
                });
            }
        });
        
        // TOC active state
        const tocLinks = document.querySelectorAll('.toc-container a');
        const headings = document.querySelectorAll('.post-content h2, .post-content h3, .post-content h4');
        
        function updateTocActive() {
            let current = '';
            headings.forEach(heading => {
                const rect = heading.getBoundingClientRect();
                if (rect.top <= 100) {
                    current = heading.getAttribute('id');
                }
            });
            
            tocLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + current) {
                    link.classList.add('active');
                }
            });
        }
        
        window.addEventListener('scroll', updateTocActive);
        updateTocActive();
    </script>
</body>
</html>
