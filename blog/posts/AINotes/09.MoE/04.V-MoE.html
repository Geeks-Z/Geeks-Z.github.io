<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Untitled</title>
    <meta name="description" content="Untitled - Hongwei Zhao's Blog">
    <meta name="author" content="Hongwei Zhao">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+SC:wght@300;400;500;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Code Highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" id="hljs-theme-dark">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css" id="hljs-theme-light" disabled>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- KaTeX for Math -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    
    <style>
        :root {
            /* Light Theme - æ˜äº®æ¸…æ–°é…è‰² */
            --primary-color: #4A90D9;
            --primary-hover: #3678C2;
            --link-color: #E86B5F;
            --text-color: #2D2D2D;
            --text-light: #5A5A5A;
            --text-muted: #8A8A8A;
            --bg-color: #FFFFFF;
            --bg-secondary: #F5F7FA;
            --bg-code: #F8F9FC;
            --border-color: #E8ECF0;
            --shadow: 0 2px 8px rgba(0,0,0,0.06);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.08);
        }

        [data-theme="dark"] {
            --primary-color: #5dade2;
            --primary-hover: #85c1e9;
            --link-color: #e74c3c;
            --text-color: #e5e7eb;
            --text-light: #9ca3af;
            --text-muted: #6b7280;
            --bg-color: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-code: #0f0f23;
            --border-color: #374151;
            --shadow: 0 1px 3px rgba(0,0,0,0.3);
            --shadow-lg: 0 4px 15px rgba(0,0,0,0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', 'Noto Sans SC', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-size: 16px;
            line-height: 1.8;
            color: var(--text-color);
            background: var(--bg-color);
            transition: background-color 0.3s, color 0.3s;
        }

        a {
            color: var(--primary-color);
            text-decoration: none;
            transition: color 0.2s;
        }

        a:hover {
            color: var(--primary-hover);
            text-decoration: underline;
        }

        /* Layout */
        .page-wrapper {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            gap: 3rem;
        }

        /* Sidebar TOC */
        .toc-sidebar {
            width: 260px;
            flex-shrink: 0;
            position: sticky;
            top: 2rem;
            height: fit-content;
            max-height: calc(100vh - 4rem);
            overflow-y: auto;
        }

        .toc-container {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .toc-container h3 {
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .toc-container ul {
            list-style: none;
        }

        .toc-container li {
            margin-bottom: 0.5rem;
        }

        .toc-container a {
            font-size: 0.9rem;
            color: var(--text-light);
            display: block;
            padding: 0.25rem 0;
            border-left: 2px solid transparent;
            padding-left: 0.75rem;
            transition: all 0.2s;
        }

        .toc-container a:hover,
        .toc-container a.active {
            color: var(--primary-color);
            border-left-color: var(--primary-color);
            text-decoration: none;
        }

        .toc-container ul ul {
            margin-left: 1rem;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            min-width: 0;
            max-width: 800px;
        }

        /* Header */
        .post-header {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 1.5rem;
        }

        .back-link:hover {
            color: var(--primary-color);
            text-decoration: none;
        }

        .post-header h1 {
            font-size: 2.25rem;
            font-weight: 700;
            line-height: 1.3;
            margin-bottom: 1rem;
            color: var(--text-color);
        }

        .post-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .post-meta span {
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .post-meta i {
            color: var(--text-muted);
        }

        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .tag {
            display: inline-block;
            font-size: 0.8rem;
            background: var(--bg-secondary);
            color: var(--text-light);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            transition: all 0.2s;
        }

        .tag:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* Article Content */
        .post-content {
            font-size: 1rem;
            line-height: 1.9;
        }

        .post-content h1,
        .post-content h2,
        .post-content h3,
        .post-content h4,
        .post-content h5,
        .post-content h6 {
            margin-top: 2rem;
            margin-bottom: 1rem;
            font-weight: 600;
            line-height: 1.4;
            color: var(--text-color);
        }

        .post-content h1 { font-size: 1.875rem; }
        .post-content h2 { 
            font-size: 1.5rem; 
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        .post-content h3 { font-size: 1.25rem; }
        .post-content h4 { font-size: 1.125rem; }

        .post-content p {
            margin-bottom: 1.25rem;
        }

        .post-content ul,
        .post-content ol {
            margin: 1.25rem 0;
            padding-left: 1.5rem;
        }

        .post-content li {
            margin-bottom: 0.5rem;
        }

        .post-content blockquote {
            margin: 1.5rem 0;
            padding: 1rem 1.5rem;
            background: var(--bg-secondary);
            border-left: 4px solid var(--primary-color);
            border-radius: 0 8px 8px 0;
            color: var(--text-light);
            font-style: italic;
        }

        .post-content blockquote p:last-child {
            margin-bottom: 0;
        }

        /* Code */
        .post-content code {
            font-family: 'JetBrains Mono', 'Fira Code', Consolas, monospace;
            font-size: 0.9em;
            background: var(--bg-code);
            padding: 0.2em 0.4em;
            border-radius: 4px;
            color: var(--link-color);
        }

        .post-content pre {
            margin: 1.5rem 0;
            padding: 1.25rem;
            background: var(--bg-code);
            border-radius: 10px;
            overflow-x: auto;
            border: 1px solid var(--border-color);
        }

        .post-content pre code {
            background: none;
            padding: 0;
            color: inherit;
            font-size: 0.875rem;
            line-height: 1.6;
        }

        /* Images */
        .post-content img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            margin: 1.5rem 0;
            box-shadow: var(--shadow-lg);
        }

        /* Tables */
        .post-content table {
            width: 100%;
            margin: 1.5rem 0;
            border-collapse: collapse;
            font-size: 0.95rem;
        }

        .post-content th,
        .post-content td {
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            text-align: left;
        }

        .post-content th {
            background: var(--bg-secondary);
            font-weight: 600;
        }

        .post-content tr:nth-child(even) {
            background: var(--bg-secondary);
        }

        /* Math */
        .math-display {
            margin: 1.5rem 0;
            overflow-x: auto;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: 8px;
        }

        /* Anchor links */
        .anchor-link {
            opacity: 0;
            margin-left: 0.5rem;
            color: var(--text-muted);
            font-weight: 400;
            transition: opacity 0.2s;
        }

        .post-content h2:hover .anchor-link,
        .post-content h3:hover .anchor-link,
        .post-content h4:hover .anchor-link {
            opacity: 1;
        }

        /* Theme Toggle */
        .theme-toggle {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            box-shadow: var(--shadow-lg);
            transition: transform 0.2s, background 0.2s;
            z-index: 1000;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
            background: var(--primary-hover);
        }

        /* Comments Section */
        .comments-section {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
        }

        .comments-section h3 {
            font-size: 1.25rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Footer */
        .post-footer {
            margin-top: 3rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
            text-align: center;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .toc-sidebar {
                display: none;
            }
            
            .page-wrapper {
                padding: 1.5rem;
            }
        }

        @media (max-width: 768px) {
            .post-header h1 {
                font-size: 1.75rem;
            }
            
            .post-meta {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .theme-toggle {
                bottom: 1rem;
                right: 1rem;
                width: 44px;
                height: 44px;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }
    </style>
</head>
<body>
    <div class="page-wrapper">
        <!-- TOC Sidebar -->
        <aside class="toc-sidebar">
            <div class="toc-container">
                <h3><i class="fas fa-list"></i> ç›®å½•</h3>
                <div class="toc">
<ul>
<li><a href="#scaling-vision-with-sparse-mixture-of-experts">Scaling Vision with Sparse Mixture of Experts</a></li>
<li><a href="#æ‘˜è¦">æ‘˜è¦</a></li>
<li><a href="#èƒŒæ™¯">èƒŒæ™¯</a></li>
<li><a href="#v-moe-çš„è´¡çŒ®">V-MoE çš„è´¡çŒ®</a></li>
<li><a href="#v-moe-çš„è®¡ç®—æ–¹æ³•">V-MoE çš„è®¡ç®—æ–¹æ³•</a></li>
<li><a href="#ä¸“å®¶çš„ç¼“å†²åŒºå®¹é‡">ä¸“å®¶çš„ç¼“å†²åŒºå®¹é‡</a></li>
<li><a href="#æ¨¡å‹ç»†èŠ‚">æ¨¡å‹ç»†èŠ‚</a></li>
<li><a href="#è·¯ç”±ç®—æ³•">è·¯ç”±ç®—æ³•</a></li>
<li><a href="#loss-function">Loss function</a><ul>
<li><a href="#importance-loss">Importance Loss</a></li>
<li><a href="#load-loss">Load Loss</a></li>
<li><a href="#final-auxiliary-loss">Final Auxiliary Loss</a></li>
</ul>
</li>
<li><a href="#v-moe-è®­ç»ƒæ•°æ®">V-MoE è®­ç»ƒæ•°æ®</a></li>
<li><a href="#å®éªŒç»“æœ">å®éªŒç»“æœ</a></li>
<li><a href="#æ”¾å¤§-v-moe">æ”¾å¤§ V-MoE</a></li>
<li><a href="#reference">Reference</a></li>
</ul>
</div>

            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <article>
                <header class="post-header">
                    <a href="../../../index.html" class="back-link">
                        <i class="fas fa-arrow-left"></i> è¿”å›åšå®¢åˆ—è¡¨
                    </a>
                    <h1>Untitled</h1>
                    <div class="post-meta">
                        <span><i class="fas fa-calendar-alt"></i> 2026-02-04</span>
                        <span><i class="fas fa-folder"></i> AINotes/09.MoE</span>
                        <span><i class="fas fa-user"></i> Hongwei Zhao</span>
                    </div>
                    <div class="tags">
                        
                    </div>
                </header>

                <div class="post-content">
                    <h2 id="scaling-vision-with-sparse-mixture-of-experts"><a href="https://arxiv.org/pdf/2106.05974.pdf">Scaling Vision with Sparse Mixture of Experts</a><a class="anchor-link" href="#scaling-vision-with-sparse-mixture-of-experts" title="Permanent link">&para;</a></h2>
<blockquote>
<p><a href="https://github.com/google-research/vmoe">Code</a> | NeurIPS 2021</p>
</blockquote>
<h2 id="æ‘˜è¦">æ‘˜è¦<a class="anchor-link" href="#æ‘˜è¦" title="Permanent link">&para;</a></h2>
<p>ç¨€ç–é—¨æ§æ··åˆä¸“å®¶ç½‘ç»œ (MoESparsely-gated Mixture of Experts networksï¼ŒMoE)) è¿™ç§æ–¹æ³•å·²ç»åœ¨è‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸä¸­è¡¨ç°å‡ºäº†å‡ºè‰²çš„å¯æ‰©å±•æ€§ã€‚ä½†æ˜¯åœ¨è®¡ç®—æœºè§†è§‰ä¸­ï¼Œå‡ ä¹æ‰€æœ‰æ€§èƒ½ç½‘ç»œéƒ½æ˜¯ "å¯†é›† (Dense) çš„"ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªè¾“å…¥éƒ½ç”±æ‰€æœ‰çš„å‚æ•°æ¥å¤„ç†ã€‚</p>
<p>æœ¬æ–‡å°±æå‡ºäº†è§†è§‰é¢†åŸŸç»å…¸çš„ç¨€ç–é—¨æ§æ··åˆä¸“å®¶ç½‘ç»œ Vision MoE (V-MoE)ï¼Œå®ƒæ˜¯ Vision Transformer çš„ç¨€ç–ç‰ˆæœ¬ï¼ŒV-MoE æ˜¯ä¸€ç§å¯æ‰©å±•çš„æ¶æ„ï¼Œå…¶æ€§èƒ½å’Œæœ€å¤§çš„å¯†é›†ç½‘ç»œé€‚é…ã€‚åœ¨å›¾åƒè¯†åˆ«ä»»åŠ¡ä¸­ï¼ŒV-MoE ä¸ SOTA çš„ç½‘ç»œçš„æ€§èƒ½ç›¸åŒ¹é…ï¼ŒåŒæ—¶åœ¨æ¨ç†æ—¶åªéœ€è¦ä¸åˆ°ä¸€åŠçš„ FLOPsã€‚ä½œè€…è¿˜å¯¹è·¯ç”±ç®—æ³•è¿›è¡Œäº†æ‰©å±•ï¼Œå¯¹æ•´ä¸ªæ‰¹æ¬¡ä¸­æ¯ä¸ªè¾“å…¥çš„å­é›†è¿›è¡Œä¼˜å…ˆçº§æ’åºï¼Œä»è€Œå¯¹æ¯å¹…å›¾åƒå®ç°è‡ªé€‚åº”çš„è®¡ç®—ï¼Œä½¿å¾—æµ‹è¯•æ—¶çš„è®¡ç®—æ›´åŠ å¹³æ»‘ã€‚</p>
<h2 id="èƒŒæ™¯">èƒŒæ™¯<a class="anchor-link" href="#èƒŒæ™¯" title="Permanent link">&para;</a></h2>
<blockquote>
<p>æé«˜æ¨¡å‹å®¹é‡çš„æ–°æ–¹æ³•ï¼šç¨€ç–é—¨æ§æ··åˆä¸“å®¶æ¨¡å‹</p>
</blockquote>
<p>åœ¨æ·±åº¦å­¦ä¹ çš„å®è·µç»éªŒä¸­ï¼Œå¢åŠ ç½‘ç»œå®¹é‡å’Œæ•°æ®é›†å¤§å°é€šå¸¸ä¼šæé«˜æ¨¡å‹çš„æ€§èƒ½ï¼Œè¿™ç§æ–¹æ³•åœ¨ NLP é¢†åŸŸå·²ç»å–å¾—äº†æˆåŠŸï¼Œæ¯”å¦‚å„ç§å„æ ·çš„ Transformerã€‚</p>
<p>ä½†æ˜¯ï¼Œè®­ç»ƒä»¥åŠéƒ¨ç½²è¿™æ ·çš„æ¨¡å‹éœ€è¦å¾ˆå¤§çš„ä»£ä»·ï¼Œååˆ†æ˜‚è´µã€‚ä¸€æ–¹é¢çš„åŸå› æ˜¯è¿™äº›æ·±åº¦ç¥ç»ç½‘ç»œé€šå¸¸æ˜¯ "å¯†é›† (Dense)" çš„ï¼Œè¿™ä¸ªå«ä¹‰æ˜¯ï¼šå¯¹äºä»»ä½•å•ä¸ªè¾“å…¥ï¼Œéƒ½éœ€è¦æ¨¡å‹çš„å…¨éƒ¨å‚æ•°æ¥å¤„ç†ã€‚å› æ­¤ï¼Œæ‰©å¤§æ¨¡å‹çš„è§„æ¨¡å¾€å¾€æ„å‘³ç€é«˜æ˜‚çš„è®¡ç®—ä»£ä»·ã€‚</p>
<p>é‚£ä¹ˆï¼Œèƒ½ä¸èƒ½æœ‰ä¸€ç§æ–¹æ³•ï¼Œå¯ä»¥åœ¨æé«˜æ¨¡å‹å°ºå¯¸çš„åŒæ—¶ï¼Œä¿æŒå…¶è®­ç»ƒå’Œæ¨ç†çš„æˆæœ¬å¤§è‡´æ’å®šï¼Ÿ</p>
<p>ç¨€ç–é—¨æ§æ··åˆä¸“å®¶ç½‘ç»œ (Sparsely-gated Mixture of Experts networks) è¿™ç§æ–¹æ³•å°±æ˜¯ä¸ºäº†å®ç°è¿™ä¸ªç›®çš„ï¼Œå…¶å·²ç»åœ¨è‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸä¸­è¡¨ç°å‡ºäº†å‡ºè‰²çš„å¯æ‰©å±•æ€§ï¼Œèƒ½å¤Ÿåœ¨è§£é”ä¸‡äº¿å‚æ•°çš„æ¨¡å‹æ—¶ä»¥æ›´å°‘çš„èµ„æºå®ç°è®­ç»ƒå’Œæ¨ç†ã€‚</p>
<p>æœ¬æ–‡æŠŠè¿™ç§æ–¹æ³•åº”ç”¨åˆ°äº† CV é¢†åŸŸä¸­ï¼Œå¼•å…¥çš„æ¨¡å‹ç§°ä¹‹ä¸º V-MoEï¼Œæ˜¯ä¸€ç§ Vision Transformer (ViT) æ¶æ„çš„ç¨€ç–å˜ä½“ã€‚V-MoE ç”¨ç¨€ç–çš„ MoE å±‚å–ä»£äº† ViT ä¸­å¯†é›†çš„ MLP (åˆç§° Expert)ã€‚æ¯ä¸ªè¾“å…¥å›¾ç‰‡è¢« "è·¯ç”±" åˆ°ä¸åŒ Expert çš„å­é›†ä¸­ã€‚ä½†æ˜¯ï¼ŒMoE è¿™ç§æŠ€æœ¯è·¯çº¿æœ‰å…¶ç‹¬ç‰¹çš„åŠ£åŠ¿ï¼šå³ä¸å¯å¾®æ€§ (non-differentiability)ï¼Œä½¿å¾—è®­ç»ƒè¿™æ ·çš„æ¨¡å‹æœ¬èº«å°±å…·æœ‰æŒ‘æˆ˜æ€§ã€‚</p>
<p>ä½œè€…åœ¨æœ¬æ–‡æ¢ç´¢äº†å¤šç§è®¾è®¡çš„èŒƒå¼å’Œæ€è·¯ï¼Œå¹¶ä¸º V-MoE çš„é¢„è®­ç»ƒå’Œå¾®è°ƒæå‡ºäº†ä¸€ç§è¡Œä¹‹æœ‰æ•ˆçš„ç­–ç•¥ï¼Œæ˜æ˜¾ä¼˜äºå…¶ä»– Dense çš„æ¨¡å‹ã€‚è€Œä¸”ï¼ŒV-MoE æ¨¡å‹è¿˜å¾ˆçµæ´»ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªç”±è°ƒèŠ‚å·²ç»è®­ç»ƒå¥½çš„æ¨¡å‹çš„ç¨€ç–åº¦æ¥è‡ªç”±æ”¹å˜å…¶æ€§èƒ½å’Œæ¨ç†æˆæœ¬çš„ trade-offã€‚ä½¿ç”¨äº† V-MoE æŠ€æœ¯ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸€ä¸ª ViT è§†è§‰æ¨¡å‹æ‰©å±•åˆ° 15B å‚æ•°å¤§å°ï¼Œè¿™æ˜¯è¿„ä»Šä¸ºæ­¢æœ€å¤§çš„è§†è§‰æ¨¡å‹ï¼Œå…¶æ€§èƒ½ä¹Ÿå’Œ SOTA çš„ Dense æ¨¡å‹ç›¸å½“ï¼ŒåŒæ—¶éœ€è¦æ›´å°‘çš„æ—¶é—´è¿›è¡Œè®­ç»ƒã€‚</p>
<h2 id="v-moe-çš„è´¡çŒ®">V-MoE çš„è´¡çŒ®<a class="anchor-link" href="#v-moe-çš„è´¡çŒ®" title="Permanent link">&para;</a></h2>
<p>V-MoE çš„è´¡çŒ®å¯ä»¥æ¦‚æ‹¬ä¸ºï¼š</p>
<ol>
<li>
<p><strong>è¶…å¤§è§„æ¨¡çš„è§†è§‰æ¨¡å‹ï¼ˆVision models at scaleï¼‰</strong>ï¼š<br />
   ç¨€ç–é—¨æ§æ··åˆä¸“å®¶ç½‘ç»œæ˜¯ä¸€ç§ç”¨äºè§†è§‰çš„åˆ†å¸ƒå¼ç¨€ç–æ¿€æ´» Transformer æ¨¡å‹ï¼ŒåŒ…å« 24 ä¸ª MoE å±‚ï¼Œæ¯å±‚åŒ…å« 32 ä¸ª Expertï¼Œæ€»å‚æ•°é‡ 15Bã€‚è¿™ä¸ªæ¨¡å‹å¯ä»¥ç¨³å®šåœ°è®­ç»ƒï¼Œæ— ç¼å¾®è°ƒ;</p>
</li>
<li>
<p><strong>æ€§èƒ½å’Œæ¨ç†å¼€é”€ï¼ˆPerformance and inferenceï¼‰</strong>ï¼š<br />
   V-MoE åœ¨ä¸Šæ¸¸ã€few-shot å’Œå®Œæ•´å¾®è°ƒæŒ‡æ ‡æ–¹é¢å¤§å¤§ä¼˜äº Dense çš„ç«äº‰è€…ã€‚æ­¤å¤–ï¼Œåœ¨æ¨ç†æ—¶ï¼ŒV-MoE æ¨¡å‹å¯ä»¥è°ƒæ•´ä¸ºï¼š1) è®¡ç®—é‡æˆ–å®é™…è¿è¡Œæ—¶é—´ä¸€åŠçš„æƒ…å†µä¸‹åŒ¹é…æœ€å¤§çš„ Dense æ¨¡å‹æ€§èƒ½ï¼Œæˆ–è€… 2) æˆæœ¬ç›¸å½“çš„æƒ…å†µä¸‹æ˜¾è‘—ä¼˜äºæœ€å¤§çš„ Dense æ¨¡å‹;</p>
</li>
<li>
<p><strong>åŸºäºä¼˜å…ˆçº§çš„ Batch è·¯ç”±ç®—æ³• (Batch Prioritized Routing)</strong>ï¼š<br />
   V-MoE æå‡ºä¸€ç§æ–°çš„åŸºäºä¼˜å…ˆçº§çš„è·¯ç”±ç®—æ³•ï¼Œè®© V-MoE ä¸¢å¼ƒæ‰æœ€æ²¡ç”¨çš„ Patchï¼Œä»è€Œå¯¹æ¯ä¸ªå›¾åƒæŠ•å…¥è¾ƒå°‘çš„è®¡ç®—ã€‚æ•ˆæœæ˜¯ V-MoE å¯ä»¥èŠ‚çº¦æ‰ 20% çš„è®¡ç®—å¼€é”€ï¼ŒåŒæ—¶åŒ¹é…æœ€å¤§çš„ Dense æ¨¡å‹æ€§èƒ½ã€‚</p>
</li>
</ol>
<h2 id="v-moe-çš„è®¡ç®—æ–¹æ³•">V-MoE çš„è®¡ç®—æ–¹æ³•<a class="anchor-link" href="#v-moe-çš„è®¡ç®—æ–¹æ³•" title="Permanent link">&para;</a></h2>
<p>ä¸€å¥è¯æ¦‚æ‹¬ï¼šä¸åŒçš„ Expert æ¨¡å‹è´Ÿè´£ä¸åŒçš„è¾“å…¥çš„éƒ¨åˆ†ã€‚</p>
<p>V-MoE çš„æ¶æ„å¦‚ä¸‹å›¾ 1 æ‰€ç¤ºã€‚V-MoE æŠŠ ViT çš„ä¸€éƒ¨åˆ† Block é‡Œé¢çš„ MLP æ¢æˆäº† Sparse MoEã€‚MLP çš„è¡¨è¾¾å¼ä¸ºï¼š</p>
<p><div class="math-display">MLP(x) = W_2 \sigma_{gelu}(W_1x)</div></p>
<p>æ¯ä¸ª Expert çš„å‡½æ•°æ˜¯ï¼š<span class="math-inline">e_i(x)=MLP_{\theta_i}(x) \in \mathbb{R}^ğ· \rightarrow \mathbb{R}^ğ·</span>ï¼Œå®ƒä»¬éƒ½æœ‰ç›¸åŒçš„æ¶æ„ï¼Œä½†æ˜¯æƒé‡éƒ½ä¸åŒ <span class="math-inline">\theta_i=(W_1^i,W_2^i)</span> ã€‚</p>
<div align=center><img src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/20240625225502.png" style="zoom: 60%;" /></div>

<blockquote>
<p>å›¾ 1ï¼šV-MoE çš„æ¶æ„ï¼šV-MoE ç”± L ä¸ª ViT Block ç»„æˆã€‚æ¯ä¸ª MLP (Expert) éƒ½å­˜å‚¨åœ¨ä¸€ä¸ªå•ç‹¬çš„è®¾å¤‡ä¸Šï¼Œå¹¶å¤„ç†å›ºå®šæ•°é‡çš„ä»¤ç‰Œ</p>
</blockquote>
<p>MoE çš„è·¯ç”±å‡½æ•° <span class="math-inline">g:\mathbb{R}^ğ· \rightarrow \mathbb{R}^E</span> ï¼š</p>
<p><div class="math-display">g(X) = TOP_k(softmax(Wx+\epsilon)) </div></p>
<p>å¼ä¸­ï¼Œ<span class="math-inline">W \in \mathbb{R}^{E\times D}</span> ã€‚ <span class="math-inline">TOP_k</span> å‡½æ•°çš„åŠŸèƒ½æ˜¯é™¤äº†æœ€å¤§çš„ <span class="math-inline">k</span> ä¸ªå€¼ä¹‹å¤–ï¼Œå…¶ä½™æ‰€æœ‰çš„å€¼éƒ½ç½®ä¸º 0ï¼Œ<span class="math-inline">\epsilon \sim \mathcal{N}(0,\frac{1}{E^2})</span></p>
<h2 id="ä¸“å®¶çš„ç¼“å†²åŒºå®¹é‡">ä¸“å®¶çš„ç¼“å†²åŒºå®¹é‡<a class="anchor-link" href="#ä¸“å®¶çš„ç¼“å†²åŒºå®¹é‡" title="Permanent link">&para;</a></h2>
<p>ä¸“å®¶çš„ç¼“å†²åŒºå®¹é‡(æ¯ä¸ª Expert å¤„ç†çš„ token (å³å›¾åƒ Patch) æ•°)ï¼š<span class="math-inline">B_e</span><br />
Batch Sizeï¼š<span class="math-inline">N</span><br />
æ¯å¼ å›¾ç‰‡çš„ Patch æ•°ï¼š<span class="math-inline">P</span><br />
æ¯ä¸ª token æ‰€é€‰ä¸“å®¶çš„æ•°é‡ï¼š<span class="math-inline">k</span><br />
Expert çš„æ€»æ•°ï¼š<span class="math-inline">E</span><br />
capacity ratioï¼š <span class="math-inline">C</span><br />
V-MoE æ§åˆ¶æ¯ä¸ª Expert å¤„ç†çš„ token (å³å›¾åƒ Patch) æ•°ä¸å˜ï¼š<br />
<div class="math-display"> B_e = round(\frac{kNPC}{E}) </div><br />
å¦‚æœè·¯ç”±å™¨ä¸ºç»™å®šçš„ Expert åˆ†é…è¶…è¿‡<span class="math-inline">B_e</span>  tokenï¼Œåˆ™åªå¤„ç†å…¶ä¸­çš„<span class="math-inline">B_e</span>ã€‚å‰©ä½™çš„æ ‡è®°å¹¶ä¸ä¼šå®Œå…¨ "ä¸¢å¤±"ï¼Œå› ä¸ºå®ƒä»¬çš„ä¿¡æ¯ç”±æ®‹å·®è¿æ¥ä¿ç•™ (å›¾ 1 çš„é¡¶éƒ¨å›¾)ã€‚æ­¤å¤–ï¼Œå¦‚æœ<span class="math-inline">k&gt;1</span>ï¼Œå‡ ä¸ª Expert å°è¯•å¤„ç†ä¸€ä¸ª tokenã€‚token æ°¸è¿œä¸ä¼šå®Œå…¨ä¸¢å¼ƒã€‚å¦‚æœ Expert è¢«åˆ†é…å°‘äº<span class="math-inline">B_e</span>  tokenï¼Œåˆ™å…¶ä½™ç¼“å†²åŒºè¢«é›¶å¡«å……ã€‚</p>
<h2 id="æ¨¡å‹ç»†èŠ‚">æ¨¡å‹ç»†èŠ‚<a class="anchor-link" href="#æ¨¡å‹ç»†èŠ‚" title="Permanent link">&para;</a></h2>
<p>V-MoE ä¸€å…±æ˜¯æ¥è‡ª 5 ç§å°ºå¯¸çš„ ViT æ¨¡å‹ï¼šViT-S(mall), ViT-B(ase), ViT-L(arge) å’Œ ViTH(uge)</p>
<p>æœ‰ 3 ä¸ªä¸»è¦è®¾è®¡å†³ç­–ä¼šå½±å“æ¨¡å‹çš„æˆæœ¬ï¼š</p>
<ul>
<li>
<p><strong>MoE å±‚çš„æ•°é‡</strong>ï¼š<br />
  æœ¬æ–‡å°è¯•äº†ä¸¤ç§ï¼šæ¯ä¸€å±‚éƒ½ä½¿ç”¨ MoEï¼Œé€šå¸¸å‘½åä¸º Every xxxï¼Œæˆ–è€…åªæœ‰æœ€åå‡ å±‚ä½¿ç”¨ MoEï¼Œé€šå¸¸å‘½åä¸º Last xxxã€‚ä½œè€…å‘ç°ï¼Œå°½ç®¡ä½¿ç”¨è¾ƒå°‘çš„ MoE å±‚å‡å°‘äº†æ¨¡å‹çš„å‚æ•°æ•°é‡ï¼Œä½†å®ƒå¯¹è´¨é‡çš„å½±å“é€šå¸¸å¾ˆå°ï¼Œå¹¶ä¸”å¯ä»¥æ˜¾ç€åŠ å¿«æ¨¡å‹ï¼Œå› ä¸ºä¼šäº§ç”Ÿæ›´å°‘çš„é€šä¿¡å¼€é”€ã€‚</p>
</li>
<li>
<p><strong>Expert çš„æ•°é‡</strong>ï¼š<br />
  V-MoE æ¨¡å‹çš„æˆæœ¬ä¸ä¾èµ–äº Expert çš„æ€»æ•°ï¼Œè€Œæ˜¯æ¯ä¸ª token æ‰€é€‰æ‹©çš„ä¸“å®¶æ•°é‡<span class="math-inline">k</span>ã€‚V-MoE é»˜è®¤ä½¿ç”¨<span class="math-inline">k=2</span>ï¼Œè€Œä½œè€…å‘ç° Expert æ€»æ•°<span class="math-inline">E=32</span> å®éªŒè®¾ç½®ä¸­çš„æœ€ä½³ç‚¹ã€‚</p>
</li>
<li>
<p><strong>æ¨¡å‹å®¹é‡ C</strong>ï¼š<br />
  åœ¨ä¸Šæ¸¸è®­ç»ƒæœŸé—´ï¼Œé»˜è®¤è®¾ç½® <span class="math-inline">C=1.05</span> ç»™å‡ºå°‘é‡æ¾å¼›ï¼Œè€Œä¸ä¼šæ˜¾ç€å¢åŠ æˆæœ¬ã€‚</p>
</li>
</ul>
<h2 id="è·¯ç”±ç®—æ³•">è·¯ç”±ç®—æ³•<a class="anchor-link" href="#è·¯ç”±ç®—æ³•" title="Permanent link">&para;</a></h2>
<p>åŸå§‹çš„ Routing ç®—æ³•å¦‚ä¸‹å›¾ 3 çš„ Algorithm1 æ‰€ç¤ºï¼Œè®¾ <span class="math-inline">\mathbf{X} \in \mathbb{R}^{N\cdot P \cdot D}</span> ï¼ˆ<span class="math-inline">N: batch,P: tokens, D: D-dimensional</span>ï¼‰ ä¸ºè¾“å…¥å›¾ç‰‡ï¼Œ <span class="math-inline">g(\mathbf{X})_{t, i} \in \mathbb{R}</span> è¡¨ç¤ºç¬¬ <span class="math-inline">t</span> ä¸ª token å’Œç¬¬ <span class="math-inline">i</span> ä¸ª Expert çš„è·¯ç”±æƒé‡ã€‚å½“æ¯ä¸ª token æ‰€é€‰æ‹©çš„ä¸“å®¶æ•°é‡ <span class="math-inline">k=2</span> æ—¶å¾ªç¯ 2 æ¬¡ã€‚æ¯æ¬¡å¾ªç¯æ—¶éå†æ¯ä¸ª Patchï¼Œé€šè¿‡ Router é€‰æ‹©å‡ºä¸€ä¸ªä¸“å®¶ <span class="math-inline">e</span> å’Œæƒé‡ <span class="math-inline">w</span> ã€‚å¦‚æœä¸“å®¶ <span class="math-inline">e</span> çš„å®¹é‡è¿˜æ²¡æ»¡ï¼Œå°±æŠŠå½“å‰çš„ Patch <span class="math-inline">p</span> ç»™è¿™ä¸ªä¸“å®¶å¤„ç†ï¼›å¦‚æœä¸“å®¶ <span class="math-inline">e</span> çš„å®¹é‡å·²ç»æ»¡äº†ï¼Œå°±è·³è¿‡å½“å‰çš„ Patch <span class="math-inline">p</span> ï¼Œå°±æ²¡æœ‰ä¸“å®¶å¤„ç†å®ƒäº†ã€‚</p>
<div align=center><img src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/20240626102146.png"/></div>

<blockquote>
<p>å›¾ 3ï¼šBatch Prioritized Routing å’ŒåŸå§‹ç®—æ³•çš„å¯¹æ¯”</p>
</blockquote>
<p><strong>Batch Prioritized Routing(BPR)</strong> ç®—æ³•å¦‚ä¸Šå›¾ 3 çš„ Algorithm2 æ‰€ç¤ºï¼Œæ€è·¯å°±æ˜¯ä¼˜å…ˆå¤„ç†æœ€é‡è¦çš„ token (è·¯ç”±æƒé‡é«˜çš„)ã€‚ä¸ºäº†ä¼˜å…ˆå¤„ç†æœ€é‡è¦çš„ tokenï¼Œä½œè€…æå‡ºå¯¹è¿™ <span class="math-inline">N</span> ä¸ª Patch çš„é‡è¦æ€§è¿›è¡Œæ’åºï¼Œå³ä¸ºæ¯ä¸ª Patch <span class="math-inline">p</span> è®¡ç®—å‡ºä¸€ä¸ªé‡è¦æ€§åˆ†æ•° <span class="math-inline">s(p)</span> ï¼Œå¯ä»¥å– <span class="math-inline">s(\mathbf{X})<em>{t}=\max </em>{i} g(\mathbf{X})_{t, i}</span> ã€‚ç„¶åæŒ‰ç…§è¿™ä¸ªé‡è¦æ€§åˆ†æ•°å¯¹è¿™ <span class="math-inline">N</span> ä¸ª Patch åšé‡æ–°æ’åº(<span class="math-inline">k&gt;2</span> å–å¤šä¸ªä¸“å®¶çš„ç´¯åŠ å’Œï¼Œä½†æ•ˆæœåŒ<span class="math-inline">TOP-1</span> è¿‘)ã€‚å†æ ¹æ®æ’åºåçš„ <span class="math-inline">N</span> ä¸ª Patch æŒ‰ç…§åŸå§‹çš„æ–¹æ³•å»åšè·¯ç”±ã€‚</p>
<h2 id="loss-function">Loss function<a class="anchor-link" href="#loss-function" title="Permanent link">&para;</a></h2>
<h3 id="importance-loss">Importance Loss<a class="anchor-link" href="#importance-loss" title="Permanent link">&para;</a></h3>
<p><strong>é‡è¦æ€§æŸå¤±ï¼šæ¿€åŠ±ä¸“å®¶çš„å¹³è¡¡ä½¿ç”¨ï¼ˆæ‰€æœ‰ä¸“å®¶å…·æœ‰åŒç­‰çš„é‡è¦æ€§ï¼‰</strong></p>
<p>ä¸“å®¶ <span class="math-inline">i</span> å¯¹å½“å‰ batch çš„é‡è¦æ€§ï¼š</p>
<p><div class="math-display">\operatorname{Imp}<em>{i}(\mathbf{X}):=\sum</em>{\mathbf{x} \in \mathbf{X}} \operatorname{softmax}(W \mathbf{x})_{i}</div></p>
<ul>
<li>expert <span class="math-inline">i</span></li>
<li>a batch of images <span class="math-inline">\mathbf{X}</span></li>
<li><span class="math-inline">W</span> is the layer-specific weight matrix for the router</li>
</ul>
<p>We use the squared coefficient of variation of the importance distribution over experts, <span class="math-inline">\operatorname{Imp}(\mathbf{X}):=\left{\operatorname{Imp}<em>{i}(\mathbf{X})\right}</em>{i=1}^{E}</span> :<br />
<div class="math-display">\mathcal{L}_{\operatorname{Imp}}(\mathbf{X})=\left(\frac{\operatorname{std}(\operatorname{Imp}(\mathbf{X}))}{\operatorname{mean}(\operatorname{Imp}(\mathbf{X}))}\right)^{2} \propto \operatorname{var}(\operatorname{Imp}(\mathbf{X}))</div></p>
<p>è®¡ç®—æ¯ä¸ªä¸“å®¶å¯¹å½“å‰ batch çš„é‡è¦æ€§ï¼Œç„¶åè®¡ç®—æ‰€æœ‰é‡è¦æ€§çš„å‡å€¼å’Œæ ‡å‡†å·®</p>
<h3 id="load-loss">Load Loss<a class="anchor-link" href="#load-loss" title="Permanent link">&para;</a></h3>
<p><strong>è´Ÿè½½å‡è¡¡ï¼ˆload balancingï¼‰:ä¸“å®¶æ¥æ”¶å¤§è‡´ç›¸ç­‰æ•°é‡çš„è®­ç»ƒæ ·æœ¬</strong></p>
<p><div class="math-display">\text { threshold }{ }<em>{k}(\mathbf{x}):=\max </em>{k \text {-th }}(W \mathbf{x}+\epsilon)</div></p>
<p>where <span class="math-inline">\epsilon</span> was the noise vector originally sampled during the forward pass.<br />
<div class="math-display">p_{i}(\mathbf{x}):=\mathbf{P}\left((W \mathbf{x})<em>{i}+\epsilon</em>{\text {new }} \geq \text { threshold }<em>{k}(\mathbf{x})\right)=\mathbf{P}\left(\epsilon</em>{\text {new }} \geq \text { threshold }<em>{k}(\mathbf{x})-(W \mathbf{x})</em>{i}\right)</div><br />
The probability is defined over <span class="math-inline">\epsilon_{\text {new }} \sim \mathcal{N}\left(0, \sigma^{2}\right)</span> , with <span class="math-inline">\sigma=1 / E</span> . The load for expert <span class="math-inline">i</span> over batch <span class="math-inline">\mathbf{X}</span> is:<span class="math-inline">\operatorname{load}<em>{i}(\mathbf{X})=\sum</em>{\mathbf{x} \in \mathbf{X}}p_{i}(\mathbf{x})</span><br />
Finally, the load loss corresponds to the squared coefficient of variation of the load distribution:</p>
<p><div class="math-display">\mathcal{L}<em>{\text {load }}(\mathbf{X})=\left(\frac{\operatorname{std}(\operatorname{load}(\mathbf{X}))}{\operatorname{mean}(\operatorname{load}(\mathbf{X}))}\right)^{2}, \quad \operatorname{load}(\mathbf{X}):=\left{\operatorname{load}</em>{i}(\mathbf{X})\right}_{i=1}^{E}</div></p>
<h3 id="final-auxiliary-loss">Final Auxiliary Loss<a class="anchor-link" href="#final-auxiliary-loss" title="Permanent link">&para;</a></h3>
<p><div class="math-display">\mathcal{L}<em>{\text {aux }}(X)=\frac{1}{2} \mathcal{L}</em>{\text {imp}}(X)+\frac{1}{2}\mathcal{L}_{\text{load}}(X)</div></p>
<p>The overall loss is:</p>
<p><div class="math-display">\mathcal{L}(X)=\mathcal{L}<em>{\text {classification }}(X)+\lambda \mathcal{L}</em>{\text {aux }}(X)</div><br />
We set <span class="math-inline">\lambda=0.01</span> in all our experiments, observing that this choice was robust and not sensitive.</p>
<h2 id="v-moe-è®­ç»ƒæ•°æ®">V-MoE è®­ç»ƒæ•°æ®<a class="anchor-link" href="#v-moe-è®­ç»ƒæ•°æ®" title="Permanent link">&para;</a></h2>
<p>V-MoE åœ¨ç§æœ‰æ•°æ®é›† JFT-300M ä¸Šåšé¢„è®­ç»ƒï¼Œå®ƒåŒ…å«äº†çº¦ 305M çš„è®­ç»ƒé›†å’Œ 50000 çš„éªŒè¯é›†ã€‚ç±»åˆ«æ•° 18291 (æ¯å¼ å›¾åƒå¹³å‡ 1.89 ä¸ªæ ‡ç­¾)ã€‚</p>
<p>å¯¹äº ImageNet ä¸Šçš„ Few-Shot å®éªŒï¼Œä½œè€…åªåœ¨æ¯ä¸ªç±»åˆ«ä½¿ç”¨ 1, 5, æˆ–è€… 10 shots æ¥è°ƒæ•´ä¸Šæ¸¸æ¨¡å‹ï¼Œåœ¨éªŒè¯é›†ä¸Šè¯„ä¼°å¾—åˆ°çš„æ¨¡å‹ã€‚</p>
<h2 id="å®éªŒç»“æœ">å®éªŒç»“æœ<a class="anchor-link" href="#å®éªŒç»“æœ" title="Permanent link">&para;</a></h2>
<p>V-MoE çš„ä¸Šæ¸¸ä»»åŠ¡é¢„è®­ç»ƒæ•°æ®é›†æ˜¯ JFT-300Mï¼Œå®ƒæ˜¯ä¸€ä¸ªå¤šæ ‡ç­¾æ•°æ®é›†ï¼Œå› æ­¤ä½œè€…é€šè¿‡ precision@1 æ¥è¡¡é‡æ¨¡å‹æ€§èƒ½ã€‚å¦‚ä¸‹å›¾ 4(a) å’Œå›¾ 5 æ‰€ç¤ºæ˜¯ä¸åŒ V-MoE å’Œ ViT å˜ä½“ç›¸å¯¹äºæ€»è®­ç»ƒæ—¶é—´çš„è´¨é‡ã€‚å›¾ 4 çš„ç»“æœæ˜¯ V-MoE last-nï¼Œå°±æ˜¯æœ€åçš„<span class="math-inline">n</span>  Block ä½¿ç”¨äº† MoE å— (V-MoE-H çš„ <span class="math-inline">n=5</span> ,å…¶ä»–æƒ…å†µä¸º<span class="math-inline">n=2</span>)ã€‚å›¾ 5 æ˜¯å„ç§é…ç½®ä¸‹çš„ V-MoE çš„å®éªŒç»“æœã€‚</p>
<div align=center><img src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/20240627145917.png"/></div>

<blockquote>
<p>å›¾ 4ï¼š(a) V-MoE ä¸Šæ¸¸ä»»åŠ¡é¢„è®­ç»ƒå®éªŒç»“æœã€‚(b) V-MoE Few-Shot å®éªŒç»“æœ</p>
</blockquote>
<div align=center><img src="https://markdownimg-hw.oss-cn-beijing.aliyuncs.com/20240627150550.png"/></div>

<blockquote>
<p>å›¾ 5ï¼šV-MoE å®éªŒç»“æœ</p>
</blockquote>
<h2 id="æ”¾å¤§-v-moe">æ”¾å¤§ V-MoE<a class="anchor-link" href="#æ”¾å¤§-v-moe" title="Permanent link">&para;</a></h2>
<p>ä½œä¸ºä¸€ç§æ”¾å¤§ ViT æ¨¡å‹çš„æ–¹æ³•ï¼Œä½œè€…è‡ªç„¶å¸Œæœ›éªŒè¯ä¸‹ V-MoE æ–¹æ³•å¯¹äºè¶…å¤§ ViT æ¨¡å‹çš„æ³›åŒ–æ€§èƒ½ã€‚ä¸ºæ­¤ï¼Œä½œè€…å¢åŠ äº†æ¨¡å‹çš„å¤§å°å¹¶ä½¿ç”¨æ›´å¤§çš„é¢„è®­ç»ƒæ•°æ®é›†ï¼šJFT-3B æ˜¯ JFT-300M çš„æ›´å¤§ç‰ˆæœ¬ï¼Œå®ƒåŒ…å«è¿‘ 3B å›¾åƒï¼Œå¹¶ä¸”ç”¨ 30k ç±»å˜ˆæ‚æ³¨é‡Šã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œä½œè€…å†å¯¹ Dense æ¨¡å‹æ”¾å¤§çš„æ–¹æ³•åšäº†æ”¹è¿›ä¹‹åå¾—åˆ°å¦‚ä¸‹çš„æ”¾å¤§ Sparse Mixture of Expert Layers æ¨¡å‹çš„æ–¹æ³•ï¼š</p>
<ul>
<li>ä½ç²¾åº¦ï¼šä½¿ç”¨ bfloat16 è€Œä¸æ˜¯ float32 æ¥å­˜å‚¨æ¢¯åº¦ç§»åŠ¨å¹³å‡ã€‚</li>
<li>å­¦ä¹ ç‡è¡°å‡ï¼šä½¿ç”¨ inverse square root schedule æ›¿æ¢ linear scheduleã€‚</li>
<li>æƒé‡è¡°å‡ï¼šæ¨¡å‹ä¸­ kernel weights çš„æƒé‡è¡°å‡ç‡ä¸º 0.03ï¼Œbias ä¸ä½¿ç”¨ï¼Œhead kernel çš„æƒé‡è¡°å‡ä¸º 3.0ã€‚</li>
<li>æ¨¡å‹çš„ headï¼šä¸ä½¿ç”¨ ViT çš„ headï¼Œå…¶ç¬¬ 1 ä¸ª token è¢«é€‰æ‹©å’Œä½¿ç”¨ï¼Œä½¿ç”¨åŸºäº Self-Attention çš„ headã€‚</li>
</ul>
<p>ä½œè€…è®­ç»ƒäº†ä¸€ä¸ªå¸¦æœ‰ 48 ä¸ª MoE Block çš„ V-MoE æ¨¡å‹ï¼Œæ¯ä¸ª Block 32 Expertsï¼Œæ¯ä¸ª token è¢« 2 ä¸ª Expert å¤„ç†ï¼Œå³ <span class="math-inline">k=2</span> æ¨¡å‹ä¸€å…± 14.7B å‚æ•°ï¼Œä½¿ç”¨ V-MoE-15B è¡¨ç¤ºã€‚</p>
<p>ä½œè€…æˆåŠŸè®­ç»ƒäº† V-MoE-15Bï¼Œè¿™æ˜¯è¿„ä»Šä¸ºæ­¢æœ€å¤§çš„è§†è§‰æ¨¡å‹ã€‚å®ƒåœ¨ 5-shot ImageNet ä¸Šçš„å‡†ç¡®ç‡ä¸º 82.78%ï¼Œä»¤äººå°è±¡æ·±åˆ»ï¼Œåœ¨å®Œå…¨å¾®è°ƒæ—¶çš„å‡†ç¡®ç‡æ›´æ˜¯è¾¾åˆ°äº†æƒŠäººçš„ 90.35%ã€‚å½“æ—¶ ImageNet ä¸Šå½“å‰æœ€å…ˆè¿›çš„æŠ€æœ¯æ˜¯ Meta Pseudo-Labelling (MPL)ã€‚MPL ä½¿ç”¨ ImageNet ä¼ªæ ‡è®°åœ¨æœªæ ‡è®°çš„ JFT-300M ä¸Šè®­ç»ƒåŸºäº EffecentNet çš„æ¨¡å‹ï¼Œè¾¾åˆ°äº† 90.2%ã€‚</p>
<h2 id="reference">Reference<a class="anchor-link" href="#reference" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/652536107">MoE ç³»åˆ—è¶…è¯¦ç»†è§£è¯» (äºŒ)ï¼šV-MoEï¼šè§†è§‰é¢†åŸŸçš„ç¨€ç–é—¨æ§æ··åˆä¸“å®¶æ¨¡å‹</a></li>
</ul>
                </div>

                <!-- Comments Section (Giscus) -->
                <section class="comments-section">
                    <h3><i class="fas fa-comments"></i> è¯„è®º</h3>
                    <script src="https://giscus.app/client.js"
                        data-repo="Geeks-Z/Geeks-Z.github.io"
                        data-repo-id=""
                        data-category="Announcements"
                        data-category-id=""
                        data-mapping="pathname"
                        data-strict="0"
                        data-reactions-enabled="1"
                        data-emit-metadata="0"
                        data-input-position="bottom"
                        data-theme="preferred_color_scheme"
                        data-lang="zh-CN"
                        crossorigin="anonymous"
                        async>
                    </script>
                </section>
            </article>

            <footer class="post-footer">
                <p>Â© 2025 Hongwei Zhao. Built with â¤ï¸</p>
            </footer>
        </main>
    </div>

    <!-- Theme Toggle Button -->
    <button class="theme-toggle" id="themeToggle" aria-label="åˆ‡æ¢ä¸»é¢˜">
        <i class="fas fa-moon"></i>
    </button>

    <script>
        // Theme Toggle
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;
        const icon = themeToggle.querySelector('i');
        const hljsDark = document.getElementById('hljs-theme-dark');
        const hljsLight = document.getElementById('hljs-theme-light');
        
        // Check saved theme or system preference
        const savedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        
        if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
            html.setAttribute('data-theme', 'dark');
            icon.className = 'fas fa-sun';
            hljsDark.disabled = false;
            hljsLight.disabled = true;
        }
        
        themeToggle.addEventListener('click', () => {
            const isDark = html.getAttribute('data-theme') === 'dark';
            if (isDark) {
                html.removeAttribute('data-theme');
                icon.className = 'fas fa-moon';
                localStorage.setItem('theme', 'light');
                hljsDark.disabled = true;
                hljsLight.disabled = false;
            } else {
                html.setAttribute('data-theme', 'dark');
                icon.className = 'fas fa-sun';
                localStorage.setItem('theme', 'dark');
                hljsDark.disabled = false;
                hljsLight.disabled = true;
            }
            
            // Update Giscus theme
            const giscusFrame = document.querySelector('iframe.giscus-frame');
            if (giscusFrame) {
                giscusFrame.contentWindow.postMessage({
                    giscus: {
                        setConfig: {
                            theme: isDark ? 'light' : 'dark'
                        }
                    }
                }, 'https://giscus.app');
            }
        });
        
        // Highlight.js
        document.addEventListener('DOMContentLoaded', () => {
            hljs.highlightAll();
        });
        
        // KaTeX auto-render
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof renderMathInElement !== 'undefined') {
                renderMathInElement(document.body, {
                    delimiters: [
                        {left: '$$', right: '$$', display: true},
                        {left: '$', right: '$', display: false},
                        {left: '\\[', right: '\\]', display: true},
                        {left: '\\(', right: '\\)', display: false}
                    ],
                    throwOnError: false
                });
            }
        });
        
        // TOC active state
        const tocLinks = document.querySelectorAll('.toc-container a');
        const headings = document.querySelectorAll('.post-content h2, .post-content h3, .post-content h4');
        
        function updateTocActive() {
            let current = '';
            headings.forEach(heading => {
                const rect = heading.getBoundingClientRect();
                if (rect.top <= 100) {
                    current = heading.getAttribute('id');
                }
            });
            
            tocLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + current) {
                    link.classList.add('active');
                }
            });
        }
        
        window.addEventListener('scroll', updateTocActive);
        updateTocActive();
    </script>
</body>
</html>
