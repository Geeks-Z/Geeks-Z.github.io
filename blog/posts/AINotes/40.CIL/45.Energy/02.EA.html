<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Untitled</title>
    <meta name="description" content="Untitled - Hongwei Zhao's Blog">
    <meta name="author" content="Hongwei Zhao">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+SC:wght@300;400;500;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Code Highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" id="hljs-theme-dark">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css" id="hljs-theme-light" disabled>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- KaTeX for Math -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    
    <style>
        :root {
            /* Light Theme */
            --primary-color: #2980b9;
            --primary-hover: #1a5276;
            --link-color: #c0392b;
            --text-color: #333;
            --text-light: #666;
            --text-muted: #999;
            --bg-color: #fff;
            --bg-secondary: #f8f9fa;
            --bg-code: #f5f5f5;
            --border-color: #e5e7eb;
            --shadow: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-lg: 0 4px 15px rgba(0,0,0,0.1);
        }

        [data-theme="dark"] {
            --primary-color: #5dade2;
            --primary-hover: #85c1e9;
            --link-color: #e74c3c;
            --text-color: #e5e7eb;
            --text-light: #9ca3af;
            --text-muted: #6b7280;
            --bg-color: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-code: #0f0f23;
            --border-color: #374151;
            --shadow: 0 1px 3px rgba(0,0,0,0.3);
            --shadow-lg: 0 4px 15px rgba(0,0,0,0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', 'Noto Sans SC', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-size: 16px;
            line-height: 1.8;
            color: var(--text-color);
            background: var(--bg-color);
            transition: background-color 0.3s, color 0.3s;
        }

        a {
            color: var(--primary-color);
            text-decoration: none;
            transition: color 0.2s;
        }

        a:hover {
            color: var(--primary-hover);
            text-decoration: underline;
        }

        /* Layout */
        .page-wrapper {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            gap: 3rem;
        }

        /* Sidebar TOC */
        .toc-sidebar {
            width: 260px;
            flex-shrink: 0;
            position: sticky;
            top: 2rem;
            height: fit-content;
            max-height: calc(100vh - 4rem);
            overflow-y: auto;
        }

        .toc-container {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .toc-container h3 {
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .toc-container ul {
            list-style: none;
        }

        .toc-container li {
            margin-bottom: 0.5rem;
        }

        .toc-container a {
            font-size: 0.9rem;
            color: var(--text-light);
            display: block;
            padding: 0.25rem 0;
            border-left: 2px solid transparent;
            padding-left: 0.75rem;
            transition: all 0.2s;
        }

        .toc-container a:hover,
        .toc-container a.active {
            color: var(--primary-color);
            border-left-color: var(--primary-color);
            text-decoration: none;
        }

        .toc-container ul ul {
            margin-left: 1rem;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            min-width: 0;
            max-width: 800px;
        }

        /* Header */
        .post-header {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 1.5rem;
        }

        .back-link:hover {
            color: var(--primary-color);
            text-decoration: none;
        }

        .post-header h1 {
            font-size: 2.25rem;
            font-weight: 700;
            line-height: 1.3;
            margin-bottom: 1rem;
            color: var(--text-color);
        }

        .post-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .post-meta span {
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .post-meta i {
            color: var(--text-muted);
        }

        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .tag {
            display: inline-block;
            font-size: 0.8rem;
            background: var(--bg-secondary);
            color: var(--text-light);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            transition: all 0.2s;
        }

        .tag:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* Article Content */
        .post-content {
            font-size: 1rem;
            line-height: 1.9;
        }

        .post-content h1,
        .post-content h2,
        .post-content h3,
        .post-content h4,
        .post-content h5,
        .post-content h6 {
            margin-top: 2rem;
            margin-bottom: 1rem;
            font-weight: 600;
            line-height: 1.4;
            color: var(--text-color);
        }

        .post-content h1 { font-size: 1.875rem; }
        .post-content h2 { 
            font-size: 1.5rem; 
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        .post-content h3 { font-size: 1.25rem; }
        .post-content h4 { font-size: 1.125rem; }

        .post-content p {
            margin-bottom: 1.25rem;
        }

        .post-content ul,
        .post-content ol {
            margin: 1.25rem 0;
            padding-left: 1.5rem;
        }

        .post-content li {
            margin-bottom: 0.5rem;
        }

        .post-content blockquote {
            margin: 1.5rem 0;
            padding: 1rem 1.5rem;
            background: var(--bg-secondary);
            border-left: 4px solid var(--primary-color);
            border-radius: 0 8px 8px 0;
            color: var(--text-light);
            font-style: italic;
        }

        .post-content blockquote p:last-child {
            margin-bottom: 0;
        }

        /* Code */
        .post-content code {
            font-family: 'JetBrains Mono', 'Fira Code', Consolas, monospace;
            font-size: 0.9em;
            background: var(--bg-code);
            padding: 0.2em 0.4em;
            border-radius: 4px;
            color: var(--link-color);
        }

        .post-content pre {
            margin: 1.5rem 0;
            padding: 1.25rem;
            background: var(--bg-code);
            border-radius: 10px;
            overflow-x: auto;
            border: 1px solid var(--border-color);
        }

        .post-content pre code {
            background: none;
            padding: 0;
            color: inherit;
            font-size: 0.875rem;
            line-height: 1.6;
        }

        /* Images */
        .post-content img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            margin: 1.5rem 0;
            box-shadow: var(--shadow-lg);
        }

        /* Tables */
        .post-content table {
            width: 100%;
            margin: 1.5rem 0;
            border-collapse: collapse;
            font-size: 0.95rem;
        }

        .post-content th,
        .post-content td {
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            text-align: left;
        }

        .post-content th {
            background: var(--bg-secondary);
            font-weight: 600;
        }

        .post-content tr:nth-child(even) {
            background: var(--bg-secondary);
        }

        /* Math */
        .math-display {
            margin: 1.5rem 0;
            overflow-x: auto;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: 8px;
        }

        /* Anchor links */
        .anchor-link {
            opacity: 0;
            margin-left: 0.5rem;
            color: var(--text-muted);
            font-weight: 400;
            transition: opacity 0.2s;
        }

        .post-content h2:hover .anchor-link,
        .post-content h3:hover .anchor-link,
        .post-content h4:hover .anchor-link {
            opacity: 1;
        }

        /* Theme Toggle */
        .theme-toggle {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            box-shadow: var(--shadow-lg);
            transition: transform 0.2s, background 0.2s;
            z-index: 1000;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
            background: var(--primary-hover);
        }

        /* Comments Section */
        .comments-section {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
        }

        .comments-section h3 {
            font-size: 1.25rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Footer */
        .post-footer {
            margin-top: 3rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
            text-align: center;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .toc-sidebar {
                display: none;
            }
            
            .page-wrapper {
                padding: 1.5rem;
            }
        }

        @media (max-width: 768px) {
            .post-header h1 {
                font-size: 1.75rem;
            }
            
            .post-meta {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .theme-toggle {
                bottom: 1rem;
                right: 1rem;
                width: 44px;
                height: 44px;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }
    </style>
</head>
<body>
    <div class="page-wrapper">
        <!-- TOC Sidebar -->
        <aside class="toc-sidebar">
            <div class="toc-container">
                <h3><i class="fas fa-list"></i> 目录</h3>
                <div class="toc">
<ul>
<li><a href="#0-摘要">0. 摘要</a></li>
<li><a href="#1-引言">1. 引言</a></li>
<li><a href="#2-相关工作">2. 相关工作</a></li>
<li><a href="#3-能量对齐">3. 能量对齐</a></li>
<li><a href="#4-实验">4. 实验</a></li>
<li><a href="#5-结论与未来工作">5. 结论与未来工作</a></li>
<li><a href="#6-参考文献">6. 参考文献</a></li>
</ul>
</div>

            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <article>
                <header class="post-header">
                    <a href="../../../../index.html" class="back-link">
                        <i class="fas fa-arrow-left"></i> 返回博客列表
                    </a>
                    <h1>Untitled</h1>
                    <div class="post-meta">
                        <span><i class="fas fa-calendar-alt"></i> 2026-01-28</span>
                        <span><i class="fas fa-folder"></i> AINotes/40.CIL/45.Energy</span>
                        <span><i class="fas fa-user"></i> Hongwei Zhao</span>
                    </div>
                    <div class="tags">
                        
                    </div>
                </header>

                <div class="post-content">
                    <h2 id="0-摘要">0. 摘要<a class="anchor-link" href="#0-摘要" title="Permanent link">&para;</a></h2>
<p>在类别增量学习（Class Incremental Learning, CIL）中，模型需要能够持续学习新的类别。然而，标准的深度神经网络（DNNs）会遭受灾难性遗忘的问题。最近的研究表明，类别不平衡是导致 CIL 中灾难性遗忘的关键因素。本文从基于能量的模型（Energy-Based Model, EBM）的角度出发，理论上证明了类别的自由能量与标签分布是对齐的，因此在追求“平衡”性能时，不同类别的能量应接近。然而，我们发现 CIL 训练的模型中存在严重的能量偏差现象。为了消除这种偏差，我们提出了一种简单而有效的方法，称为能量对齐（Energy Alignment），该方法仅通过在输出的 logits 上添加计算出的偏移标量来实现，且不需要（i）修改网络架构，（ii）干预标准的学习范式。实验结果表明，能量对齐在多个 CIL 基准测试中取得了良好的性能。</p>
<p><strong>关键词</strong>：类别增量学习，能量，不平衡</p>
<h2 id="1-引言">1. 引言<a class="anchor-link" href="#1-引言" title="Permanent link">&para;</a></h2>
<p>在类别增量学习（CIL）中，理想的智能系统应能够从流式数据中学习新类别，而不会忘记已经掌握的旧类别。当新数据到来时，CIL 中大部分或全部的旧数据无法再次被访问。在这种情况下，深度神经网络（DNNs）会遇到一个严重的问题，称为灾难性遗忘 [1,2]，即 DNNs 在学习新知识后很难回忆起旧知识。</p>
<p>当训练数据能够代表评估数据时，即观察到的训练数据分布 <span class="math-inline">p_o(x,y)</span> 与测试数据分布 <span class="math-inline">p_t(x,y)</span> 一致时（<span class="math-inline">x</span> 表示数据变量，<span class="math-inline">y</span> 表示标签变量），标准的 DNNs 通常是可靠且强大的。然而，在 CIL 中，理想条件 <span class="math-inline">p_o(x,y) = p_t(x,y)</span> 并未满足。即使使用回放策略（使用极少量的旧数据补充训练数据），旧类别与新类别之间的数据量不平衡问题仍然严重。分布偏移 <span class="math-inline">p_o(y) \neq p_t(y)</span> 会导致模型偏向多数类，这被证明是 CIL 中灾难性遗忘的关键因素 [3,4,5]。</p>
<p>本文从基于能量的模型（EBMs） [6] 的理论视角出发，致力于纠正 CIL 中的偏差模型，提出了一种简单而有效的方法，称为能量对齐（Energy Alignment）。EBMs 通过为每个变量配置（例如，<span class="math-inline">(x,y)</span> 对）分配一个标量能量来捕捉兼容性——通常，低能量表示变量配置高度兼容（当 <span class="math-inline">y</span> 适合 <span class="math-inline">x</span> 时），而高能量表示变量配置高度不兼容（当 <span class="math-inline">y</span> 不适合 <span class="math-inline">x</span> 时）。本工作中，我们揭示了特定类别的自由能量在理论上与类别的概率密度对齐。因此，在追求“平衡”性能的目标下，不同类别的自由能量应相似，因为目标标签分布 <span class="math-inline">p_t(y)</span> 实际上对每个类别是均匀的。然而，对于在非平衡数据上训练的模型，我们发现自由能量中存在严重的偏差：少数类通常具有更高的自由能量，而多数类通常具有更低的自由能量。因此，我们提出了能量对齐（EA）算法来对抗这种偏差。EA 试图将少数类的自由能量与多数类的自由能量对齐，这通过使用理论计算的偏移标量校正预测的 logits 来实现。我们表明，能量对齐可以应用于纯判别分类模型，意味着无需修改网络架构或改变标准训练过程即可轻松获得校正后的模型。我们通过提出的能量对齐方法改进了 CIL 中严重偏差的模型。基于回放 [7] 和蒸馏 [8,9] 策略，我们在每个增量步骤训练后使用能量对齐校正当前模型。实验结果表明，能量对齐在类别增量学习中的有效性。</p>
<p>我们的主要贡献总结如下：<br />
- 我们从基于能量的模型的角度出发，通过解决类别不平衡问题来缓解类别增量学习中的灾难性遗忘。<br />
- 我们从能量值的角度解释了在非平衡数据上训练的模型中的偏差。基于这一观察，我们提出了能量对齐来校正偏差模型，这既简单又具有理论依据。<br />
- 我们在类别增量学习基准测试中展示了能量对齐的有效性。</p>
<h2 id="2-相关工作">2. 相关工作<a class="anchor-link" href="#2-相关工作" title="Permanent link">&para;</a></h2>
<p><strong>类别增量学习</strong>：为了缓解增量学习中的灾难性遗忘，最近提出了许多策略。一组方法通过参数控制 [10,11,12] 来缓解灾难性遗忘，试图保持对旧知识重要的参数不变。知识蒸馏 [9,7,13] 也被用来缓解灾难性遗忘。然而，大多数方法难以处理类别增量学习的场景 [14]，而简单的回放策略已被证明在 CIL 中有效 [14,15]。基于回放策略，另一系列研究，如 BiC [4]、IL2M [16]、WA [5] 和 ScaIL [17]，将类别不平衡视为导致 CIL 中灾难性遗忘的关键因素，并提出了不同的解决方案。本工作也基于回放策略和蒸馏策略，但尝试从基于能量的模型的角度纠正 CIL 中的偏差。</p>
<p><strong>基于能量的模型与判别模型</strong>：考虑一个具有两组变量 <span class="math-inline">x</span>（例如，图像）和 <span class="math-inline">y</span>（例如，标签）的模型（<span class="math-inline">x \in X</span>, <span class="math-inline">y \in Y</span>, <span class="math-inline">X</span> 和 <span class="math-inline">Y</span> 分别表示 <span class="math-inline">x</span> 和 <span class="math-inline">y</span> 的整个空间），基于能量的模型（EBMs）通过为每个变量配置分配一个非概率的标量能量来捕捉兼容性 [6]。通常，EBMs 构建一个能量函数 <span class="math-inline">E_\theta(x,y)</span>，将每个配置 <span class="math-inline">(x,y)</span> 映射到一个能量值，其中 <span class="math-inline">\theta</span> 是可训练的参数集。通常，小能量表示变量配置高度兼容（当 <span class="math-inline">y</span> 适合 <span class="math-inline">x</span> 时），而大能量表示变量配置高度不兼容（当 <span class="math-inline">y</span> 不适合 <span class="math-inline">x</span> 时）。在模型将与其他模型结合使用的场景中，通常需要对能量进行归一化。最常见的归一化方法是利用玻尔兹曼分布将能量值集合转化为概率密度：<br />
<div class="math-display"><br />
    p_\theta(y|x) = \frac{e^{-E_\theta(x,y)}}{\int_{y' \in Y} e^{-E_\theta(x,y')}}. \tag{1}<br />
</div><br />
最近，一个具有 <span class="math-inline">C</span> 个类别的分类任务通常通过判别深度神经网络 <span class="math-inline">f_\theta(x)</span> 进行优化，其中 <span class="math-inline">\theta</span> 表示可学习的参数集，通过它将输入变量 <span class="math-inline">x</span> 映射到 <span class="math-inline">C</span> 个标量值，称为 logits。然后，这些 logits 通过 softmax 函数用于参数化 <span class="math-inline">C</span> 个类上的后验概率分布：<br />
<div class="math-display"><br />
    p_\theta(y|x) = \frac{e^{f_\theta(x)[y]}}{\sum_{y'=1}^C e^{f_\theta(x)[y']}}, \tag{2}<br />
</div><br />
其中 <span class="math-inline">f_\theta(x)[y]</span> 表示 <span class="math-inline">f_\theta(x)</span> 的第 <span class="math-inline">y</span> 个索引。</p>
<p>比较公式（2）与公式（1），EBMs 与判别模型本质上紧密相关 [18,19]。在不改变神经网络 <span class="math-inline">f_\theta(\cdot)</span> 的参数化的情况下，我们可以重新使用 logits 来表示配置 <span class="math-inline">(x,y)</span> 的能量 [19]：<br />
<div class="math-display"><br />
    E_\theta(x,y) = -f_\theta(x)[y]. \tag{3}<br />
</div><br />
实际上，负 logit <span class="math-inline">-f_\theta(x)[y]</span> 确实反映了 <span class="math-inline">x</span> 和 <span class="math-inline">y</span> 之间的兼容性程度——小的 <span class="math-inline">-f_\theta(x)[y]</span> 值对应于“好”的配置，而大的 <span class="math-inline">-f_\theta(x)[y]</span> 值对应于“坏”的配置，这正是基于能量的模型所要求的。</p>
<h2 id="3-能量对齐">3. 能量对齐<a class="anchor-link" href="#3-能量对齐" title="Permanent link">&para;</a></h2>
<p><strong>能量中的偏差</strong>：类似于公式（1），对于 EBMs，<span class="math-inline">x</span> 和 <span class="math-inline">y</span> 的联合分布可以再次使用玻尔兹曼分布表示为：<br />
<div class="math-display"><br />
    p_\theta(x,y) = \frac{e^{-E_\theta(x,y)}}{Z_\theta}, \quad Z_\theta = \int_{x' \in X, y' \in Y} e^{-E_\theta(x',y')}. \tag{4}<br />
</div><br />
然后，通过对联合分布公式（4）关于 <span class="math-inline">x</span> 进行边缘化，我们得到：<br />
<div class="math-display"><br />
    p_\theta(y) = \int_{x' \in X} \frac{e^{-E_\theta(x',y)}}{Z_\theta} = \frac{e^{-E_\theta(y)}}{Z_\theta}, \tag{5}<br />
</div><br />
其中亥姆霍兹自由能量 <span class="math-inline">E_\theta(y) = -\log \int_{x' \in X} e^{-E_\theta(x',y)}</span>。</p>
<p>然后，对公式（5）两边取对数，我们得到：<br />
<div class="math-display"><br />
    \log p_\theta(y) = -E_\theta(y) - \log Z_\theta. \tag{6}<br />
</div><br />
如公式（6）所示，负自由能量 <span class="math-inline">-E_\theta(y)</span> 与 <span class="math-inline">\log p_\theta(y)</span> 线性对齐，即 <span class="math-inline">-E_\theta(y) \propto \log p_\theta(y)</span>。对于判别神经网络 <span class="math-inline">f_\theta(\cdot)</span>，结合公式（3），我们得到模型的负自由能量：<br />
<div class="math-display"><br />
    -E_\theta(y) = \log \int_{x' \in X} e^{f_\theta(x')[y]}.<br />
</div><br />
由于类别不平衡，观察到的训练集的标签分布与目标（测试）集的标签分布不同，分别记为 <span class="math-inline">p_o(y)</span> 和 <span class="math-inline">p_t(y)</span>。尽管观察到的训练数据是非平衡的，但在测试时仍期望获得平衡的预测和优异的整体结果，这意味着目标标签分布 <span class="math-inline">p_t(y)</span> 对所有感兴趣的类别实际上是均匀的。理想情况下，参数为 <span class="math-inline">\theta</span> 的模型应反映目标标签分布，即 <span class="math-inline">p_\theta(y) \approx p_t(y)</span>。因此，我们希望：<br />
<div class="math-display"><br />
    p_\theta(y=i) = p_\theta(y=j), \quad 1 \leq i \leq C, \quad 1 \leq j \leq C, \quad i \neq j. \tag{7}<br />
</div><br />
进一步结合公式（6），我们期望：<br />
<div class="math-display"><br />
    -E_\theta(y=i) = -E_\theta(y=j), \quad 1 \leq i \leq C, \quad 1 \leq j \leq C, \quad i \neq j. \tag{8}<br />
</div><br />
不幸的是，在非平衡数据上训练的模型实际上往往反映训练数据集的标签分布，即 <span class="math-inline">p_o(y)</span> 而不是 <span class="math-inline">p_t(y)</span>。我们在 CIFAR10 的非平衡版本上进行了实验，其训练数据的标签分布如图 1a 所示。基于学习到的模型，我们估计了十个类别的自由能量，揭示了多数类往往具有较低的能量，而少数类通常具有较高的能量，如图 1a 所示。这一现象与公式（8）不符，从基于能量学习的角度揭示了训练模型中的偏差。</p>
<p><strong>能量对齐</strong>：上述分析指出，目标中隐藏的先验标签分布 <span class="math-inline">p_t(y)</span> 实际上对感兴趣的类别是均匀的。然而，在非平衡数据上训练的模型的自由能量 <span class="math-inline">E_\theta(y)</span> 与先验知识（公式（8））不匹配。我们提出了一种简单而有效的方法，称为能量对齐（EA），直接纠正偏差模型，而不干预 <span class="math-inline">f_\theta(\cdot)</span> 的训练过程。在 EA 中，对 logits 进行修正，以使能量满足公式（8）。</p>
<p>在不失一般性的情况下，考虑第 <span class="math-inline">i</span> 和第 <span class="math-inline">j</span> 类（<span class="math-inline">1 \leq i \leq C</span>, <span class="math-inline">1 \leq j \leq C</span>, <span class="math-inline">i \neq j</span>）的自由能量，我们将第 <span class="math-inline">i</span> 类视为“锚定类”，并通过偏移标量 <span class="math-inline">\alpha_j</span> 重新平衡两个自由能量，其公式为：<br />
<div class="math-display"><br />
    -E_\theta(y=i) = -E_\theta(y=j) + \alpha_j \Rightarrow \log \int_{x' \in X} e^{f_\theta(x')[i]} = \alpha_j + \log \int_{x' \in X} e^{f_\theta(x')[j]} \Rightarrow \alpha_j = \log \frac{\int_{x' \in X} e^{f_\theta(x')[i]}}{\int_{x' \in X} e^{f_\theta(x')[j]}}. \tag{9}<br />
</div><br />
现在，假设偏移标量 <span class="math-inline">\alpha_j</span> 已被计算（将在后面描述），公式（9）的右侧可以重新表示为：<br />
<div class="math-display"><br />
    -E_\theta(y=j) + \alpha_j = \alpha_j + \log \int_{x' \in X} e^{f_\theta(x')[j]} = \log \int_{x' \in X} e^{f_\theta(x')[j] + \alpha_j}. \tag{10}<br />
</div><br />
如公式（10）所示，对于任何输入数据点，第 <span class="math-inline">j</span> 个 logit 可以通过添加一个非学习的标量 <span class="math-inline">\alpha_j</span> 进行调整，从而使得第 <span class="math-inline">i</span> 类和第 <span class="math-inline">j</span> 类的负自由能量 <span class="math-inline">-E_\theta(y=i)</span> 和 <span class="math-inline">-E_\theta(y=j)</span> 能够相等。直观地，当 <span class="math-inline">\int_{x' \in X} e^{f_\theta(x')[i]} &gt; \int_{x' \in X} e^{f_\theta(x')[j]}</span> 时，<span class="math-inline">\alpha_j</span> 为正，则 logit <span class="math-inline">f_\theta(x')[j]</span> 被 <span class="math-inline">\alpha_j</span> 增强；如果 <span class="math-inline">\int_{x' \in X} e^{f_\theta(x')[i]} &lt; \int_{x' \in X} e^{f_\theta(x')[j]}</span>，<span class="math-inline">\alpha_j</span> 为负，则 logit <span class="math-inline">f_\theta(x')[j]</span> 被 <span class="math-inline">\alpha_j</span> 减弱。</p>
<p>对于任何其他类别 <span class="math-inline">j</span>（<span class="math-inline">j \neq i</span>），我们可以用相应的标量 <span class="math-inline">\alpha_j</span> 调整第 <span class="math-inline">j</span> 个 logit，以类似地满足公式（8），因此具有能量对齐的模型将平等对待所有类别，并使公式（7）和公式（8）成立。校正后的模型记为 <span class="math-inline">f_{\theta; {\alpha_j}_{j=1}^{C-1}}</span>。所提出的能量对齐策略如图 2 所示。例如，对于上述实验，校正模型的负自由能量如图 1b 所示，表明能量对齐确实能够平衡能量。</p>
<p><strong>偏移标量 <span class="math-inline">\alpha_j</span> 的近似</strong>：为了获得 <span class="math-inline">\alpha_j</span>，剩下的关键问题是如何计算项 <span class="math-inline">\int_{x' \in X} e^{f_\theta(x')[i]}</span> 和 <span class="math-inline">\int_{x' \in X} e^{f_\theta(x')[j]}</span>。为了避免直接计算不可行的积分，本工作中我们使用蒙特卡罗积分 [20,21] 来估计这些积分。具体来说，对于第 <span class="math-inline">i</span> 类，积分通过 <span class="math-inline">\int_{x' \in X} e^{f_\theta(x')[i]} \approx \int_{x' \in X'} e^{f_\theta(x')[i]} \approx \frac{1}{S} \sum_{s=1}^S \frac{e^{f_\theta(x_s)[i]}}{q(x_s)}</span> 来近似，其中 <span class="math-inline">X' \subset X</span> 是感兴趣类别的输入空间。由于 <span class="math-inline">e^{f_\theta(x)[i]}</span> 在训练后的 <span class="math-inline">\theta</span> 下通常对与感兴趣类别几乎无关的样本输出非常低的响应，因此在子空间 <span class="math-inline">X'</span> 上估计积分就足够了。数据点 <span class="math-inline">{x_s}<em>{s=1}^S</span> 从提议分布 <span class="math-inline">q(x)</span> 中采样，假设 <span class="math-inline">q(x)</span> 对输入空间 <span class="math-inline">X'</span> 中的样本分配均匀值（即 <span class="math-inline">q(x)</span> 是均匀分布）。对于另一个积分 <span class="math-inline">\int</em>{x' \in X} e^{f_\theta(x')[j]}</span> 也是如此。然后，我们有：<br />
<div class="math-display"><br />
    \alpha_j \approx \text{LSE}<em>{s=1}^S (f</em>\theta(x_s)[i]) - \text{LSE}<em>{s=1}^S (f</em>\theta(x_s)[j]), \tag{11}<br />
</div><br />
其中 <span class="math-inline">\text{LSE}<em>{s=1}^S (z_s) = \log \sum</em>{s=1}^S e^{z_s}</span>。为了减少近似误差，我们根据每个类别的训练样本数量将类别分为 <span class="math-inline">M</span> 个簇，每个簇共享相同的偏移标量。具体来说，对于分别具有 <span class="math-inline">C_i</span> 和 <span class="math-inline">C_j</span> 个类别的簇 <span class="math-inline">O_i</span> 和 <span class="math-inline">O_j</span>，类似于公式（9）、公式（10）和公式（11），我们将簇 <span class="math-inline">O_i</span> 视为“锚定簇”，并通过共享的偏移标量 <span class="math-inline">\alpha_j</span> 重新平衡两个簇的平均能量。<span class="math-inline">\alpha_j</span> 的估计由下式给出：<br />
<div class="math-display"><br />
    \alpha_j \approx \frac{1}{C_i} \sum_{i \in O_i} \text{LSE}<em>{s=1}^S (f</em>\theta(x_s)[i]) - \frac{1}{C_j} \sum_{j \in O_j} \text{LSE}<em>{s=1}^S (f</em>\theta(x_s)[j]). \tag{12}<br />
</div><br />
此外，对于任何输入数据，仍然可以通过共享的 <span class="math-inline">\alpha_j</span> 直接调整簇 <span class="math-inline">O_j</span> 中的类别的 logits，以获得校正后的模型，记为 <span class="math-inline">f_{\theta; {\alpha_j}_{j=1}^{M-1}}</span>。</p>
<p><strong>带有能量对齐的类别增量学习</strong>：我们在算法 1 中展示了带有能量对齐的类别增量学习过程。假设来自不同类别的 <span class="math-inline">B</span> 批训练数据 <span class="math-inline">{D^{(b)}}<em>{b=1}^B</span> 逐渐可用，其中在第 <span class="math-inline">b</span> 个增量步骤中，新的训练数据 <span class="math-inline">D^{(b)}</span> 来自 <span class="math-inline">C^{(b)}</span> 个新类别，而回放数据 <span class="math-inline">D^{(b)}</em>{\text{old}}</span>（从前面的数据 <span class="math-inline">{D^{(1)}, \cdots, D^{(b-1)}}</span> 中选择）来自 <span class="math-inline">C^{(b)}<em>{\text{old}}</span> 个旧类别，其中 <span class="math-inline">C^{(1)}</em>{\text{old}} = 0</span> 且 <span class="math-inline">C^{(b)}<em>{\text{old}} = \sum</em>{k=1}^{b-1} C^{(k)}, b &gt; 1</span>。每个增量步骤中的回放样本数量（除第一步外，因为初始步骤中没有旧数据）是恒定的，即 <span class="math-inline">|D^{(1)}<em>{\text{old}}| = 0</span>, <span class="math-inline">|D^{(2)}</em>{\text{old}}| = |D^{(3)}<em>{\text{old}}| = \cdots = |D^{(B)}</em>{\text{old}}|</span>，因此随着遇到更多类别，每个旧类别的回放样本数量逐渐减少，类别不平衡问题变得更加严重。模型 <span class="math-inline">f_\theta(\cdot)</span> 通过复合损失进行训练：<br />
<div class="math-display"><br />
    L_{\text{CIL}}(x, y^<em>) = (1 - \lambda) L_{\text{CIL-CE}}(x, y^</em>) + \lambda L_{\text{CIL-KD}}(x), \tag{13}<br />
</div><br />
其中 <span class="math-inline">y^<em></span> 表示真实标签，<span class="math-inline">(x, y^</em>) \in D^{(b)} \cup D^{(b)}<em>{\text{old}}</span>，<span class="math-inline">\lambda</span> 用于平衡两个损失，设置为 <span class="math-inline">\lambda</em>{\text{base}} \cdot \frac{C^{(b)}<em>{\text{old}}}{C^{(b)} + C^{(b)}</em>{\text{old}}}</span>，其中 <span class="math-inline">\lambda_{\text{base}}</span> 是一个超参数。交叉熵损失定义为：<br />
<div class="math-display"><br />
    L_{\text{CIL-CE}}(x, y^<em>) = \sum_{i=1}^{C^{(b)} + C^{(b)}<em>{\text{old}}} -I</em>{i = y^</em>} \log(p_\theta(i|x)), \tag{14}<br />
</div><br />
其中 <span class="math-inline">(x, y^<em>) \in D^{(b)} \cup D^{(b)}<em>{\text{old}}</span>，<span class="math-inline">I</em>{i = y^</em>}</span> 是指示函数，<span class="math-inline">p_\theta(i|x)</span> 是第 <span class="math-inline">i</span> 类的预测概率，定义为公式（2）。知识蒸馏损失定义为：<br />
<div class="math-display"><br />
    L_{\text{CIL-KD}}(x) = \sum_{i=1}^{C^{(b)}<em>{\text{old}}} -\hat{q}</em>{\theta_t; \alpha}(i|x) \log(q_\theta(i|x)), \tag{15}<br />
</div><br />
其中 <span class="math-inline">\hat{q}<em>{\theta_t; \alpha}(i|x) = \frac{e^{f</em>{\theta_t; \alpha}(x)[i]/T}}{\sum_{j=1}^{C^{(b)}<em>{\text{old}}} e^{f</em>{\theta_t; \alpha}(x)[j]/T}}</span>，<span class="math-inline">q_\theta(i|x) = \frac{e^{f_\theta(x)[i]/T}}{\sum_{j=1}^{C^{(b)}<em>{\text{old}}} e^{f</em>\theta(x)[j]/T}}</span>，<span class="math-inline">x \in D^{(b)} \cup D^{(b)}_{\text{old}}</span>，<span class="math-inline">T</span> 表示温度。</p>
<p>在类别增量学习中，每个增量步骤中，旧类别形成“旧簇”，被视为“锚定簇”，新类别形成“新簇”（即簇的数量 <span class="math-inline">M = 2</span>），然后可以为“新簇”计算一个偏移标量 <span class="math-inline">\alpha</span>。我们使用偏移标量进行能量对齐，并获得校正后的模型 <span class="math-inline">f_{\theta_t; \alpha}(x)</span>，该模型也作为下一个增量步骤中的教师模型，如算法 1 所示。</p>
<h2 id="4-实验">4. 实验<a class="anchor-link" href="#4-实验" title="Permanent link">&para;</a></h2>
<p>实验在 ImageNet ILSVRC 2012 [24] 上进行。ImageNet ILSVRC 2012 包含大约 120 万张训练图像和 5 万张验证图像，提供了两种设置——ImageNet100 包含 100 个随机选择的类别，ImageNet1000 包含全部 1000 个类别。我们的实现基于 Pytorch [25]。使用 ResNet-18 [26,27] 作为骨干网络。</p>
<p>为了公平比较，根据之前工作 [4,7,22,5] 提出的常规实验设置，将 ImageNet100 和 ImageNet1000 分别划分为 10 个增量步骤，每个步骤包含 10 个和 100 个类别。此外，在 ImageNet100 和 ImageNet1000 的实验中，分别为旧类别存储了 2000 和 20000 张图像。我们随机选择回放样本。图 3 展示了一些频率分布，表明训练数据严重不平衡。随着新类别的到来，每个类别的样本数量逐渐减少。因此，类别不平衡问题变得更加严重，而目标标签分布始终对每个类别保持均匀。</p>
<p>在每个增量步骤中，训练模型在所有已见类别上进行评估，并报告准确率。最终，计算所有增量步骤（除第一步外）的平均准确率（Avg），因为第一步实际上与“增量”无关。</p>
<p><strong>能量对齐的效果</strong>：如图 4（上）所示，EA 显著提高了性能（在最后一个增量步骤中，ImageNet100 的 top-5 准确率提高了超过 24%，ImageNet1000 提高了超过 29%）。我们进一步绘制了最后一个增量步骤中模型在 ImageNet100 上的混淆矩阵（经过对数变换）。从图 4（下）可以看出，普通方法（无 EA）倾向于将对象预测为新类别，即许多来自旧类别（1~90）的样本被错误分类为新类别（91~100）。在 EA 的帮助下，模型公平地对待新类别和旧类别。这些结果直观地表明，EA 能够有效缓解 CIL 中的类别不平衡问题。</p>
<p><strong>与最先进方法的比较</strong>：在 ImageNet100 和 ImageNet1000 上与竞争性和代表性方法的比较结果分别列于表 1 和表 2 中，这些结果明显证实了我们提出的算法在性能上优于许多最先进的方法，再次证明了 EA 的有效性。</p>
<h2 id="5-结论与未来工作">5. 结论与未来工作<a class="anchor-link" href="#5-结论与未来工作" title="Permanent link">&para;</a></h2>
<p>在本文中，我们提出了一种简单而有效的算法来处理类别增量学习中的模型偏差问题。从基于能量的模型的角度出发，我们系统地分析了类别的自由能量与标签分布之间的关系。基于理论计算，我们提出了能量对齐（EA）方法，通过调整不同类别的输出能量来实现更好的整体性能。在类别增量学习基准测试上进行的综合实验表明，该方法优于许多最先进的方法。</p>
<h2 id="6-参考文献">6. 参考文献<a class="anchor-link" href="#6-参考文献" title="Permanent link">&para;</a></h2>
<p>[参考文献部分无需翻译]</p>
                </div>

                <!-- Comments Section (Giscus) -->
                <section class="comments-section">
                    <h3><i class="fas fa-comments"></i> 评论</h3>
                    <script src="https://giscus.app/client.js"
                        data-repo="Geeks-Z/Geeks-Z.github.io"
                        data-repo-id=""
                        data-category="Announcements"
                        data-category-id=""
                        data-mapping="pathname"
                        data-strict="0"
                        data-reactions-enabled="1"
                        data-emit-metadata="0"
                        data-input-position="bottom"
                        data-theme="preferred_color_scheme"
                        data-lang="zh-CN"
                        crossorigin="anonymous"
                        async>
                    </script>
                </section>
            </article>

            <footer class="post-footer">
                <p>© 2025 Hongwei Zhao. Built with ❤️</p>
            </footer>
        </main>
    </div>

    <!-- Theme Toggle Button -->
    <button class="theme-toggle" id="themeToggle" aria-label="切换主题">
        <i class="fas fa-moon"></i>
    </button>

    <script>
        // Theme Toggle
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;
        const icon = themeToggle.querySelector('i');
        const hljsDark = document.getElementById('hljs-theme-dark');
        const hljsLight = document.getElementById('hljs-theme-light');
        
        // Check saved theme or system preference
        const savedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        
        if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
            html.setAttribute('data-theme', 'dark');
            icon.className = 'fas fa-sun';
            hljsDark.disabled = false;
            hljsLight.disabled = true;
        }
        
        themeToggle.addEventListener('click', () => {
            const isDark = html.getAttribute('data-theme') === 'dark';
            if (isDark) {
                html.removeAttribute('data-theme');
                icon.className = 'fas fa-moon';
                localStorage.setItem('theme', 'light');
                hljsDark.disabled = true;
                hljsLight.disabled = false;
            } else {
                html.setAttribute('data-theme', 'dark');
                icon.className = 'fas fa-sun';
                localStorage.setItem('theme', 'dark');
                hljsDark.disabled = false;
                hljsLight.disabled = true;
            }
            
            // Update Giscus theme
            const giscusFrame = document.querySelector('iframe.giscus-frame');
            if (giscusFrame) {
                giscusFrame.contentWindow.postMessage({
                    giscus: {
                        setConfig: {
                            theme: isDark ? 'light' : 'dark'
                        }
                    }
                }, 'https://giscus.app');
            }
        });
        
        // Highlight.js
        document.addEventListener('DOMContentLoaded', () => {
            hljs.highlightAll();
        });
        
        // KaTeX auto-render
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof renderMathInElement !== 'undefined') {
                renderMathInElement(document.body, {
                    delimiters: [
                        {left: '$$', right: '$$', display: true},
                        {left: '$', right: '$', display: false},
                        {left: '\\[', right: '\\]', display: true},
                        {left: '\\(', right: '\\)', display: false}
                    ],
                    throwOnError: false
                });
            }
        });
        
        // TOC active state
        const tocLinks = document.querySelectorAll('.toc-container a');
        const headings = document.querySelectorAll('.post-content h2, .post-content h3, .post-content h4');
        
        function updateTocActive() {
            let current = '';
            headings.forEach(heading => {
                const rect = heading.getBoundingClientRect();
                if (rect.top <= 100) {
                    current = heading.getAttribute('id');
                }
            });
            
            tocLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + current) {
                    link.classList.add('active');
                }
            });
        }
        
        window.addEventListener('scroll', updateTocActive);
        updateTocActive();
    </script>
</body>
</html>
